"use strict";(self.webpackChunkddupg_github_io=self.webpackChunkddupg_github_io||[]).push([[8196],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>c});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),g=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=g(e.components);return a.createElement(o.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),m=g(n),u=r,c=m["".concat(o,".").concat(u)]||m[u]||d[u]||l;return n?a.createElement(c,i(i({ref:t},s),{},{components:n})):a.createElement(c,i({ref:t},s))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=u;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p[m]="string"==typeof e?e:r,i[1]=p;for(var g=2;g<l;g++)i[g]=n[g];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9698:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>p,toc:()=>g});var a=n(3117),r=(n(7294),n(3905));const l={slug:"Initial-Analysis-Region-Replicas",title:"\u521d\u6b65\u4e86\u89e3HBase Region Replicas",date:"2019-12-05T15:00",author:"Ddupg",author_url:"https://ddupg.github.io",tags:["HBase"]},i=void 0,p={permalink:"/blog/Initial-Analysis-Region-Replicas",editUrl:"https://github.com/ddupg/ddupg.github.io/tree/main/blog/Initial-Analysis-Region-Replicas/index.md",source:"@site/blog/Initial-Analysis-Region-Replicas/index.md",title:"\u521d\u6b65\u4e86\u89e3HBase Region Replicas",description:"\u80cc\u666f",date:"2019-12-05T15:00:00.000Z",formattedDate:"2019\u5e7412\u67085\u65e5",tags:[{label:"HBase",permalink:"/blog/tags/h-base"}],readingTime:23.3,hasTruncateMarker:!0,authors:[{name:"Ddupg",url:"https://ddupg.github.io"}],frontMatter:{slug:"Initial-Analysis-Region-Replicas",title:"\u521d\u6b65\u4e86\u89e3HBase Region Replicas",date:"2019-12-05T15:00",author:"Ddupg",author_url:"https://ddupg.github.io",tags:["HBase"]},prevItem:{title:"Maven\u9879\u76ee\u4ee5Shaded\u5f62\u5f0f\u5f15\u5165\u7b2c\u4e09\u65b9\u4f9d\u8d56\u5e93",permalink:"/blog/Shaded-Thirdparty-Dependencies"},nextItem:{title:"\u300c\u8bb0\u300dJdk8 CompletableFuture\u5728\u9ad8\u5e76\u53d1\u73af\u5883\u4e0b\u7684\u6027\u80fd\u95ee\u9898",permalink:"/blog/CompletableFuture-in-high-concurrent"}},o={authorsImageUrls:[void 0]},g=[{value:"\u80cc\u666f",id:"\u80cc\u666f",level:2},{value:"Timeline Consistency",id:"timeline-consistency",level:2},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0",level:2},{value:"\u6570\u636e\u6a21\u578b",id:"\u6570\u636e\u6a21\u578b",level:3},{value:"\u6570\u636e\u540c\u6b65",id:"\u6570\u636e\u540c\u6b65",level:3},{value:"StoreFile Refresher",id:"storefile-refresher",level:4},{value:"Asynchronous Replication",id:"asynchronous-replication",level:4},{value:"\u5b58\u5728\u7684\u95ee\u9898",id:"\u5b58\u5728\u7684\u95ee\u9898",level:3},{value:"HFile\u7684\u8fc7\u671f\u65f6\u95f4",id:"hfile\u7684\u8fc7\u671f\u65f6\u95f4",level:4},{value:"replication\u4e0d\u80fd\u540c\u6b65meta\u8868\u6570\u636e",id:"replication\u4e0d\u80fd\u540c\u6b65meta\u8868\u6570\u636e",level:4},{value:"\u5185\u5b58\u6d88\u8017",id:"\u5185\u5b58\u6d88\u8017",level:4},{value:"secondary region Failover",id:"secondary-region-failover",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:2},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:3},{value:"\u5efa\u8868",id:"\u5efa\u8868",level:3},{value:"Client",id:"client",level:3},{value:"Shell",id:"shell",level:4},{value:"Java",id:"java",level:4},{value:"\u6027\u80fd\u6d4b\u8bd5",id:"\u6027\u80fd\u6d4b\u8bd5",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u4f18\u70b9",id:"\u4f18\u70b9",level:3},{value:"\u7f3a\u70b9",id:"\u7f3a\u70b9",level:3},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2}],s={toc:g},m="wrapper";function d(e){let{components:t,...l}=e;return(0,r.kt)(m,(0,a.Z)({},s,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"\u80cc\u666f"},"\u80cc\u666f"),(0,r.kt)("p",null,"CAP\u539f\u7406\u4e2d\uff0c\u6307\u51fa\u5bf9\u4e8e\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u6765\u8bf4\uff0c\u4e0d\u53ef\u80fd\u540c\u65f6\u6ee1\u8db3\u4e00\u81f4\u6027 (Consistency)\u3001\u53ef\u7528\u6027\uff08Availability\uff09\u3001\u5206\u533a\u5bb9\u9519\u6027\uff08Partition tolerance\uff09\uff0c\u800cHBase\u5219\u88ab\u8bbe\u8ba1\u6210\u4e00\u4e2aCP\u7cfb\u7edf\uff0c\u4fdd\u8bc1\u4e86\u5f3a\u4e00\u81f4\u6027\u7684\u540c\u65f6\uff0c\u9009\u62e9\u727a\u7272\u4e86\u4e00\u5b9a\u7684\u53ef\u7528\u6027\u3002"),(0,r.kt)("p",null,"\u5728\u5bf9HBase\u7684\u538b\u6d4b\u4e2d\uff0c\u5f88\u5bb9\u6613\u53d1\u73b0\u867d\u7136HBase\u7684\u5e73\u5747\u8bfb\u5199\u5ef6\u8fdf\u5f88\u4f4e\uff0c\u4f46\u5374\u5b58\u5728\u5f88\u9ad8\u7684\u6bdb\u523a\uff0cP99\u3001P999\u5ef6\u8fdf\u5f88\u9ad8\uff0c\u4e3b\u8981\u7684\u4e00\u4e2a\u5f71\u54cd\u56e0\u7d20\u5219\u662f\u5355\u70b9\u7684GC\uff0c\u53e6\u5916Region\u7684MTTR\uff08\u5e73\u5747\u4fee\u590d\u65f6\u95f4\uff09\u4e5f\u8f83\u9ad8\uff0c\u4e00\u65e6\u67d0\u4e2aRegionServer\u5b95\u673a\u6216\u67d0\u4e2aRegion\u51fa\u73b0\u95ee\u9898\uff0c\u751a\u81f3\u662f\u4e00\u6b21Full GC\uff0c\u90fd\u6709\u53ef\u80fd\u51fa\u73b0\u8f83\u957f\u65f6\u95f4\u7684\u4e0d\u53ef\u7528\uff0c\u5f71\u54cd\u53ef\u7528\u6027\u3002"),(0,r.kt)("p",null,"HBase\u7684Read Region Replicas\u529f\u80fd\uff0c\u63d0\u4f9b\u4e00\u4e2a\u6216\u591a\u4e2a\u526f\u672c\uff0c\u5728region\u6062\u590d\u671f\u95f4\u6216\u8bf7\u6c42\u65f6\u95f4\u8fc7\u957f\u65f6\uff0c\u652f\u6301\u6700\u7ec8\u4e00\u81f4\u6027\u7684\u8bfb\u670d\u52a1\u3002\u5728\u4e00\u4e9b\u4e0d\u8981\u6c42\u5f3a\u4e00\u81f4\u6027\u7684\u5e94\u7528\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u529f\u80fd\u6765\u63d0\u9ad8\u53ef\u7528\u6027\u964d\u4f4e\u8bfb\u8bf7\u6c42\u5ef6\u8fdf\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u5b9e\u73b0\u9ad8\u53ef\u7528\u8bfb\uff0cHBase\u63d0\u4f9b\u4e86\u4e00\u4e2afeature\uff0c\u53eb",(0,r.kt)("inlineCode",{parentName:"p"},"region replication"),"\u3002\u5728\u8fd9\u79cd\u6a21\u578b\u4e0b\uff0c\u8868\u7684\u6bcf\u4e2aregion\uff0c\u90fd\u4f1a\u6709\u591a\u4e2a\u526f\u672c\uff0c\u5206\u5e03\u5728\u4e0d\u540c\u7684RegionServer\u4e0a\u3002\u9ed8\u8ba4region replication\u4e3a1\uff0c\u6b64\u65f6\u4e0e\u4e4b\u524d\u7684region\u6a21\u578b\u5e76\u65e0\u4e0d\u540c\u3002\u5f53region replication\u88ab\u8bbe\u7f6e\u4e3a2\u6216\u66f4\u591a\u65f6\uff0cMaster\u5c06\u4f1aassign\u6240\u6709region\u7684secondary region\uff0cLoad Balancer\u4f1a\u4fdd\u8bc1\u540c\u4e00\u4e2aregion\u7684\u591a\u4e2a\u5907\u4efd\u4f1a\u88ab\u5206\u6563\u5728\u4e0d\u540c\u7684RegionServer\u4e0a\u3002"),(0,r.kt)("p",null,"\u4e00\u4e2aregion\u7684\u6240\u6709\u526f\u672c\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684replica_id\u3002replica_id=0\u7684\u662fprimary region\uff08\u548c\u4e4b\u524d\u6a21\u578b\u4e2d\u552f\u4e00\u7684region\u4e00\u6837\uff09\uff0c\u5176\u4ed6\u7684\u526f\u672cregion\u88ab\u90fd\u53eb\u505asecondary region\u3002"),(0,r.kt)("p",null,"primary region\uff0c\u652f\u6301\u8bfb\u5199\u8bf7\u6c42\uff1bsecondary region\uff0c\u53ea\u652f\u6301\u8bfb\u8bf7\u6c42\u3002\u5982\u6b64\u8bbe\u8ba1\u4fdd\u8bc1primary region\u4f9d\u65e7\u5177\u6709\u5f3a\u4e00\u81f4\u6027\uff0c\u540c\u65f6\u63d0\u9ad8\u8bfb\u53ef\u7528\u6027\u3002\u4f46\u4e5f\u56e0\u4e3a\u5199\u8bf7\u6c42\u53ea\u6709primary region\u53ef\u4ee5\u5904\u7406\uff0c\u6240\u4ee5\u5199\u8bf7\u6c42\u4f9d\u7136\u4f1a\u56e0\u4e3aprimary region\u4e0d\u53ef\u7528\u800c\u88ab\u963b\u585e\uff0cHBase\u7684\u5199\u53ef\u7528\u6027\u4f9d\u7136\u6ca1\u6709\u5f97\u5230\u6539\u5584\u3002"),(0,r.kt)("h2",{id:"timeline-consistency"},"Timeline Consistency"),(0,r.kt)("p",null,"\u5728\u8be5\u529f\u80fd\u7684\u5b9e\u73b0\u4e2d\uff0cHBase\u63d0\u4f9b\u4e86\u4e00\u79cd\u652f\u6301",(0,r.kt)("strong",{parentName:"p"},"\u5355\u6b21\u8bfb\u8bf7\u6c42"),"\u7684\u4e00\u81f4\u6027\u5b9a\u4e49\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Java"},"public enum Consistency {\n    STRONG,\n    TIMELINE\n}\n")),(0,r.kt)("p",null,"HBase\u9ed8\u8ba4\u7684\u5c31\u662f",(0,r.kt)("inlineCode",{parentName:"p"},"Consistency.STRONG"),"\u5f3a\u4e00\u81f4\u6027\u6a21\u578b\uff0c\u4e0e\u4e4b\u524d\u7684\u6a21\u578b\u4e00\u6837\uff0c\u6240\u6709\u8bfb\u5199\u64cd\u4f5c\u90fd\u901aprimary region\u5b8c\u6210\u3002"),(0,r.kt)("p",null,"\u800c\u5f53client\u4f7f\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"Consistency.TIMELINE"),"\u7684\u4e00\u81f4\u6027\u53d1\u8d77\u8bfb\u8bf7\u6c42\u65f6\uff0c\u4f1a\u9996\u5148\u5411primary region\u53d1\u8d77\u8bf7\u6c42\uff0c\u4e00\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u8fd4\u56de\u54cd\u5e94\uff0c\u5219\u540c\u65f6\u5e76\u53d1\u5411\u6240\u6709\u7684secondary region\u53d1\u8d77\u8bf7\u6c42\uff0c\u6700\u7ec8\u91c7\u7528\u7387\u5148\u8fd4\u56de\u7684\u8bf7\u6c42\u3002\u4e3a\u4e86\u533a\u5206\u6700\u7ec8\u7684\u54cd\u5e94\u662f\u5426\u6765\u81easecondary region\uff0c\u5728",(0,r.kt)("inlineCode",{parentName:"p"},"Result"),"\u4e2d\u589e\u52a0\u4e86",(0,r.kt)("inlineCode",{parentName:"p"},"stale"),"\u7684boolean\u5c5e\u6027\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\u5219\u8868\u793a\u6765\u81easecondary region\u3002"),(0,r.kt)("p",null,"\u4ece\u8bed\u4e49\u4e0a\u8bb2\uff0cHBase\u7684TIMELINE\u4e00\u81f4\u6027\u5e76\u4e0d\u540c\u4e8e\u5e38\u89c1\u7684\u6700\u7ec8\u4e00\u81f4\u6027\u89e3\u51b3\u65b9\u6848\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5373\u4f7f\u5b58\u5728\u591a\u526f\u672c\uff0c\u4e5f\u4e0d\u9700\u8981\u8003\u8651\u526f\u672c\u4e4b\u95f4\u6570\u636e\u51b2\u7a81\u7684\u95ee\u9898\u3002"),(0,r.kt)("li",{parentName:"ul"},"secondary region\u63a5\u6536primary region\u540c\u6b65\u7684\u6570\u636e\uff0c\u6309\u540c\u6837\u987a\u5e8f\u5904\u7406\u6570\u636e\uff0c\u6240\u4ee5secondary region\u603b\u662fprimary region\u5728\u4e4b\u524d\u67d0\u4e2a\u65f6\u523b\u7684\u5feb\u7167\u3002\u4ece\u8fd9\u4e00\u70b9\u4e0a\u770b\uff0c\u66f4\u50cf\u662fRDBMS\uff08\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff09\u7684\u590d\u5236\u3001\u6216\u662fHBase\u591a\u6570\u636e\u4e2d\u5fc3\u591a\u96c6\u7fa4\u4e4b\u95f4\u7684\u590d\u5236\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u53e6\u4e00\u65b9\u9762\uff0cclient\u53ef\u4ee5\u81ea\u884c\u51b3\u5b9a\u662f\u5426\u9700\u8981\u8bfb\u53d6\u6700\u65b0\u6570\u636e\uff0c\u81ea\u884c\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e00\u79cd\u4e00\u81f4\u6027\u6765\u6ee1\u8db3\u529f\u80fd\u9700\u6c42\u3002"),(0,r.kt)("li",{parentName:"ul"},"client\u4f9d\u7136\u4f1a\u8bfb\u5230\u4e71\u5e8f\u7684\u6570\u636e\uff0c\u6bd4\u5982\u591a\u6b21\u8bf7\u6c42\u53d1\u5f80\u4e86\u4e0d\u540c\u7684region\u3002\u76ee\u524d\u5e76\u6ca1\u6709\u7c7b\u4f3c\u4e8e\u4e8b\u52a1\u7684\u4e1c\u897f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Timeline Consistency",src:n(2071).Z,width:"720",height:"540"})),(0,r.kt)("p",null,"\u6839\u636e\u4e0a\u56fe\u6211\u4eec\u6765\u66f4\u597d\u7684\u7406\u89e3TIMELINE\u7684\u8bed\u4e49\u3002\u9996\u5148client1\u6309\u987a\u5e8f\u5199\u4e86x=1,x=2,x=3\uff0cprimary region\u4e5f\u6309\u5199\u5165\u987a\u5e8f\u5904\u7406\uff0c\u5e76\u5c06WAL\u540c\u6b65\u7ed9\u5176\u4ed6secondary region\uff08\u4e00\u79cd\u6570\u636e\u540c\u6b65\u65b9\u5f0f\uff0c\u540e\u9762\u4f1a\u518d\u8bb2\uff09\u3002\u5728\u56fe\u4e2d\u6ce8\u610f\u5230\uff0creplica_1\u53ea\u63a5\u6536\u5230\u4e24\u6b21\u66f4\u65b0\uff0c\u6240\u4ee5\u6700\u7ec8\u6570\u636e\u662fx=2\uff0creplica_2\u53ea\u63a5\u6536\u52301\u6b21\u66f4\u65b0\uff0c\u6570\u636e\u662fx=1\u3002"),(0,r.kt)("p",null,"\u5982\u679cclient1\u4f7f\u7528STRONG\u4e00\u81f4\u6027\u6765\u8bfb\u6570\u636e\uff0c\u90fd\u53ea\u4f1a\u548cprimary region\u4ea4\u4e92\uff0c\u6570\u636e\u90fd\u662f\u6700\u65b0\u503cx=3\u3002\u53ef\u5982\u679c\u4f7f\u7528TIMELINE\u4e00\u81f4\u6027\u8bfb\u53d6\u6570\u636e\uff0c\u6709\u53ef\u80fd\u548c\u6240\u6709\u526f\u672c\u505a\u4ea4\u4e92\uff0c\u6700\u7ec8\u83b7\u5f97\u7684\u6570\u636e1\u30012\u30013\u90fd\u6709\u53ef\u80fd\u3002\u5982\u679cclient\u8bf7\u6c42\u591a\u6b21\uff0c\u751a\u81f3\u53ef\u80fd\u51fa\u73b0\u6570\u636e\u56de\u9000\uff0c\u5373\u7b2c1\u6b21\u8bf7\u6c42\u83b7\u5f97x=2\uff0c\u7b2c2\u6b21\u8bf7\u6c42\u5219\u83b7\u5f97\u4e86x=1\u3002"),(0,r.kt)("h2",{id:"\u5b9e\u73b0"},"\u5b9e\u73b0"),(0,r.kt)("h3",{id:"\u6570\u636e\u6a21\u578b"},"\u6570\u636e\u6a21\u578b"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"\u4e00\u4e2aregion replication\u4e3a2\u7684\u8868\u5728meta\u8868\u4e2d\u7684\u5217",src:n(7883).Z,title:"\u4e00\u4e2aregion replication\u4e3a2\u7684\u8868\u5728meta\u8868\u4e2d\u7684\u5217",width:"1150",height:"96"})),(0,r.kt)("p",null,"\u5728\u4e0a\u56fe\u4e2d\uff0c\u662f\u4e00\u4e2aregion replication\u4e3a2\u7684\u8868\u5728meta\u8868\u4e2dinfo\u5217\u65cf\u4e0b\u7684\u5217\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u4e00\u4e9b\u540d\u4e3ainfo:xxx_0001\u7684\u5217\uff0c\u8fd9\u4e9b\u5217\u5b58\u50a8\u7684\u6570\u636e\u5c31\u662freplica_id=1\u7684secondary region\u7684\u6570\u636e\u3002\u540c\u7406\uff0c\u5f53region\u7684\u5907\u4efd\u6570\u91cf\u66f4\u591a\u65f6\uff0cmeta\u8868\u4e2d\u540d\u4e3ainfo:xxx_0002\u3001info:xxx_0003\u7684\u5217\u5b58\u50a8\u7684\u5219\u4e3areplica_id\u4e3a2\u30013\u7684secondary region\u7684\u6570\u636e\u3002"),(0,r.kt)("p",null,"\u660e\u767d\u4e86meta\u8868\u4e2d\u662f\u5982\u4f55\u5b58\u50a8secondary region\u6570\u636e\uff0cclient\u8981\u83b7\u53d6secondary region\u6240\u5728\u7684RegionServer\u81ea\u7136\u4e5f\u7b80\u5355\uff0c\u591a\u89e3\u6790\u51e0\u4e2aserver_xxxx\u7684\u5217\u4fbf\u53ef\u4ee5\u4e86\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"client\u8bbf\u95eesecondary region",src:n(8369).Z,title:"client\u8bbf\u95eesecondary region",width:"547",height:"356"})),(0,r.kt)("p",null,"\u4e0a\u56fe\u5c55\u793a\u7684\u662fclient\u8bbf\u95eesecondary region\u7684\u793a\u610f\u56fe\u3002HBase\u7684\u8bfb\u8bf7\u6c42\u6709\u4e24\u79cd\uff0cGet\u548cScan\u3002\u5bf9\u4e8eGet\u8fd9\u79cd\u65e0\u72b6\u6001\u7684\u8bf7\u6c42\uff0c\u6bcf\u6b21RPC\u5bf9server\u7aef\u6765\u8bf4\u90fd\u662f\u4e00\u6b21\u72ec\u7acb\u7684\u8bf7\u6c42\u3002client\u7aef\u7684\u7528\u6237\u53ef\u4ee5\u591a\u6b21\u8d85\u65f6\u91cd\u8bd5\uff0c\u76f4\u5230\u83b7\u53d6\u5230\u6570\u636e\uff1b\u4e5f\u53ef\u4ee5\u5e76\u53d1\u8bf7\u6c42\u591a\u4e2areplica\uff0c\u9009\u62e9\u7387\u5148\u8fd4\u56de\u7684\u6570\u636e\uff1b\u8fd8\u53ef\u4ee5\u4f7f\u7528TIMELINE Read\uff0c\u8bf7\u6c42primary region\u8d85\u65f6\u4e4b\u540e\u518d\u8bf7\u6c42\u5176\u4ed6secondary region\u3002\u4f46\u5bf9\u4e8eScan\u8fd9\u79cd\u6709\u72b6\u6001\u7684\u8bf7\u6c42\uff0c\u4e00\u6b21scan\u53ef\u80fd\u4e0e\u540c\u4e00\u4e2aregion\u4ea4\u4e92\u591a\u6b21\uff0c\u4e5f\u53ef\u80fd\u8de8\u591a\u4e2aregion\u591a\u4e2aRegionServer\u8bf7\u6c42\u6570\u636e\uff0cserver\u7aef\u4f1a\u8bb0\u5f55\u6bcf\u4e2ascan\u7684\u72b6\u6001\u6570\u636e\uff0c\u90a3\u4e48\u4e00\u6b21scan\u4ea7\u751f\u7684\u591a\u6b21RPC\u4fbf\u4e0d\u80fd\u968f\u610f\u5730\u53d1\u7ed9\u6240\u6709\u7684replica\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"client scan\u8fc7\u7a0b",src:n(1914).Z,title:"client scan\u8fc7\u7a0b",width:"735",height:"344"})),(0,r.kt)("p",null,"\u4e0a\u56fe\u5c55\u793a\u7684\u662fclient\u6267\u884c\u4e00\u4e2a\u8de8region\u7684scan\u8fc7\u7a0b\uff0c\u5047\u8bbe\u5f53\u524d\u8868\u67092\u4e2a\u903b\u8f91region\uff08Region_A\u548cRegion_B\uff09\uff0cregion\u7684\u8d77\u59cb\u533a\u95f4\u5206\u522b\u4e3a[a, d)\u3001[d, f)\uff0c\u4e14\u8be5\u8868\u7684region replication\u4e3a2\uff0c\u5373\u6bcf\u4e2a\u903b\u8f91region\u90fd\u6709\u4e00\u4e3b\u4e00\u5907\uff0c4\u4e2aregion\u5206\u5e03\u57284\u4e2aRegionServer\u4e0a\u3002\u5f53\u6211\u4eec\u6267\u884c\u4e00\u6b21scan\u64cd\u4f5c\uff0c\u8bbe\u7f6ecacheing\u4e3a2\uff08\u6bcf\u6b21RPC\u6700\u591a\u83b7\u53d62\u4e2aResult\uff09\uff0c\u5219scan\u81f3\u5c11\u8fdb\u884c4\u6b21RPC\uff0c\u56fe\u4e2d\u8fde\u7ebf\u5219\u8868\u793a\u6bcf\u6b21RPC\uff0c\u8fde\u7ebf\u4e0a\u7684\u6570\u5b57\u8868\u793aRPC\u7684\u987a\u5e8f\u7f16\u53f7\uff0c\u865a\u7ebf\u8868\u793aRPC\u8d85\u65f6\u6216\u8fd4\u56de\u592a\u6162\u7ed3\u679c\u6ca1\u6709\u88ab\u91c7\u7528\u3002\u53ef\u4ee5\u770b\u5230\u5f53client\u8981\u8fdb\u884c\u7b2c1\u6b21RPC\u65f6\uff0c\u5c06\u8bf7\u6c42\u540c\u65f6\u53d1\u7ed9\u4e86Region_A\u7684\u4e3b\u59072\u4e2aregion\uff0c\u56e0\u4e3a\u6b64\u65f6server\u7aef\u662f\u6ca1\u6709\u4efb\u4f55\u5173\u4e8e\u6b64\u6b21scan\u7684\u72b6\u6001\u6570\u636e\uff0cclient\u53ef\u4ee5\u9009\u62e9\u7387\u5148\u8fd4\u56de\u54cd\u5e94\u7684region\u8fdb\u884c\u540e\u7eed\u7684RPC\u4ea4\u4e92\u3002\u5f53\u7b2c2\u6b21RPC\u65f6\u4fbf\u4e0d\u53ef\u4ee5\u968f\u610f\u9009\u62e9region\u4e86\uff0c\u56e0\u4e3aRegion_A_primary\u5b58\u50a8\u4e86\u6b64\u6b21scan\u7684\u72b6\u6001\u6570\u636e\uff0c\u800cRegion_A_replica_1\u6ca1\u6709\uff0c\u5982\u679c\u8bf7\u6c42Region_A_replica_1\u5219\u53ea\u4f1a\u629b\u51fa\u5f02\u5e38\u3002\u5f53\u7b2c2\u6b21RPC\u7ed3\u675f\uff0c\u5df2\u7ecf\u83b7\u53d6\u4e86Region_A\u4e2d\u7684\u5168\u90e8\u6570\u636e\uff0c\u4fbf\u53ef\u4ee5\u6e05\u7406\u6389Region_A_primary\u4e2d\u5b58\u50a8\u7684\u72b6\u6001\u6570\u636e\u4e86\u3002\u5f53\u7b2c3\u6b21RPC\u65f6\uff0c\u548c\u7b2c1\u6b21\u65f6\u60c5\u51b5\u6709\u4e9b\u7c7b\u4f3c\uff0cserver\u7aef\u6682\u65f6\u6ca1\u6709\u5b58\u50a8scan\u7684\u72b6\u6001\u6570\u636e\u4e86\uff0cclient\u4fbf\u53ef\u4ee5\u50cf\u7b2c1\u6b21RPC\u4e00\u6837\uff0c\u5c06\u8bf7\u6c42\u540c\u65f6\u53d1\u7ed9\u4e86Region_A\u7684\u4e3b\u59072\u4e2aregion\u3002\u7b2c4\u6b21RPC\u5219\u50cf\u7b2c2\u6b21\u4e00\u6837\u3002\u603b\u7ed3\u4e00\u4e0b\uff1a\u5f53scan\u8fdb\u884cTIMELINE Read\u65f6\uff0c\u53ea\u6709\u5bf9\u6bcf\u4e2a\u903b\u8f91region\u7684\u7b2c1\u6b21rpc\u53ef\u4ee5\u4efb\u610f\u9009\u62e9region\u8bf7\u6c42\u3002"),(0,r.kt)("p",null,"\u76ee\u524d\uff0cRead Region Replicas\u529f\u80fd\u5e76\u6ca1\u6709\u652f\u6301\u6279\u91cf\u8bf7\u6c42\uff0c\u5373\u6279\u91cfGet\u3001Scan\u90fd\u662f\u76f4\u63a5\u8bf7\u6c42primary region\u3002"),(0,r.kt)("h3",{id:"\u6570\u636e\u540c\u6b65"},"\u6570\u636e\u540c\u6b65"),(0,r.kt)("p",null,"secondary region\u8981\u652f\u6301\u8bfb\u8bf7\u6c42\uff0c\u5219\u5fc5\u7136\u8981\u6709\u6570\u636e\uff0c\u800csecondary region\u53c8\u4e0d\u652f\u6301\u5199\u8bf7\u6c42\uff0c\u90a3\u4e48\u6570\u636e\u662f\u54ea\u6765\u7684\u5462\uff1f"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"RegionServer \u5185\u90e8\u7ed3\u6784",src:n(4102).Z,title:"RegionServer \u5185\u90e8\u7ed3\u6784",width:"691",height:"369"})),(0,r.kt)("p",null,"\u4eceHBase\u7684\u6570\u636e\u6a21\u578b\u4e0a\u770b\uff0c\u6570\u636e\u4e3b\u8981\u5206\u4e3a\u4e24\u90e8\u5206\uff1aMemStore\u548cHFile\u3002HFile\u5b58\u50a8\u4e8eHDFS\u4e0a\uff0csecondary region\u53ea\u8981\u53ca\u65f6\u83b7\u77e5HFile\u7684\u53d8\u5316\u4fbf\u53ef\u4ee5\u83b7\u53d6\u3002\u4f46MemStore\u5b58\u5728\u4e8e\u5185\u5b58\uff0c\u5374\u53ea\u6709primary region\u6301\u6709\u3002\u4ee5\u4e0b\u4fbf\u4ecb\u7ecd\u4e24\u79cdsecondary region\u540c\u6b65\u6570\u636e\u7684\u65b9\u5f0f\u3002"),(0,r.kt)("h4",{id:"storefile-refresher"},"StoreFile Refresher"),(0,r.kt)("p",null,"\u7b2c\u4e00\u79cd\u65b9\u5f0f\u662fStoreFile Refresher\uff0c\u5728HBase-1.0+\u7248\u672c\u5f15\u5165\u3002\u5728RegionServer\u4e0a\u6709\u4e00\u4e2aStorefileRefresherChore\u4efb\u52a1\uff0c\u4f1a\u5b9a\u671f\u5730\u5728HDFS\u4e0a\u68c0\u67e5primary region\u7684HFile\u6709\u6ca1\u6709\u53d8\u5316\uff0c\u4ee5\u6b64\u6765\u53ca\u65f6\u7684\u53d1\u73b0primary region\u901a\u8fc7flush\u3001compact\u3001bulk load\u7b49\u64cd\u4f5c\u4ea7\u751f\u7684\u65b0HFile\u3002"),(0,r.kt)("p",null,"\u8be5\u65b9\u6848\u5b9e\u73b0\u4e0a\u8f83\u4e3a\u7b80\u5355\uff0c\u4e5f\u4e0d\u9700\u8981\u592a\u591a\u591a\u4f59\u7684\u5b58\u50a8\u548c\u7f51\u7edc\u5f00\u9500\uff0c\u4f46\u7f3a\u70b9\u4e5f\u975e\u5e38\u660e\u663e\uff0c\u5728\u6570\u636e\u5199\u5165primary region\uff0c\u5230secondary region\u53ef\u4ee5\u8bfb\u5230\u6570\u636e\uff0c\u6709\u76f8\u5f53\u957f\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u4e2d\u95f4\u9700\u8981\u7b49\u5f85memstore\u7684flush\u548cStorefileRefresherChore\u4efb\u52a1\u7684\u5b9a\u65f6\u5237\u65b0\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u8981\u5f00\u542f\u8fd9\u4e2a\u529f\u80fd\uff0c\u53ea\u8981\u5c06",(0,r.kt)("inlineCode",{parentName:"p"},"hbase.regionserver.storefile.refresh.period"),"\u914d\u7f6e\u8bbe\u7f6e\u4e3a\u975e\u96f6\u503c\u5373\u53ef\uff0c\u8868\u793aStorefileRefresherChore\u4efb\u52a1\u5237\u65b0\u7684\u65f6\u95f4\u95f4\u9694\u3002"),(0,r.kt)("h4",{id:"asynchronous-replication"},"Asynchronous Replication"),(0,r.kt)("p",null,"HBase\u6709\u63d0\u4f9b\u96c6\u7fa4\u95f4replication\u529f\u80fd\uff0c\u5229\u7528WAL\u5728\u591a\u4e2a\u96c6\u7fa4\u4e4b\u95f4\u540c\u6b65\u6570\u636e\u3002\u5728HBase-1.1+\u7248\u672c\u4e2d\uff0c\u4fbf\u5229\u7528replication\u5728\u96c6\u7fa4\u5185\u90e8\u540c\u6b65\u6570\u636e\uff0c\u5c06\u5b9e\u65f6\u5199\u5165\u7684WAL\u540c\u6b65\u5230secondary region\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Asynchronous Replication\u793a\u610f\u56fe",src:n(8026).Z,title:"Asynchronous Replication \u793a\u610f\u56fe",width:"552",height:"495"})),(0,r.kt)("p",null,"\u5982\u4e0a\u56fe\u4e2d\u6240\u793a\uff0c\u901a\u8fc7\u5b9e\u73b0\u4e00\u4e2a\u7279\u6b8a\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"ReplicationEndpoint"),"\u4fbf\u53ef\u4ee5\u5c06WAL\u7684\u6570\u636e\u540c\u6b65\u7ed9\u96c6\u7fa4\u4e2d\u7684\u5176\u4ed6RegionServer\u3002\u5982\u6b64primary region MemStore\u4e2d\u7684\u6570\u636e\uff0c\u4e5f\u901a\u8fc7replication\u5b9e\u65f6\u540c\u6b65\u5230secondary region\uff0c\u4ecesecondary region\u4e2d\u4e5f\u53ef\u4ee5\u8bfb\u5230primary region\u8fd8\u6ca1\u6709flush\u5230HFile\u7684\u6570\u636e\u3002\u6240\u4ee5\u5229\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"Asnyc WAL replication"),"\u7684\u540c\u6b65\u65b9\u5f0f\u6bd4\u4e0a\u9762\u8bb2\u5230\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"StoreFile Refresher"),"\u540c\u6b65\u65b9\u5f0f\u5177\u6709\u66f4\u4f4e\u7684\u540c\u6b65\u5ef6\u8fdf\u3002"),(0,r.kt)("p",null,"primary region\u8fd8\u4f1a\u5c06flush\u3001compaction\u548cbulk load\u4e8b\u4ef6\u5199\u5230WAL\uff0c\u540c\u6837\u7531replication\u529f\u80fd\u540c\u6b65\u5230secondary region\u3002\u5f53secondary region\u63a5\u6536\u5230\u8fd9\u4e9b\u4e8b\u4ef6\u65f6\uff0c\u4fbf\u4e5f\u56de\u653e\u540c\u6837\u7684\u4e8b\u4ef6\u6765\u66f4\u65b0\u81ea\u5df1\u7684\u6570\u636e\u3002\u6240\u4ee5\u5bf9HFile\u6587\u4ef6\u5217\u8868\u7684\u66f4\u65b0\u4e5f\u6bd4",(0,r.kt)("inlineCode",{parentName:"p"},"StoreFile Refresher"),"\u5b9a\u65f6\u5237\u65b0\u7684\u65b9\u5f0f\u66f4\u52a0\u5b9e\u65f6\u3002"),(0,r.kt)("p",null,"\u5728\u8fd9\u79cd\u540c\u6b65\u6a21\u5f0f\u4e0b\uff0csecondary region\u7684MemStore\u4e2d\u4e5f\u662f\u6709\u6570\u636e\uff0c\u4eceWAL\u540c\u6b65\u7684Put/Delete\u64cd\u4f5c\u5c31pPrimaryrRegion\u4e00\u6837\u5199\u5165MemStore\uff0c\u5e76\u4e14secondary region\u4e5f\u4f1a\u4f7f\u7528block cache\uff0c\u6240\u4ee5\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e2d\u5185\u5b58\u7684\u5f00\u9500\u4f1a\u6210\u500d\u7684\u589e\u957f\u3002\u4e0d\u540c\u4e8eprimary region\u7684\u662f\uff0csecondary region\u5728\u63a5\u6536\u5230flush\u4e8b\u4ef6\u65f6\uff0c\u5e76\u4e0d\u4f1a\u5c06MemStore\u4e2d\u7684\u6570\u636eflush\u6210HFile\uff0c\u53ea\u4f1a\u91ca\u653e\u6389MemStore\u5360\u7528\u7684\u5185\u5b58\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Asnyc WAL replication"),"\u529f\u80fd\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\u3002\u9700\u8981\u8bbe\u7f6e",(0,r.kt)("inlineCode",{parentName:"p"},"hbase.region.replica.replication.enabled"),"\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"\u6765\u6253\u5f00\u8fd9\u4e2a\u529f\u80fd\u3002\u5f53\u7b2c\u4e00\u6b21\u521b\u5efa\u4e00\u4e2aregion replication\u5927\u4e8e1\u7684\u8868\u65f6\uff0c\u5c06\u4f1a\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"region_replica_replication"),"\u7684replication peer\uff0c\u8fd9\u4e2areplication peer\u5c06\u8d1f\u8d23\u96c6\u7fa4\u5185\u6240\u6709\u8868region replica\u7684\u6570\u636e\u540c\u6b65\u3002\u4e00\u65e6\u5f00\u542f\u4e4b\u540e\u60f3\u8981\u518d\u5173\u95ed\u8be5\u529f\u80fd\uff0c\u5c31\u4e0d\u53ea\u662f\u6539",(0,r.kt)("inlineCode",{parentName:"p"},"hbase.region.replica.replication.enabled"),"\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"false"),"\u4e86\uff0c\u8fd8\u9700\u8981disable\u6389",(0,r.kt)("inlineCode",{parentName:"p"},"region_replica_replication"),"\u8fd9\u4e2areplication peer\u3002"),(0,r.kt)("h3",{id:"\u5b58\u5728\u7684\u95ee\u9898"},"\u5b58\u5728\u7684\u95ee\u9898"),(0,r.kt)("h4",{id:"hfile\u7684\u8fc7\u671f\u65f6\u95f4"},"HFile\u7684\u8fc7\u671f\u65f6\u95f4"),(0,r.kt)("p",null,"\u5728\u4ee5\u4e0a\u4e24\u79cd\u6570\u636e\u540c\u6b65\u65b9\u5f0f\u4e2d\uff0c\u90fd\u4f1a\u5728\u591a\u4e2aRegionServer\u4e0a\u6253\u5f00\u540c\u4e00\u4e2aHFile\uff0c\u6240\u4ee5\u5f53primary region\u8fdb\u884c\u5b8c\u4e86major compaction\u4e4b\u540e\uff0csecondary region\u56e0\u4e3aHFile\u6587\u4ef6\u53d8\u5316\u66f4\u65b0\u4e0d\u53ca\u65f6\uff0c\u4f9d\u65e7\u5f15\u7528\u7740\u65e7\u7684HFile\u3002\u76ee\u524d\u5e76\u6ca1\u6709\u6709\u6548\u7684\u63aa\u65bd\u4fdd\u8bc1HFile\u6587\u4ef6\u5e76\u4e0d\u4f1a\u88ab\u8fc7\u65e9\u7684\u5220\u9664\u3002\u53ea\u80fd\u662f\u5c06\u914d\u7f6e\u9879",(0,r.kt)("inlineCode",{parentName:"p"},"hbase.master.hfilecleaner.ttl"),"\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u8f83\u5927\u7684\u503c\uff0c\u6bd4\u5982\u4e00\u5c0f\u65f6\uff0c\u4ee5\u6b64\u6765\u5c3d\u91cf\u907f\u514d\u8bf7\u6c42\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u51fa\u9519\u3002\u4f46\u540c\u65f6\u4e5f\u4f1a\u589e\u52a0HDFS\u7684\u5b58\u50a8\u5f00\u9500\u3002"),(0,r.kt)("h4",{id:"replication\u4e0d\u80fd\u540c\u6b65meta\u8868\u6570\u636e"},"replication\u4e0d\u80fd\u540c\u6b65meta\u8868\u6570\u636e"),(0,r.kt)("p",null,"\u76ee\u524d\u7684Asynchronous Replication\u529f\u80fd\u5e76\u4e0d\u80fd\u540c\u6b65meta\u8868\u7684WAL\u6570\u636e\uff08\u6700\u521d\u8be5\u529f\u80fd\u662f\u7528\u4e8e\u96c6\u7fa4\u95f4\u540c\u6b65\u6570\u636e\u7684\uff0c\u6bd5\u7adf\u4e0d\u80fd\u628ameta\u6570\u636e\u540c\u6b65\u7ed9\u5176\u4ed6\u96c6\u7fa4\uff09\u3002\u6240\u4ee5\u5bf9\u4e8emeta\u8868\u7684\u64cd\u4f5c\uff0c\u5e76\u4e0d\u80fd\u901a\u8fc7replication\u5c3d\u5feb\u7684\u540c\u6b65\u5230secondary region\uff0c\u53ea\u80fd\u901a\u8fc7\u7c7b\u4f3c\u4e8e",(0,r.kt)("inlineCode",{parentName:"p"},"StoreFile Refresher"),"\u7684\u65b9\u5f0f\uff0c\u4f7f\u7528\u5b9a\u65f6\u5237\u65b0\u7684\u4efb\u52a1\u6765\u540c\u6b65meta\u8868HFile\u6587\u4ef6\u7684\u53d8\u5316\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"hbase.regionserver.meta.storefile.refresh.period"),"\u914d\u7f6e\u9879\u7528\u4e8e\u63a7\u5236meta\u8868StoreFile\u7684\u66f4\u65b0\u65f6\u95f4\u3002\u8be5\u914d\u7f6e\u9879\u5e76\u4e0d\u540c\u4e8e",(0,r.kt)("inlineCode",{parentName:"p"},"StoreFile Refresher"),"\u529f\u80fd\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"hbase.regionserver.storefile.refresh.period"),"\u3002"),(0,r.kt)("h4",{id:"\u5185\u5b58\u6d88\u8017"},"\u5185\u5b58\u6d88\u8017"),(0,r.kt)("p",null,"\u5728\u4e4b\u524d\u5df2\u7ecf\u63d0\u5230\uff0cAsynchronous Replication\u540c\u6b65\u56e0\u4e3a\u4f7f\u7528MemStore\u548cblock cache\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u5f00\u9500\u6210\u500d\u589e\u52a0\u3002\u5e76\u4e14secondary region\u5e76\u4e0d\u4f1a\u4e3b\u52a8\u8fdb\u884cflush\uff0c\u53ea\u4f1a\u5f53\u63a5\u6536\u5230\u540c\u6b65\u7684WAL\u4e2d\u7684flush\u4e8b\u4ef6\u65f6\uff0c\u624d\u4f1a\u8fdb\u884cflush\u3002\u5728\u4e00\u4e9b\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u6bd4\u5982replication\u963b\u585e\u6536\u4e0d\u5230flush\u4e8b\u4ef6\u3001primary region\u786e\u5b9e\u957f\u65f6\u95f4\u6ca1\u6709\u8fdb\u884cflushsecondaryarRegion\u6301\u6709\u7684\u5185\u5b58\u5f97\u4e0d\u5230\u91ca\u653e\uff0c\u800c\u4e00\u4e2aRegionServer\u4e0a\u540c\u65f6\u6709\u591a\u4e2aprimary region\u548csecondary region\uff0c\u5185\u5b58\u7684\u8fc7\u5ea6\u6d88\u8017\u53ef\u80fd\u4f1a\u963b\u585eprimary region\u6b63\u5e38\u7684\u5199\u5165\u64cd\u4f5c\uff0c\u4e5f\u4f1a\u963b\u585ereplication\u540c\u6b65\u7684flush\u4e8b\u4ef6\u3002"),(0,r.kt)("p",null,"\u6240\u4ee5HBase\u63d0\u4f9b\u4e86\u4e00\u4e2a\u914d\u7f6e\u9879",(0,r.kt)("inlineCode",{parentName:"p"},"hbase.region.replica.storefile.refresh.memstore.multiplier"),"\uff0c\u9ed8\u8ba4\u503c\u4e3a4\uff0c\u8868\u793a\u5982\u679csecondary region\u7684MemStore\u6bd4primary region\u6700\u5927\u7684MemStore\u76844\u500d\u8fd8\u8981\u5927\u65f6\uff0c\u4fbf\u5141secondaryarRegion\u81ea\u884crefresh\u68c0\u67e5HFile\u6587\u4ef6\u662f\u5426\u53d8\u5316\uff0c\u5982\u679cprimary region\u65e9\u5df2flush\u8fc7\uff0c\u5374\u56e0\u4e3areplication\u963b\u585e\u6ca1\u6709\u540c\u6b65\u5230\uff0c\u5219\u53ef\u4ee5\u5229\u7528\u8be5\u673a\u5236\u8fdb\u884cflush\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6700\u597d\u4e0d\u8981\u6267\u884c\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u53ef\u4ee5\u628a\u8be5\u914d\u7f6e\u9879\u8bbe\u7f6e\u5927\u4e00\u4e9b\u6765\u907f\u514d\u3002"),(0,r.kt)("h4",{id:"secondary-region-failover"},"secondary region Failover"),(0,r.kt)("p",null,"\u5f53\u4e00\u4e2asecondary region\u521aopen\u6216\u8005fail over\uff0c\u6b64\u65f6\u5fc5\u7136\u4e22\u5931\u4e86\u4e4b\u524dMemStore\u7684\u6570\u636e\uff0c\u56e0\u4e3asecondary region\u6bd5\u7adf\u4e0d\u80fd\u50cfprimary region\u4e00\u6837\u901a\u8fc7\u56de\u653eWAL\u6765\u6062\u590dMemStore\u3002\u5982\u679c\u6b64\u65f6\u76f4\u63a5\u63d0\u4f9b\u8bfb\u670d\u52a1\uff0c\u5219\u53ef\u80fd\u51fa\u73b0\u6570\u636e\u7248\u672c\u56de\u9000\u7684\u95ee\u9898\uff0c\u5373\u6062\u590d\u4e4b\u540e\u6bd4\u6062\u590d\u4e4b\u524d\u8bfb\u5230\u7684\u6570\u636e\u66f4\u65e7\u3002\u4e3a\u4e86\u907f\u514d\u6570\u636e\u56de\u9000\uff0csecondary region\u5c31\u5fc5\u987b\u7b49\u5f85primary region\u8fdb\u884c\u4e00\u6b21\u5b8c\u6574\u7684flush\u64cd\u4f5c\u6216open region\u4e8b\u4ef6\uff0c\u5728\u8fd9\u4e4b\u524d\uff0csecondary region\u90fd\u5c06\u62d2\u7edd\u63a5\u670d\u52a1\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"hbase.region.replica.wait.for.primary.flush"),"\u914d\u7f6e\u9879\u662f\u8be5\u673a\u5236\u7684\u5f00\u5173\uff0c\u9ed8\u8ba4\u662f",(0,r.kt)("inlineCode",{parentName:"p"},"enable"),"\u5f00\u542f\u3002"),(0,r.kt)("h2",{id:"\u4f7f\u7528"},"\u4f7f\u7528"),(0,r.kt)("h3",{id:"\u914d\u7f6e"},"\u914d\u7f6e"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"server\u7aef")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u914d\u7f6e\u9879"),(0,r.kt)("th",{parentName:"tr",align:null},"\u9ed8\u8ba4\u503c"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5355\u4f4d"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.regionserver.storefile.refresh.period"),(0,r.kt)("td",{parentName:"tr",align:null},"0"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6beb\u79d2"),(0,r.kt)("td",{parentName:"tr",align:null},"secondary region\u5237\u65b0storefile\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba40\u4e3a\u5173\u95ed")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.regionserver.meta.storefile.refresh.period"),(0,r.kt)("td",{parentName:"tr",align:null},"0"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6beb\u79d2"),(0,r.kt)("td",{parentName:"tr",align:null},"secondary region\u5237\u65b0hbase:meta\u8868storefile\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba40\u4e3a\u5173\u95ed")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.region.replica.replication.enabled"),(0,r.kt)("td",{parentName:"tr",align:null},"false"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f\u5426\u5f00\u542f",(0,r.kt)("inlineCode",{parentName:"td"},"Asnyc WAL replication"),"\u529f\u80fd\uff0c\u5f00\u542f\u540e\u518d\u60f3\u5173\u95ed\uff0c\u9700\u8981\u6539\u4e3afalse\u4e4b\u540e\u518ddisable\u6389",(0,r.kt)("inlineCode",{parentName:"td"},"region_replica_replication"),"\u7684peer")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.master.hfilecleaner.ttl"),(0,r.kt)("td",{parentName:"tr",align:null},"300000(5\u5206\u949f)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6beb\u79d2"),(0,r.kt)("td",{parentName:"tr",align:null},"storefile\u6587\u4ef6\u7684\u8fc7\u671f\u5220\u9664\u65f6\u95f4\u95f4\u9694")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.meta.replica.count"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e2a"),(0,r.kt)("td",{parentName:"tr",align:null},"meta\u8868\u7684region replication\u6570\u91cf")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.region.replica.storefile.refresh.memstore.multiplier"),(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"\u500d"),(0,r.kt)("td",{parentName:"tr",align:null},"secondary region\u7684MemStore\u5927\u4e8e\u540cRegionServer\u4e0aprimary region\u6700\u5927\u7684MemStore\u8be5\u500d\u6570\u65f6\uff0c\u4f1a\u89e6\u53d1\u5237\u65b0storefile\u6587\u4ef6\u5217\u8868\u7684\u4efb\u52a1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.region.replica.wait.for.primary.flush"),(0,r.kt)("td",{parentName:"tr",align:null},"true"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"secondary region open\u4e4b\u540e\uff0c\u662f\u5426\u8981\u7b49\u5f85primary region\u8fdb\u884c\u4e00\u6b21flush\u518d\u63d0\u4f9b\u670d\u52a1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.master.loadbalancer.class"),(0,r.kt)("td",{parentName:"tr",align:null},"org.apache.hadoop.hbase.master.balancer.StochasticLoadBalancer"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u9ed8\u8ba4\u7684\u5b9e\u73b0\u53ef\u4ee5\u4fdd\u8bc1region\u7684replicas\u5c3d\u91cf\u4e0d\u4f1a\u5206\u5e03\u5728\u540c\u4e00\u4e2aRegionServer\u4e0a\uff0c\u5982\u679c\u4fee\u6539\u8be5\u914d\u7f6e\uff0c\u8981\u6ce8\u610freplicas\u7684\u5206\u5e03")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"client\u7aef")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u914d\u7f6e\u9879"),(0,r.kt)("th",{parentName:"tr",align:null},"\u9ed8\u8ba4\u503c"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5355\u4f4d"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.ipc.client.specificThreadForWriting"),(0,r.kt)("td",{parentName:"tr",align:null},"false"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f\u5426\u4f7f\u7528\u7279\u6b8a\u7ebf\u7a0b\u7528\u4e8e\u5199\u8bf7\u6c42\u3002\u4f7f\u7528region replicas\u529f\u80fd\uff0c\u7ecf\u5e38\u4f1a\u5728IO\u8fc7\u7a0b\u4e2d\u4e2d\u65ad\u7ebf\u7a0b\uff0c\u6240\u4ee5\u5fc5\u987b\u5f00\u542f\u8be5\u914d\u7f6e")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.client.primaryCallTimeout.get"),(0,r.kt)("td",{parentName:"tr",align:null},"10000"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5fae\u79d2"),(0,r.kt)("td",{parentName:"tr",align:null},"TIMELINE\u4e00\u81f4\u6027Get\u65f6\uff0c\u7b49\u5f85primary region\u54cd\u5e94\u7684\u65f6\u95f4\uff0c\u8d85\u65f6\u4e4b\u540e\u4fbf\u8bf7\u6c42secondary region")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.client.primaryCallTimeout.scan"),(0,r.kt)("td",{parentName:"tr",align:null},"10000"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5fae\u79d2"),(0,r.kt)("td",{parentName:"tr",align:null},"TIMELINE\u4e00\u81f4\u6027Scan\u65f6\uff0c\u7b49\u5f85primary region\u54cd\u5e94\u7684\u65f6\u95f4\uff0c\u8d85\u65f6\u4e4b\u540e\u4fbf\u8bf7\u6c42secondary region")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hbase.meta.replicas.use"),(0,r.kt)("td",{parentName:"tr",align:null},"false"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u662f\u5426\u4f7f\u7528meta\u8868\u7684secondary region")))),(0,r.kt)("h3",{id:"\u5efa\u8868"},"\u5efa\u8868"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"REGION_REPLICATION"),"\u53c2\u6570\u63a7\u5236\u8868\u4e2dregion\u6709\u591a\u5c11\u5907\u4efd\uff0c\u9ed8\u8ba4\u503c\u4e3a1\uff0c\u5373\u53ea\u6709primary region\u3002"),(0,r.kt)("p",null,"shell\u65b9\u5f0f\u5efa\u8868"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"create 't1', 'f1', {REGION_REPLICATION => 2}\n")),(0,r.kt)("p",null,"shell\u65b9\u5f0f\u4fee\u6539\u8868"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"alter 't1', {REGION_REPLICATION => 2}\n")),(0,r.kt)("h3",{id:"client"},"Client"),(0,r.kt)("p",null,"Client\u8bbf\u95eesecondary region\u5fc5\u987b\u8981\u7528\u6237\u660e\u786e\u7684\u8868\u793a\u53ef\u4ee5\u63a5\u6536\u975e\u5f3a\u4e00\u81f4\u6027\u7684\u6570\u636e\uff0c\u5982\u679c\u5e0c\u671b\u8bf7\u6c42\u53ef\u4ee5\u53d1\u9001\u7ed9secondary region\uff0c\u5fc5\u987b\u660e\u786e\u6307\u5b9a\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"TIMELINE"),"\u7684\u4e00\u81f4\u6027\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Java"},"public enum Consistency {\n    STRONG,\n    TIMELINE\n}\n")),(0,r.kt)("h4",{id:"shell"},"Shell"),(0,r.kt)("p",null,"\u5141\u8bb8\u4ee5",(0,r.kt)("inlineCode",{parentName:"p"},"TIMELINE"),"\u7684\u4e00\u81f4\u6027\u8bfb\u53d6\u6570\u636e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"hbase(main):001:0> get 't1','r6', {CONSISTENCY => \"TIMELINE\"}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"hbase(main):001:0> get 't1','r6', {CONSISTENCY => \"TIMELINE\", , REGION_REPLICA_ID => 1}\n")),(0,r.kt)("h4",{id:"java"},"Java"),(0,r.kt)("p",null,"Get"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Java"},"Get get = new Get(row);\nget.setConsistency(Consistency.TIMELINE);\n...\nResult result = table.get(get);\n")),(0,r.kt)("p",null,"Scan"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Java"},"Scan scan = new Scan();\nscan.setConsistency(Consistency.TIMELINE);\n...\nResultScanner scanner = table.getScanner(scan);\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7",(0,r.kt)("inlineCode",{parentName:"p"},"Result.isStale()"),"\u5224\u65ad\u6570\u636e\u662f\u5426\u6765\u81ea\u4e8esecondary region"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Java"},"Result result = table.get(get);\nif (result.isStale()) {\n  ...\n}\n")),(0,r.kt)("h2",{id:"\u6027\u80fd\u6d4b\u8bd5"},"\u6027\u80fd\u6d4b\u8bd5"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u673a\u5668\u914d\u7f6e")),(0,r.kt)("p",null,"HBase\u7248\u672c\uff1a2.2.0\nHDFS\u7248\u672c\uff1a 3.1.4"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"service"),(0,r.kt)("th",{parentName:"tr",align:null},"job"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5b9e\u4f8b\u6570"),(0,r.kt)("th",{parentName:"tr",align:null},"cpu"),(0,r.kt)("th",{parentName:"tr",align:null},"disk"),(0,r.kt)("th",{parentName:"tr",align:null},"netowork"),(0,r.kt)("th",{parentName:"tr",align:null},"comment"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"HBase"),(0,r.kt)("td",{parentName:"tr",align:null},"master"),(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"HBase"),(0,r.kt)("td",{parentName:"tr",align:null},"region server"),(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"24 core"),(0,r.kt)("td",{parentName:"tr",align:null},"12*3.7T HDD"),(0,r.kt)("td",{parentName:"tr",align:null},"10000bps"),(0,r.kt)("td",{parentName:"tr",align:null},"onheap=50g/offheap=50g")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"HDFS"),(0,r.kt)("td",{parentName:"tr",align:null},"namenode"),(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"onheap=10g")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"HDFS"),(0,r.kt)("td",{parentName:"tr",align:null},"datanode"),(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"24 core"),(0,r.kt)("td",{parentName:"tr",align:null},"12*3.7T HDD"),(0,r.kt)("td",{parentName:"tr",align:null},"10000bps"),(0,r.kt)("td",{parentName:"tr",align:null},"onheap=2g")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u9650\u5236QPS")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null},"strong"),(0,r.kt)("th",{parentName:"tr",align:null},"timeline-10ms"),(0,r.kt)("th",{parentName:"tr",align:null},"reta"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"qps_sec"),(0,r.kt)("td",{parentName:"tr",align:null},"12608.23"),(0,r.kt)("td",{parentName:"tr",align:null},"11171.18"),(0,r.kt)("td",{parentName:"tr",align:null},"-11.4%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"max_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"195174.38"),(0,r.kt)("td",{parentName:"tr",align:null},"202603.69"),(0,r.kt)("td",{parentName:"tr",align:null},"3.81%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"min_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"149.38"),(0,r.kt)("td",{parentName:"tr",align:null},"148.75"),(0,r.kt)("td",{parentName:"tr",align:null},"-0.42%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"avg_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"3760.69"),(0,r.kt)("td",{parentName:"tr",align:null},"4276.76"),(0,r.kt)("td",{parentName:"tr",align:null},"13.72%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"p90_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"11811.92"),(0,r.kt)("td",{parentName:"tr",align:null},"14258.31"),(0,r.kt)("td",{parentName:"tr",align:null},"20.71%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"p99_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"32512.23"),(0,r.kt)("td",{parentName:"tr",align:null},"31148.14"),(0,r.kt)("td",{parentName:"tr",align:null},"-4.2%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"p999_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"64646.38"),(0,r.kt)("td",{parentName:"tr",align:null},"58621.93"),(0,r.kt)("td",{parentName:"tr",align:null},"-9.32%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"p9999_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"136835.92"),(0,r.kt)("td",{parentName:"tr",align:null},"115951.63"),(0,r.kt)("td",{parentName:"tr",align:null},"-15.26%")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u9650\u52367000QPS")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null},"strong"),(0,r.kt)("th",{parentName:"tr",align:null},"timeline-10ms"),(0,r.kt)("th",{parentName:"tr",align:null},"reta"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"qps_sec"),(0,r.kt)("td",{parentName:"tr",align:null},"6999.58"),(0,r.kt)("td",{parentName:"tr",align:null},"6999.56"),(0,r.kt)("td",{parentName:"tr",align:null},"-0.0%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"max_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"126860.75"),(0,r.kt)("td",{parentName:"tr",align:null},"130148.86"),(0,r.kt)("td",{parentName:"tr",align:null},"2.59%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"min_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"147.25"),(0,r.kt)("td",{parentName:"tr",align:null},"150.68"),(0,r.kt)("td",{parentName:"tr",align:null},"2.33%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"avg_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"3223.38"),(0,r.kt)("td",{parentName:"tr",align:null},"3495.51"),(0,r.kt)("td",{parentName:"tr",align:null},"8.44%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"p90_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"10612.49"),(0,r.kt)("td",{parentName:"tr",align:null},"11379.48"),(0,r.kt)("td",{parentName:"tr",align:null},"7.23%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"p99_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"23793.54"),(0,r.kt)("td",{parentName:"tr",align:null},"24469.25"),(0,r.kt)("td",{parentName:"tr",align:null},"2.84%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"p999_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"48791.00"),(0,r.kt)("td",{parentName:"tr",align:null},"39795.06"),(0,r.kt)("td",{parentName:"tr",align:null},"-18.44%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"p9999_latency_us"),(0,r.kt)("td",{parentName:"tr",align:null},"93389.08"),(0,r.kt)("td",{parentName:"tr",align:null},"78618.61"),(0,r.kt)("td",{parentName:"tr",align:null},"-15.82%")))),(0,r.kt)("p",null,"\u5bf9\u5355Client\u5b9e\u4f8b\u505a\u538b\u529b\u6d4b\u8bd5\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"hbase.client.primaryCallTimeout.get"),"\u53c2\u6570\u8bbe\u7f6e\u4e3a10000\uff0c\u5373\u7b49\u5f85primary region\u54cd\u5e94\u7684\u65f6\u95f4\u8d85\u65f610ms\u4e4b\u540e\u4fbf\u8bf7\u6c42secondary region\u3002"),(0,r.kt)("p",null,"\u7b2c\u4e00\u7ec4\u6781\u9650QPS\u7684\u538b\u6d4b\u4e2d\uff0c\u53ef\u4ee5\u770b\u51fa\u5f00\u542fTIMELINE Read\u4e4b\u540e\uff0cQPS\u6709\u4e00\u5b9a\u635f\u5931\uff0c\u5e73\u5747\u5ef6\u8fdf\u6709\u4e00\u5b9a\u5347\u9ad8\uff0cP999\u548cP9999\u4e00\u5b9a\u7a0b\u5ea6\u4f18\u5316\u3002\u4f18\u5316\u6548\u679c\u6709\u9650\u3002"),(0,r.kt)("p",null,"\u56e0\u4e3aread replicas\u4f1a\u589e\u52a0\u7ebf\u7a0b\u8d44\u6e90\u7684\u4f7f\u7528\uff0c\u800c\u65e5\u5e38\u4f7f\u7528\u4e5f\u4e0d\u4f1a\u628aClient\u4fa7\u538b\u5230\u6781\u9650\uff0c\u6240\u4ee5\u53c8\u505a\u4e86\u4e00\u7ec4\u9650\u5236QPS\u7684\u538b\u6d4b\uff0c\u53ef\u4ee5\u770b\u5230\u5404\u9879\u5ef6\u8fdf\u6307\u6807\u5747\u6709\u6240\u597d\u8f6c\u3002"),(0,r.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Region Replica"),"\u529f\u80fd\u53ef\u4ee5\u63d0\u9ad8HBase\u7684\u8bfb\u53ef\u7528\u6027\uff0c\u4f46\u4e5f\u8981\u6839\u636e\u5177\u4f53\u7684\u7528\u4f8b\u8003\u8651\u662f\u5426\u9002\u7528\u3002"),(0,r.kt)("h3",{id:"\u4f18\u70b9"},"\u4f18\u70b9"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u5e94\u7528\u4f9d\u8d56\u662f\u53ea\u8bfb\u7684\u8868\uff0c\u6216\u8005\u5e94\u7528\u5e76\u4e0d\u8981\u6c42\u5f3a\u4e00\u81f4\u6027\uff08\u8981\u6c42\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u53ef\u4ee5\u63a5\u53d7\u77ed\u65f6\u95f4\u5185\u6570\u636e\u4e0d\u4e00\u81f4\uff09\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u529f\u80fd\u6765\u63d0\u9ad8\u8bfb\u53ef\u7528\u6027\u3002\u5728RegionServer\u6216Region\u51fa\u73b0\u5355\u70b9\u6545\u969c\u6062\u590d\u671f\u95f4\u6216\u957f\u65f6\u95f4Full GC\u671f\u95f4\u5c3d\u91cf\u4fdd\u8bc1\u4e1a\u52a1\u8bfb\u8bf7\u6c42\u6b63\u5e38\uff0c\u51cf\u5c11MTTR\u8fc7\u957f\u5bf9\u4e1a\u52a1\u4ea7\u751f\u7684\u5f71\u54cd\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u51cf\u5c11\u5927\u91cf\u91cd\u8bd5\u8bf7\u6c42\u8fdb\u4e00\u6b65\u5730\u589e\u52a0\u6545\u969c\u8282\u70b9\u7684\u538b\u529b\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u90e8\u5206\u4e0d\u8981\u6c42\u5f3a\u4e00\u81f4\u6027\u4e14\u5bf9\u5ef6\u8fdf\u6bdb\u523a\u6709\u4e00\u5b9a\u8981\u6c42\u7684\u5e94\u7528\uff0c\u5f53\u5728Client\u4fa7QPS\u8f83\u4f4e\u6216CPU\u3001\u5e26\u5bbd\u7b49\u8d44\u6e90\u5bcc\u4f59\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u529f\u80fd\u964d\u4f4e\u8bfb\u8bf7\u6c42P99/P999\u548cP9999\u5ef6\u8fdf\u3002")),(0,r.kt)("h3",{id:"\u7f3a\u70b9"},"\u7f3a\u70b9"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u591a\u500d\u7684MemStore\u5bfc\u81f4\u66f4\u591a\u7684\u5185\u5b58\u6d88\u8017"),(0,r.kt)("li",{parentName:"ul"},"\u589e\u52a0block cache\u7684\u9700\u6c42\u548c\u4f7f\u7528"),(0,r.kt)("li",{parentName:"ul"},"\u4e3a\u4e86\u4f20\u8f93WAL\u5bfc\u81f4\u66f4\u591a\u7684\u7f51\u7edc\u5e26\u5bbd\u6d88\u8017"),(0,r.kt)("li",{parentName:"ul"},"\u5927\u91cf\u7684\u96c6\u7fa4\u5185\u90e8RPC\u8bf7\u6c42")),(0,r.kt)("h2",{id:"\u53c2\u8003"},"\u53c2\u8003"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://hbase.apache.org/book.html#arch.timelineconsistent.reads"},"Timeline-consistent High Available Reads")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://issues.apache.org/jira/browse/HBASE-10070"},"HBASE-10070")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://issues.apache.org/jira/secure/attachment/12616659/HighAvailabilityDesignforreadsApachedoc.pdf"},"HighAvailabilityDesignforreadsApachedoc.pdf"))))}d.isMDXComponent=!0},8369:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/client-read-replicas-ccdc2076b27cf4c406b28e22fcf3f5d0.png"},1914:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/client_scan_replicas-fd7fa07654a40cb9ee74b05ea7769eb9.png"},7883:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/meta-4e25459c12011f47545533ebf41291ce.png"},8026:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/region_replica_replication-0e540a03227d17865c1070363956a8bb.png"},4102:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/rs-structure-4c2478b8d9d3eed71dec635557afba24.png"},2071:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/timeline_consistency-cbd096b06c5cd9b876ac242581fd5752.png"}}]);