<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://ddupg.github.io/blog</id>
    <title>Ddupg Blog</title>
    <updated>2022-06-26T12:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://ddupg.github.io/blog"/>
    <subtitle>Ddupg Blog</subtitle>
    <icon>https://ddupg.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Docusauruså»ºç«™ï¼ˆ3ï¼‰- hygenç”Ÿæˆé¡µé¢æ¨¡ç‰ˆ]]></title>
        <id>docusaurus-website-3</id>
        <link href="https://ddupg.github.io/blog/docusaurus-website-3"/>
        <updated>2022-06-26T12:00:00.000Z</updated>
        <summary type="html"><![CDATA[å†™åšå®¢æ¯æ¬¡éƒ½è¦å†™ä¸€å †matterä¿¡æ¯ï¼Œè´¼éº»çƒ¦ï¼Œç”¨hygenå·¥å…·ç”Ÿæˆã€‚]]></summary>
        <content type="html"><![CDATA[<p>å†™åšå®¢æ¯æ¬¡éƒ½è¦å†™ä¸€å †matterä¿¡æ¯ï¼Œè´¼éº»çƒ¦ï¼Œç”¨hygenå·¥å…·ç”Ÿæˆã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hygenä½¿ç”¨">hygenä½¿ç”¨<a class="hash-link" href="#hygenä½¿ç”¨" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="macoså®‰è£…">MacOSå®‰è£…<a class="hash-link" href="#macoså®‰è£…" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ brew tap jondot/tap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> hygen</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å…¶ä»–ç³»ç»Ÿæˆ–å®‰è£…æ–¹å¼å‚è€ƒå®˜ç½‘ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="åˆå§‹åŒ–é¡¹ç›®">åˆå§‹åŒ–é¡¹ç›®<a class="hash-link" href="#åˆå§‹åŒ–é¡¹ç›®" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> your-project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ hygen init self</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ·»åŠ è‡ªå·±çš„åšå®¢æ¨¡ç‰ˆ">æ·»åŠ è‡ªå·±çš„åšå®¢æ¨¡ç‰ˆ<a class="hash-link" href="#æ·»åŠ è‡ªå·±çš„åšå®¢æ¨¡ç‰ˆ" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ hygen generator new blog</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¼šäº§ç”Ÿä¸€ä¸ª<code>_templates/blog/new/hello.ejs.t</code>æ–‡ä»¶ï¼ŒæŠŠ<code>hello.ejs.t</code>æ”¹åæˆ<code>index.ejs.t</code></p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">_templates/blog/new/index.ejs.t</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> blog/&lt;%= name %</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">/index.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">slug</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">date</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;%= h.getBlogDate() %</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">author</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ddupg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">author_title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> æ•°æ®åº“å·¥ç¨‹å¸ˆ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">author_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//ddupg.github.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">æ•°æ®åº“</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> åç«¯</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;</span><span class="token tag" style="color:#00009f">!--</span><span class="token plain"> truncate </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>æ¯ç¯‡åšå®¢ä¼šç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ç›®å½•ã€‚ä¸ªäººä¹ æƒ¯ï¼Œæ–¹ä¾¿åœ¨åŒç›®å½•ä¸‹æ”¾å›¾ç‰‡ç­‰å…¶ä»–èµ„æºã€‚</li><li>slugå’Œtitleè®°å¾—å¡«ï¼Œä¸ç„¶ä¹Ÿè·‘ä¸èµ·æ¥ã€‚</li><li>å…¶ä»–ä¿¡æ¯å¯ä»¥æ ¹æ®è‡ªå·±æƒ…å†µä¿®æ”¹</li><li><code>h.getBlogDate()</code>æ˜¯è‡ªå®šä¹‰çš„ä¸€ä¸ªå·¥å…·æ–¹æ³•ï¼Œå®šä¹‰åœ¨æ ¹ç›®å½•çš„<code>.hygen.js</code>ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hygenjs">.hygen.js<a class="hash-link" href="#hygenjs" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ”¾ä¸€ä¸ª<code>.hygen.js</code>æ–‡ä»¶ï¼Œå¯ä»¥æ”¾ä¸€äº›è‡ªå®šä¹‰çš„å·¥å…·æ–¹æ³•ï¼Œæ¯”å¦‚æ¨¡ç‰ˆä¸­çš„æ—¥æœŸç”Ÿæˆçš„æ–¹æ³•å°±æ”¾åœ¨è¿™é‡Œ</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.hygen.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">helpers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function-variable function" style="color:#d73a49">getBlogDate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toISOString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ç”Ÿæˆ">ç”Ÿæˆ<a class="hash-link" href="#ç”Ÿæˆ" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ hygen blog new &lt;blog name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰§è¡Œä¹‹åï¼Œå°±ä¼šç”Ÿæˆæ–°çš„åšå®¢äº†ï¼Œæ–‡ä»¶æ”¾åœ¨<code>blog/&lt;blog name&gt;/index.md</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å‚è€ƒ">å‚è€ƒ<a class="hash-link" href="#å‚è€ƒ" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><ul><li><a href="https://www.hygen.io/" target="_blank" rel="noopener noreferrer">Hygen</a></li></ul>]]></content>
        <author>
            <name>Ddupg</name>
            <uri>https://ddupg.github.io</uri>
        </author>
        <category label="Docusaurus" term="Docusaurus"/>
        <category label="Hygen" term="Hygen"/>
        <category label="å‰ç«¯" term="å‰ç«¯"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docusauruså»ºç«™ï¼ˆ2ï¼‰- éƒ¨ç½²åˆ°GitHub Pages]]></title>
        <id>docusaurus-website-2</id>
        <link href="https://ddupg.github.io/blog/docusaurus-website-2"/>
        <updated>2022-06-26T11:00:00.000Z</updated>
        <summary type="html"><![CDATA[éƒ¨ç½²åˆ°GitHub Pagesã€‚å®˜ç½‘æ”¯æŒå¾ˆå¤šç§æ–¹æ³•ï¼Œæˆ‘é€‰äº†GitHub Actionã€‚]]></summary>
        <content type="html"><![CDATA[<p>éƒ¨ç½²åˆ°GitHub Pagesã€‚å®˜ç½‘æ”¯æŒå¾ˆå¤šç§æ–¹æ³•ï¼Œæˆ‘é€‰äº†GitHub Actionã€‚
æˆ‘æœ‰å‡ å°ç”µè„‘ï¼Œå‡ å¥—å¼€å‘ç¯å¢ƒï¼Œå¦‚æœæ¯ä¸ªéƒ½é…ä¸€éä¹Ÿå¤Ÿéº»çƒ¦çš„ï¼Œæ¯•ç«Ÿä¸æ˜¯ä¸“ä¸šçš„å‰ç«¯ã€‚ç”¨GitHub Actionçš„è¯ï¼Œå†™ç®€å•åšå®¢æˆ–è€…æ–‡æ¡£ç›´æ¥pushåˆ°ä»“åº“å°±å¥½äº†ï¼Œç”šè‡³å¯ä»¥åœ¨GitHubçš„ç½‘é¡µç¼–è¾‘ï¼Œæ–¹ä¾¿å¾—å¾ˆã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ–°å»ºgithubä»“åº“ä¸Šä¼ ä»£ç ">æ–°å»ºGitHubä»“åº“&amp;ä¸Šä¼ ä»£ç <a class="hash-link" href="#æ–°å»ºgithubä»“åº“ä¸Šä¼ ä»£ç " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ä¸Šä¸€æ­¥åªèƒ½åœ¨æœ¬åœ°è¿è¡Œéƒ¨ç½²ï¼Œè¦æŠŠå®ƒéƒ¨ç½²åˆ°GitHub Pagesï¼Œå¾—å…ˆä¸Šä¼ åˆ°GitHubçš„ä¸€ä¸ªä»“åº“é‡Œã€‚</p><p>æˆ‘è¿™é‡Œå°±æ˜¯ä¸Šä¼ åˆ°äº†ddupg.github.ioä»“åº“ã€‚</p><blockquote><p>ä»¥github.ioåç¼€çš„ä»“åº“åï¼ŒGitHubä¼šé»˜è®¤è¿™æ˜¯ä¸ªGitHub Pagesé¡¹ç›®ï¼Œå¦‚æœæ˜¯å…¶ä»–é¡¹ç›®è¿˜éœ€è¦è‡ªå·±é…ç½®GitHub Pagesã€‚å…·ä½“çœ‹ä¸‹<a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">å®˜ç½‘ä»‹ç»</a>ã€‚</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="é…ç½®access-token">é…ç½®Access Token<a class="hash-link" href="#é…ç½®access-token" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ç”Ÿæˆ">ç”Ÿæˆ<a class="hash-link" href="#ç”Ÿæˆ" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ç”Ÿæˆä¸€ä¸ªä¸“ç”¨äºGitHub Pageséƒ¨ç½²ç”¨çš„access tokenï¼ŒGitHub Actionéœ€è¦ç”¨è¿™ä¸ªtokenæ‰èƒ½éƒ¨ç½²ã€‚</p><p>åœ¨è‡ªå·±çš„GitHubè´¦å·é‡Œï¼Œä»é¡µé¢å³ä¸Šè§’å¼€å§‹ï¼š</p><p><em>Setting -&gt;Developer settings -&gt;  Personal access tokens</em></p><p>ç”Ÿæˆä¸€ä¸ªæ–°çš„tokenï¼Œè®°å¾—å¤åˆ¶ä¸‹æ¥ï¼Œé©¬ä¸Šè¦ç”¨ï¼š</p><p><img loading="lazy" alt="new-token.png" src="/assets/images/new-token-77a71a94047528c7490cc4dc2265e41b.png" width="802" height="627" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="é…ç½®">é…ç½®<a class="hash-link" href="#é…ç½®" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><img loading="lazy" src="/assets/images/env-var-0b10f2f47d231a7b23df34ff41c09527.png" width="1638" height="848" class="img_ev3q"></p><p>è¿™é‡Œçš„ç¯å¢ƒå˜é‡ååé¢è¦ç”¨ï¼Œä¸è¦ä¹±èµ·åã€‚ç¯å¢ƒå˜é‡çš„å€¼ï¼Œå°±æ˜¯ä¸Šä¸€æ­¥ç”Ÿæˆçš„tokenã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="é…ç½®github-action">é…ç½®GitHub Action<a class="hash-link" href="#é…ç½®github-action" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è¯¦ç»†çš„å¯ä»¥çœ‹<a href="https://www.docusaurus.cn/docs/deployment#triggering-deployment-with-github-actions" target="_blank" rel="noopener noreferrer">Docusaurusæ–‡æ¡£</a></p><p>é…ç½®GitHub Actionéå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨è‡ªå·±çš„é¡¹ç›®çš„å›ºå®šç›®å½•æ–°åŠ ä¸ªé…ç½®æ–‡ä»¶å°±å¥½äº†ã€‚</p><ul><li><p>æ–‡ä»¶åéšæ„ã€‚ç›®å½•å¿…é¡»æ˜¯ï¼š<code>.github/workflows/</code></p></li><li><p>å¦‚æœä½ çš„é»˜è®¤ä¸»åˆ†æ”¯ä¸æ˜¯mainï¼Œé‚£å°±æ”¹ä¸‹<code>on.push.branches</code>ã€‚å¦‚æœå…¶ä»–åˆ†æ”¯ä¹Ÿéœ€è¦è§¦å‘ï¼Œé‚£ä¹ŸåŠ ä¸Šåˆ†æ”¯åã€‚</p></li><li><p>å¦‚æœä½ çš„ç¯å¢ƒå˜é‡åå­—ä¸æ˜¯<code>ACCESS_TOKEN</code>ï¼Œå°±æ”¹ä¸ªç¯å¢ƒå˜é‡åï¼Œå…¶ä»–çš„ä¸è¦åŠ¨</p></li></ul><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.github/workflows/ci.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy to GitHub Pages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy to GitHub Pages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">node-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 16.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yarn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yarn install </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">frozen</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lockfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Build website</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yarn build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Popular action to deploy to GitHub Pages:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Docs: https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-docusaurus</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy to GitHub Pages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> peaceiris/actions</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gh</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pages@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">github_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.ACCESS_TOKEN </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Build output to publish to the `gh-pages` branch:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">publish_dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æœ€å">æœ€å<a class="hash-link" href="#æœ€å" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æŠŠä¿®æ”¹åçš„é…ç½®æ–‡ä»¶pushåˆ°ä»“åº“å°±å¥½äº†ï¼ŒGitHub Actionä¼šè‡ªåŠ¨è§¦å‘ã€‚</p><p>å†ä¿®æ”¹ä¸‹GitHub Pagesä½¿ç”¨çš„åˆ†æ”¯ï¼Œè¿™äº‹å°±æˆäº†ã€‚</p><p><img loading="lazy" src="/assets/images/github-pages-a97a1ac6b80121310c1c8774bb5f2ea1.png" width="1079" height="503" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å‚è€ƒ">å‚è€ƒ<a class="hash-link" href="#å‚è€ƒ" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p><a href="https://www.docusaurus.cn/" target="_blank" rel="noopener noreferrer">Docusaurusæ–‡æ¡£</a></p>]]></content>
        <author>
            <name>Ddupg</name>
            <uri>https://ddupg.github.io</uri>
        </author>
        <category label="Docusaurus" term="Docusaurus"/>
        <category label="React" term="React"/>
        <category label="å‰ç«¯" term="å‰ç«¯"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docusauruså»ºç«™ï¼ˆ1ï¼‰- é¡¹ç›®åˆå§‹åŒ–]]></title>
        <id>docusaurus-website-1</id>
        <link href="https://ddupg.github.io/blog/docusaurus-website-1"/>
        <updated>2022-06-26T10:00:00.000Z</updated>
        <summary type="html"><![CDATA[æœ¬æƒ³é‡åšè‡ªå·±çš„åšå®¢å’Œæ–‡æ¡£ï¼Œæœ¬æ‰“ç®—ä»å¤´å†™ï¼Œè°ƒç ”äº†Next.jså’ŒGatsbyï¼Œéƒ½æ˜¯å¾ˆå¼ºå¤§çš„æ¡†æ¶ï¼Œä½†å¯¹æˆ‘ä¸ªåç«¯å¼€å‘æ¥è¯´è¿˜æ˜¯å¾ˆæœ‰éš¾åº¦çš„ã€‚æ— æ„ä¸­çœ‹åˆ°äº†Docusaurusæ¡†æ¶ï¼Œèƒ½è‡ªå¸¦æ–‡æ¡£å’Œåšå®¢ï¼Œè¿˜èƒ½é«˜åº¦è‡ªå®šä¹‰é¡µé¢ï¼Œå®Œç¾åŒ¹é…æˆ‘çš„éœ€æ±‚ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ä¸ªç³»åˆ—ï¼Œæ‰“ç®—è®°å½•ä¸‹æ•´ä¸ªåšå®¢æ”¹é€ è¿‡ç¨‹ï¼Œèƒ½å†™å‡ æœŸä¸ä¸€å®šï¼Œæ…¢æ…¢æ¥å§ã€‚]]></summary>
        <content type="html"><![CDATA[<p>æœ¬æƒ³é‡åšè‡ªå·±çš„åšå®¢å’Œæ–‡æ¡£ï¼Œæœ¬æ‰“ç®—ä»å¤´å†™ï¼Œè°ƒç ”äº†Next.jså’ŒGatsbyï¼Œéƒ½æ˜¯å¾ˆå¼ºå¤§çš„æ¡†æ¶ï¼Œä½†å¯¹æˆ‘ä¸ªåç«¯å¼€å‘æ¥è¯´è¿˜æ˜¯å¾ˆæœ‰éš¾åº¦çš„ã€‚æ— æ„ä¸­çœ‹åˆ°äº†Docusaurusæ¡†æ¶ï¼Œèƒ½è‡ªå¸¦æ–‡æ¡£å’Œåšå®¢ï¼Œè¿˜èƒ½é«˜åº¦è‡ªå®šä¹‰é¡µé¢ï¼Œå®Œç¾åŒ¹é…æˆ‘çš„éœ€æ±‚ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ä¸ªç³»åˆ—ï¼Œæ‰“ç®—è®°å½•ä¸‹æ•´ä¸ªåšå®¢æ”¹é€ è¿‡ç¨‹ï¼Œèƒ½å†™å‡ æœŸä¸ä¸€å®šï¼Œæ…¢æ…¢æ¥å§ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="åˆå§‹åŒ–é¡¹ç›®">åˆå§‹åŒ–é¡¹ç›®<a class="hash-link" href="#åˆå§‹åŒ–é¡¹ç›®" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ npx create-docusaurus@latest my-website classic --typescript</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ yarn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ yarn build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ yarn start # å¼€å‘è¿‡ç¨‹ä¸­ï¼Œèƒ½è‡ªåŠ¨åˆ·æ–°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ yarn serve # ä¸ä¼šè‡ªåŠ¨åˆ·æ–°</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ä¿®æ”¹ç½‘ç«™é…ç½®">ä¿®æ”¹ç½‘ç«™é…ç½®<a class="hash-link" href="#ä¿®æ”¹ç½‘ç«™é…ç½®" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ä¿®æ”¹ç½‘ç«™åŸºæœ¬ä¿¡æ¯">ä¿®æ”¹ç½‘ç«™åŸºæœ¬ä¿¡æ¯<a class="hash-link" href="#ä¿®æ”¹ç½‘ç«™åŸºæœ¬ä¿¡æ¯" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><img loading="lazy" alt="config-basic.png" src="/assets/images/config-basic-769cf3cfc8811e809d2f3c59aa7666fa.png" width="1102" height="796" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ä¿®æ”¹å›¾æ ‡å¯¼èˆªæ ">ä¿®æ”¹å›¾æ ‡&amp;å¯¼èˆªæ <a class="hash-link" href="#ä¿®æ”¹å›¾æ ‡å¯¼èˆªæ " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><img loading="lazy" src="/assets/images/config-navbar-cfd63c0f3bd7bb5a5396da10778ba00e.png" width="926" height="1408" class="img_ev3q"></p><p>åˆ¶ä½œå›¾æ ‡è¿‡ç¨‹ä¸­ç”¨åˆ°çš„å‡ ä¸ªå·¥å…·ï¼Œéƒ½æ˜¯ä¸´æ—¶googleæ‰¾çš„ï¼š</p><p><a href="https://www.remove.bg/zh" target="_blank" rel="noopener noreferrer">å›¾ç‰‡èƒŒæ™¯æ¶ˆé™¤</a></p><p><a href="https://www.logosc.cn/logo/favicon?s=d" target="_blank" rel="noopener noreferrer">iconå›¾æ ‡ç”Ÿæˆå·¥å…·</a></p><p><a href="https://www.aconvert.com/cn/image/png-to-svg/" target="_blank" rel="noopener noreferrer">PNGè½¬SVG - åœ¨çº¿è½¬æ¢å›¾åƒæ–‡ä»¶</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ä¿®æ”¹footer">ä¿®æ”¹Footer<a class="hash-link" href="#ä¿®æ”¹footer" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><img loading="lazy" src="/assets/images/config-footer-13e3c99e1a491cefa4855282c1193f5c.png" width="1736" height="1660" class="img_ev3q"> &nbsp;</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="åˆ æ‰è‡ªå¸¦çš„åšå®¢æ–‡æ¡£demo">åˆ æ‰è‡ªå¸¦çš„åšå®¢/æ–‡æ¡£Demo<a class="hash-link" href="#åˆ æ‰è‡ªå¸¦çš„åšå®¢æ–‡æ¡£demo" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åšå®¢ç›®å½•ï¼š<code>blog/</code>
æ–‡æ¡£ç›®å½•ï¼š<code>docs/</code></p><p>æ–‡æ¡£ç›®å½•åªç•™ä¸ª<code>intro.md</code>ï¼Œå› ä¸ºé…ç½®é‡Œç•™äº†è¿™ä¸ªæ–‡ä»¶çš„å¼•ç”¨ï¼Œåé¢å½“ä¸ªä¸»é¡µå¯¼èˆªç”¨ã€‚</p>]]></content>
        <author>
            <name>Ddupg</name>
            <uri>https://ddupg.github.io</uri>
        </author>
        <category label="Docusaurus" term="Docusaurus"/>
        <category label="React" term="React"/>
        <category label="å‰ç«¯" term="å‰ç«¯"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[åˆå°Gatsby]]></title>
        <id>first-try-gatsby</id>
        <link href="https://ddupg.github.io/blog/first-try-gatsby"/>
        <updated>2022-06-18T08:11:00.000Z</updated>
        <summary type="html"><![CDATA[ç¬¬ä¸€æ¬¡ä½“éªŒGatsbyé¡¹ç›®ï¼Œåˆ›å»ºdemoé¡¹ç›®å°±ç¢°åˆ°äº†ä¸å°‘é—®é¢˜ã€‚]]></summary>
        <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡ä½“éªŒGatsbyé¡¹ç›®ï¼Œåˆ›å»ºdemoé¡¹ç›®å°±ç¢°åˆ°äº†ä¸å°‘é—®é¢˜ã€‚
ç¬”è€…ç”¨çš„æ˜¯MacOSç¯å¢ƒã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sharpé—®é¢˜">sharpé—®é¢˜<a class="hash-link" href="#sharpé—®é¢˜" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">â¯ Installing Gatsby...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! code 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! path /Users/ddupg/github/gatsby-demo/node_modules/sharp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! command failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! command sh -c (node install/libvips &amp;&amp; node install/dll-copy &amp;&amp; prebuild-install) || (node install/can-compile &amp;&amp; node-gyp rebuild &amp;&amp; node install/dll-copy)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! sharp: Downloading https://github.com/lovell/sharp-libvips/releases/download/v8.12.2/libvips-8.12.2-darwin-x64.tar.br</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! sharp: Please see https://sharp.pixelplumbing.com/install for required dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! sharp: Installation error: connect ETIMEDOUT 185.199.111.133:443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! A complete log of this run can be found in:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ERROR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Command failed with exit code 1: npm install --loglevel error --color always</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å‚è€ƒ<a href="https://juejin.cn/post/6844903856464199687" target="_blank" rel="noopener noreferrer">è§£å†³gatsbyå®‰è£…å¤±è´¥sharp: Command failed</a>
è¿™æ˜¯å›½å†…è¿æ¥githubç½‘ç»œä¸ç¨³ï¼Œä¾èµ–èµ„æºä¸‹è½½ä¸äº†ã€‚
ä»å¼‚å¸¸ä¸­èƒ½çœ‹å‡ºä¾éœ€è¦ä¸‹è½½çš„å…·ä½“åŒ…ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯<strong>libvips-8.12.2-darwin-x64.tar.br</strong>ï¼Œæ‰‹åŠ¨ä»<a href="https://github.com/lovell/sharp-libvips/releases" target="_blank" rel="noopener noreferrer">github</a>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬ï¼Œæ”¾åˆ°<code>~/.npm/_libvips</code>
ç›®å½•ï¼Œå†å°è¯•å°±å¥½äº†ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vipsé—®é¢˜">vipsé—®é¢˜<a class="hash-link" href="#vipsé—®é¢˜" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">â¯ Installing Gatsby...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! code 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! path /Users/ddupg/github/my-gatsby-site/node_modules/sharp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! command failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! command sh -c (node install/libvips &amp;&amp; node install/dll-copy &amp;&amp; prebuild-install) || (node install/can-compile &amp;&amp; node-gyp rebuild &amp;&amp; node install/dll-copy)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! sharp: Using cached /Users/ddupg/.npm/_libvips/libvips-8.12.2-darwin-x64.tar.br</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! sharp: Integrity check passed for darwin-x64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR!   TOUCH Release/obj.target/libvips-cpp.stamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR!   CC(target) Release/obj.target/nothing/node_modules/node-addon-api/nothing.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR!   LIBTOOL-STATIC Release/nothing.a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR!   CXX(target) Release/obj.target/sharp-darwin-x64/src/common.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! ../src/common.cc:24:10: fatal error: 'vips/vips8' file not found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! #include &lt;vips/vips8&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR!          ^~~~~~~~~~~~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! 1 error generated.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! make: *** [Release/obj.target/sharp-darwin-x64/src/common.o] Error 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! build error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! stack Error: `make` failed with exit code: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! stack     at ChildProcess.onExit (/Users/ddupg/.node_global/lib/node_modules/npm/node_modules/node-gyp/lib/build.js:194:23)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! stack     at ChildProcess.emit (node:events:526:28)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! stack     at Process.ChildProcess._handle.onexit (node:internal/child_process:291:12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! System Darwin 19.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! command "/usr/local/bin/node" "/Users/ddupg/.node_global/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js" "rebuild"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! cwd /Users/ddupg/github/my-gatsby-site/node_modules/sharp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! node -v v16.14.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! node-gyp -v v9.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! gyp ERR! not ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm ERR! A complete log of this run can be found in:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ERROR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Command failed with exit code 1: npm install --loglevel error --color always</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å‚è€ƒ<a href="https://stackoverflow.com/questions/66363572/vips-vips8-file-not-found-include-vips-vips8-in-ionic-cordova-in-ios" target="_blank" rel="noopener noreferrer">vips/vips8 file not found #include &lt;vips/vips8&gt; in Ionic cordova in IOS</a>
æ‰‹åŠ¨å®‰è£…vips</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew install vips</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å…¶ä»–">å…¶ä»–<a class="hash-link" href="#å…¶ä»–" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>å›½å†…ç¯å¢ƒbrewä¸‹è½½è´¼æ…¢ï¼Œå‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/324691527" target="_blank" rel="noopener noreferrer">brewæ¢æº</a></p>]]></content>
        <author>
            <name>Ddupg</name>
            <uri>https://ddupg.github.io</uri>
        </author>
        <category label="Gatsby" term="Gatsby"/>
        <category label="React" term="React"/>
        <category label="å‰ç«¯" term="å‰ç«¯"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[HBase SCP & TRSP]]></title>
        <id>HBase-SCP-and-TRSP</id>
        <link href="https://ddupg.github.io/blog/HBase-SCP-and-TRSP"/>
        <updated>2020-04-16T15:20:00.000Z</updated>
        <summary type="html"><![CDATA[æœ€è¿‘åœ¨ç»„å†…è¿›è¡Œçš„ä¸€æ¬¡SCPå’ŒTRSPä¸¤ä¸ªProcedureæ‰§è¡Œè¿‡ç¨‹çš„åˆ†äº«ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œæ‡’å¾—å»æ•´ç†å‡ºæ–‡ç« äº†]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ç»„å†…è¿›è¡Œçš„ä¸€æ¬¡SCPå’ŒTRSPä¸¤ä¸ªProcedureæ‰§è¡Œè¿‡ç¨‹çš„åˆ†äº«ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œæ‡’å¾—å»æ•´ç†å‡ºæ–‡ç« äº† ğŸ˜œ</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="amv2">AMv2<a class="hash-link" href="#amv2" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ¯”è¾ƒé‡è¦çš„ç±»">æ¯”è¾ƒé‡è¦çš„ç±»<a class="hash-link" href="#æ¯”è¾ƒé‡è¦çš„ç±»" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><img loading="lazy" alt="AMv2ä¸»è¦çš„ç±»" src="/assets/images/amv2-2f91d7e4ca3bdaccfcb134b65d0b65f9.png" width="1256" height="654" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="assignmentmanager">AssignmentManager<a class="hash-link" href="#assignmentmanager" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ç®¡ç†Regionçš„assign/unassignæ“ä½œï¼Œç®¡ç†Regionçš„çŠ¶æ€ä¿¡æ¯ã€‚</p><p>å…¶ä¸­ä¸»è¦å±æ€§ï¼š</p><ul><li>RegionStates: ç®¡ç†å†…å­˜ä¸­çš„RegionçŠ¶æ€ä¿¡æ¯ï¼ŒRSä¸Šæœ‰å“ªäº›region</li><li>RegionStateStore: æ“ä½œmetaè¡¨</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="regionstatenode">RegionStateNode<a class="hash-link" href="#regionstatenode" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><ul><li>lock: å¯¹RegionçŠ¶æ€ä¿¡æ¯å’ŒRegionLoacationä¿¡æ¯åŠ é”ï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹ã€‚</li><li>regionInfo: Regionä¿¡æ¯</li><li>event: ç”¨äºå¤šä¸ªprocedureç­‰å¾…Regionçš„æŸä¸ªçŠ¶æ€å˜åŒ–ï¼Œæ¯”å¦‚openã€closeã€‚</li><li>procedure: è®°å½•å”¯ä¸€ç»‘å®šçš„TRSPï¼Œä¿è¯æ¯ä¸ªRegionåªèƒ½åŒæ—¶è¿›è¡Œä¸€ä¸ªTRSPã€‚</li><li>regionLocation: regionè¦è¢«assignåˆ°å“ªä¸ªRSã€‚</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="procedureevent">ProcedureEvent<a class="hash-link" href="#procedureevent" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ç”¨äºå¤šä¸ªProcedureç­‰å¾…æŸä¸ªä¾èµ–çš„äº‹ä»¶ï¼Œåœ¨AMv2ä¸­ï¼Œä¸»è¦çš„å°±æ˜¯ç­‰å¾…Regionçš„çŠ¶æ€å˜åŒ–ã€‚</p><p><img loading="lazy" alt="ProcedureEvent" src="/assets/images/ProcedureEvent-9c68161b068f8ef7283f3bb74fbe04b6.png" width="419" height="222" class="img_ev3q"></p><p>äº‹ä»¶çŠ¶æ€å°±ä¸¤ç§ï¼š</p><ul><li>ready: æŸä¸ªäº‹ä»¶å·²å‡†å¤‡å¥½ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œ</li><li>suspend: äº‹ä»¶æœªå‡†å¤‡å¥½ï¼Œä¹‹åè°ƒç”¨suspendIfNotReady()æ–¹æ³•çš„Procedureéƒ½ä¼šè¢«åŠ åˆ° suspendedProcedureé˜Ÿåˆ—é‡Œï¼Œç”¨äºä¹‹åå”¤é†’ã€‚</li></ul><p>ä¸»è¦æ–¹æ³•ï¼š</p><ul><li>suspendIfNotReady: å¦‚æœæ˜¯readyçŠ¶æ€ï¼Œè¡¨ç¤ºå¯ä»¥ç»§ç»­æ‰§è¡Œï¼›å¦‚æœsuspendçŠ¶æ€ï¼ŒProcedureä¼šè¢«åŠ åˆ° suspendedProcedureé˜Ÿåˆ—é‡Œï¼Œç”¨äºä¹‹åå”¤é†’ã€‚è¿™æ—¶å€™Procedureä¼šæŠ›å‡ºProcedureSuspendedExceptionï¼ŒPv2æ¡†æ¶ä¼šæš‚åœProcedureçš„æ‰§è¡Œï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</li></ul><p>è¿™ä¸ªåŠŸèƒ½æœ‰ä¸ªé—®é¢˜å°±æ˜¯åªä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ— æ³•æ¢å¤ï¼Œå¦‚æœProcedureä½¿ç”¨ä¸å¥½ï¼ŒMasteré‡å¯ï¼Œç­‰å¾…é˜Ÿåˆ—æ— æ³•æ¢å¤ï¼ŒProcedureå¯èƒ½æ°¸è¿œæ— æ³•è¢«å”¤é†’ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="servercrashprocedure">ServerCrashProcedure<a class="hash-link" href="#servercrashprocedure" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è§¦å‘æ¡ä»¶">è§¦å‘æ¡ä»¶<a class="hash-link" href="#è§¦å‘æ¡ä»¶" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="zk-session-expireè¢«åŠ¨è§¦å‘">zk session expireï¼ˆè¢«åŠ¨è§¦å‘ï¼‰<a class="hash-link" href="#zk-session-expireè¢«åŠ¨è§¦å‘" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ç›‘å¬zkä¸ŠrsèŠ‚ç‚¹çš„å˜åŒ–ï¼Œå¦‚æœä»£è¡¨æŸä¸ªrsçš„å­èŠ‚ç‚¹è¢«è¿‡æœŸåˆ é™¤ï¼Œå°±è§¦å‘SCPã€‚</p><p>é…ç½®: {zookeeper.znode.parent}/{zookeeper.znode.rs}/</p><p>é»˜è®¤: /hbase/{cluster name}/rs/</p><p>æ­¤ç§æƒ…å†µä¸‹ï¼Œå¦‚æœrså¤„äºéONLINEçŠ¶æ€ï¼Œä¸ä¼šå¼ºåˆ¶æ‰§è¡ŒServerCrashProcedure</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hbck2-ä¸»åŠ¨è§¦å‘">HBCK2 ï¼ˆä¸»åŠ¨è§¦å‘ï¼‰<a class="hash-link" href="#hbck2-ä¸»åŠ¨è§¦å‘" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>è¦ä½¿ç”¨å®Œæ•´çš„ServerNameï¼ŒåŒ…å«åé¢çš„startcodeã€‚</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./hbase hbck -j hbase-hbck2-1.0.0-SNAPSHOT.jar scheduleRecoveries c4-hadoop-tst-st84.bj,55600,1586416554312 c4-hadoop-tst-st85.bj,55600,1586415546993</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ— è®ºrsæ˜¯å¦å¤„äºONLINEçŠ¶æ€ï¼Œéƒ½ä¼šå¼ºåˆ¶æ‰§è¡Œ HBCKServerCrashProcedureï¼ˆServerCrashProcedureçš„å­ç±»ï¼‰ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹è¡Œä¸ºå’ŒServerCrashProcedureä¸€æ ·ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºgetRegionsOnCrashedServeræ–¹æ³•ï¼š</p><p>å¦‚æœServerCrashProcedure.getRegionsOnCrashedServerè¿”å›ç©ºé›†åˆï¼ŒHBCKServerCarshProcedureä¼šscanè¯»metaè¡¨ï¼Œå°†metaè¡¨ä¸Šè®°å½•çš„Openingå’ŒOpenedä¸¤ç§çŠ¶æ€çš„regionè¿”å›ï¼Œå¦å¤–å°†ClosingçŠ¶æ€çš„regionæ”¹ä¸ºCloseã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="çŠ¶æ€å˜åŒ–">çŠ¶æ€å˜åŒ–<a class="hash-link" href="#çŠ¶æ€å˜åŒ–" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><strong>å‡†å¤‡å·¥ä½œ</strong></p><p>å°†å½“å‰å¤„ç†çš„rsåŠ åˆ° DeadServer processing listã€‚åœ¨SCPæ‰§è¡Œç»“æŸä¹‹åï¼Œæ‰åŠ åˆ° DeadServers listã€‚æ¯ä¸ªçŠ¶æ€éƒ½ä¼šæ£€æŸ¥ä¸‹ï¼Œæ˜¯å¦åŠ è¿›å»äº†ã€‚</p><p><strong>ç­‰å¾…metaè¡¨å¯ç”¨</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">case SERVER_CRASH_START:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case SERVER_CRASH_SPLIT_META_LOGS:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case SERVER_CRASH_DELETE_SPLIT_META_WALS_DIR:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case SERVER_CRASH_ASSIGN_META:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// If hbase:meta is not assigned, yield.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (env.getAssignmentManager().waitMetaLoaded(this)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new ProcedureSuspendedException();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å‰é¢å‡ ä¸ªçŠ¶æ€éƒ½æ˜¯æ“ä½œmetaè¡¨çš„regionçš„çŠ¶æ€ï¼Œæ‰€ä»¥metaè¡¨ä¸å¯ç”¨ä¹Ÿä¼šæ‰§è¡Œï¼Œå…¶ä»–çš„çŠ¶æ€ä¼šæ“ä½œæ™®é€šregionï¼Œæ¶‰åŠåˆ°metaè¡¨çš„è¯»å†™ï¼Œæ‰€ä»¥å…¶ä»–çŠ¶æ€éƒ½è¦æ±‚metaè¡¨çš„regionå¯ç”¨ï¼Œæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚è¿™é‡Œå°±åˆ©ç”¨äº†ProcedureEventè¿™ä¸ªç±»çš„åŠŸèƒ½ï¼Œç­‰å¾…meta regionåŠ è½½å®Œæˆä¹‹åæ‰å…è®¸ç»§ç»­ä¸‹é¢çš„çŠ¶æ€ï¼Œå¦åˆ™ç›´æ¥æŠ›å‡ºProcedureSuspendedExceptionæš‚åœå½“å‰Procedureçš„æ‰§è¡Œï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</p><p><strong>ä½†è¿™é‡Œå¥½åƒä½¿ç”¨AssignmentManager.metaAssignEventæ›´åˆé€‚</strong>ã€‚å› ä¸ºmeatLoadedEventåªæœ‰åœ¨Masterå¯åŠ¨ä¹‹åæ‰ä¼šè§¦å‘ä¸€æ¬¡ï¼ŒmetaAssignEventåœ¨Masterå¯åŠ¨å’Œæ¯æ¬¡meta region openéƒ½ä¼šè§¦å‘ï¼Œæ‰€ä»¥metaAssignEventæ¥ä»£è¡¨meta regionå¯ç”¨æ›´åˆé€‚ä¸€äº›ã€‚</p><p><img loading="lazy" alt="SCPæµç¨‹å›¾" src="/assets/images/SCP-58989e5b9729bf091278156057abc06f.png" width="1339" height="1541" class="img_ev3q"></p><ul><li>START: æ²¡æœ‰ä»€ä¹ˆå®é™…æ“ä½œï¼Œæ ¹æ®RSä¸Šæ˜¯å¦æœ‰metaè¡¨çš„regionï¼Œæ¥åˆ¤æ–­ä¸‹ä¸€æ­¥çš„çŠ¶æ€</li><li>SPLIT_META_LOGS: split metaè¡¨çš„WAL</li><li>DELETE_SPLIT_META_WALS_DIR: åˆ é™¤HDFSä¸Šmetaè¡¨split logçš„ç›®å½•</li><li>ASSIGN_META: é‡æ–°assign meta region</li><li>GET_REGIONS: æŸ¥è¯¢RSä¸Šé™¤metaå¤–çš„region</li><li>SPLIT_LOGS: splitémetaè¡¨çš„WAL</li><li>DELETE_SPLIT_WALS_DIR: åˆ é™¤HDFSä¸Šémetaè¡¨çš„WALç›®å½•</li><li>ASSIGN: assign émetaçš„region</li><li>FINISH: æ”¶å°¾å·¥ä½œï¼Œå°†RSåŠ åˆ° DeadServers listï¼Œè§¦å‘CP</li></ul><p>å…¶å®è¿™äº›çŠ¶æ€ä¸»è¦å¯ä»¥åšçš„å°±æ˜¯Split WALï¼ŒDelete WAL dirï¼ŒAssign regionè¿™ä¸‰ç±»ï¼Œåªä¸è¿‡å°†RegionæŒ‰æ˜¯å¦æ˜¯metaåšäº†åŒºåˆ†ï¼Œmeta regionå’Œæ™®é€šregionåˆ†åˆ«åšäº†è¿™ä¸‰ç±»æ“ä½œã€‚è¿™é‡Œæˆ‘ç†è§£åŸå› åº”è¯¥æ˜¯æ™®é€šçš„region assignéœ€è¦è¯»å†™metaè¡¨ï¼Œæ‰€ä»¥è¦æ±‚metaè¡¨çš„regionå¿…é¡»å¯ç”¨æ‰è¡Œï¼Œæ‰€ä»¥ä¼˜å…ˆå¯¹meta regionè¿›è¡Œä¸‰æ­¥æ“ä½œå¤„ç†ï¼Œmeta regionå¯ç”¨ä¹‹åæ‰ä¼šè¿›è¡Œæ™®é€šregionçš„ä¸‰æ­¥æ“ä½œã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="é—®é¢˜">é—®é¢˜<a class="hash-link" href="#é—®é¢˜" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><strong>æ‰§è¡ŒSCPçš„æ—¶å€™ï¼ŒRSä¸Šçš„regionæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</strong></p><p>ç›´æ¥ç½®ä¸ºABNORMALLY_CLOSEDï¼Œè®¤ä¸ºæ‰€æœ‰çš„regionéƒ½å·²ç»ä¸å¯ç”¨äº†ã€‚</p><p>å¦‚æœregionæœ‰TRSPåœ¨è¿›è¡Œï¼Œå°±è¿›ä¸€æ­¥é€šçŸ¥æ‰€æœ‰è¿™äº›regionçš„TRSPå’ŒRRPï¼Œåšå¯¹åº”çš„æ“ä½œã€‚
å¦‚æœæ²¡æœ‰ï¼Œå°±æ–°åŠ TRSPå»assignè¿™äº›regionã€‚</p><p>å¦‚æœrså†æ¢å¤æˆ–å¯åŠ¨çš„è¯ï¼Œä¹Ÿåº”è¯¥ä¼šå‘ç°zkçš„èŠ‚ç‚¹ä¸¢äº†ï¼Œä¸èƒ½ç›´æ¥openå®ƒçš„regionã€‚ï¼ˆè¿™ä¸ªæ²¡æœ‰å»çœ‹ä»£ç ç¡®è®¤ï¼‰</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transitregionstateprocedure">TransitRegionStateProcedure<a class="hash-link" href="#transitregionstateprocedure" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ä¸»è¦å˜é‡">ä¸»è¦å˜é‡<a class="hash-link" href="#ä¸»è¦å˜é‡" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><strong>type/initialState/lastState</strong></p><table><thead><tr><th>type</th><th>initialState</th><th>lastState</th></tr></thead><tbody><tr><td>ASSIGN</td><td>GET_ASSIGN_CANDIDATE</td><td>CONFIRM_OPENED</td></tr><tr><td>UNASSIGN</td><td>CLOSE</td><td>CONFIRM_CLOSED</td></tr><tr><td>MOVE</td><td>CLOSE</td><td>CONFIRM_OPENED</td></tr><tr><td>REOPEN</td><td>CLOSE</td><td>CONFIRM_OPENED</td></tr></tbody></table><p><strong>remoteProc</strong></p><p>ç»‘å®šçš„æŸä¸ªRegionRemoteProcedureBaseï¼Œç”¨äºæ‰§è¡Œopen/close regionè¿™æ ·çš„RPCæ“ä½œï¼Œè¿™é‡Œä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªremoteProcï¼Œè¡¨ç¤ºä¸èƒ½åŒæ—¶è¿›è¡Œå¤šä¸ªæ“ä½œregionçŠ¶æ€çš„RPCã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="çŠ¶æ€æµè½¬">çŠ¶æ€æµè½¬<a class="hash-link" href="#çŠ¶æ€æµè½¬" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><img loading="lazy" alt="TRSPçŠ¶æ€ç®€å›¾" src="/assets/images/TRSP-simple-a558be829bcc6130a60a3c902c396ddc.png" width="817" height="372" class="img_ev3q"></p><p>å¯ä»¥çœ‹å‡ºæ¥ï¼ŒTRSPä¸­çš„5ä¸ªçŠ¶æ€å½¢æˆä¸€ä¸ªç¯ï¼Œé€šè¿‡initialStateå’ŒlastStateä¸¤ä¸ªçŠ¶æ€åˆ¤æ–­å…¥ç¯å’Œå‡ºç¯çš„çŠ¶æ€ã€‚</p><p>åƒASSIGNå’ŒUNASSIGNä¸¤ä¸ªæ“ä½œï¼Œåªéœ€è¦è·‘å®Œè‡ªå·±çš„çŠ¶æ€å°±è¡Œäº†ã€‚MOVE/REOPENæ“ä½œåˆ™è¦å…ˆcloseç„¶åopenï¼Œä¸åŒçš„æ˜¯ï¼Œé€šè¿‡æŒ‡å®šRegionStateNode.regionLocationæ¥æŒ‡å®šopenåœ¨å“ªä¸ªRSä¸Šï¼Œopençš„rså˜åŒ–äº†å°±æ˜¯MOVEï¼Œä¸å˜å°±æ˜¯REOPENã€‚</p><p>ASSIGN: GET_ASSIGN_CANDIDATE -&gt; OPEN -&gt; CONFIRM_OPENED<br>
<!-- -->UNASSIGN: CLOSE -&gt; CONFIRM_CLOSED<br>
<!-- -->MOVE/REOPEN: CLOSE -&gt; CONFIRM_CLOSE -&gt; GET_ASSIGN_CANDIDATE -&gt; OPEN -&gt; CONFIRM_OPENED  </p><p>ç®€å›¾ä¸­ä¸€äº›å¼‚å¸¸æƒ…å†µä¸‹çš„çŠ¶æ€æµè½¬æ²¡æœ‰å±•ç¤ºå‡ºæ¥ï¼Œæ¯”å¦‚å¦‚æœcloseå¤±è´¥ï¼Œä¼šå†å°†region openï¼Œç„¶åå†closeï¼Œå°±ä¼šåœ¨ç¯ä¸Šè½¬åœˆã€‚å°±æ˜¯è¯´æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼Œå°±ä¼šåœ¨ç¯ä¸Šå¾ªç¯æ‰§è¡Œï¼Œç›´åˆ°æ»¡è¶³æ¡ä»¶è¾¾åˆ°lastStateæœ€ç»ˆå‡ºç¯ã€‚</p><p><img loading="lazy" alt="TRSPçŠ¶æ€å›¾" src="/assets/images/TRSP-0acef2ffb80beb4272a59cd963c82d85.png" width="1287" height="776" class="img_ev3q"></p><p><strong>å‡†å¤‡å·¥ä½œ</strong></p><p>æ‰§è¡Œä¹‹å‰å¿…é¡»è·å–RegionStateNodeçš„é”ï¼Œå› ä¸ºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå¤šæ¬¡å¯¹å…¶ä¸­çš„æ•°æ®ï¼ˆstateã€regionLocationï¼‰åšä¿®æ”¹ï¼Œå‰é¢è®²è¿‡ï¼Œä¸ºä¿è¯RegionStateNodeçš„å±æ€§ä¸ä¼šå¹¶å‘ä¿®æ”¹ï¼Œæ‰€æœ‰ä¿®æ”¹ä¹‹å‰éƒ½è¦å…ˆæ‹¿é”ã€‚</p><p><strong>GET_ASSIGN_CANDIDATE</strong></p><p>ä¸»è¦åšçš„äº‹æƒ…å°±æ˜¯ä¸ºRegionæŒ‡å®šä¸€ä¸ªRSï¼Œå°†Regionæ”¾å…¥AMçš„pendingAssignQueueä¹‹åï¼Œç›´æ¥suspendç­‰å¾…ã€‚AMä»¥ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ä¸ºRegionæŒ‡å®šRSï¼Œç„¶åå”¤é†’Procedureã€‚</p><p><strong>OPEN</strong></p><ol><li>å¦‚æœæ²¡æœ‰æŒ‡å®šregionLocationï¼Œåˆ™æœ‰å¯èƒ½æ˜¯ä¸Šä¸€æ­¥GET_ASSIGN_CANDIDATEå‡ºç°é—®é¢˜ã€‚æˆ–è€…ä¸Šä¸€æ­¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒMasteré‡å¯ï¼ŒProcedureé‡è¯•æ‰§è¡Œäº†ã€‚è¿™æ—¶å€™é‡æ–°æ‰§è¡Œä¸Šä¸€æ­¥å°±å¥½äº†ã€‚</li><li>å¦‚æœæˆåŠŸåˆ¶å®šäº†regionLocationï¼Œå°±é€šè¿‡OpenRegionProcedureå»é€šçŸ¥RS openè¯¥regionã€‚<ol><li>å¦‚æœOpenRegionProcedureæœ€ç»ˆæˆåŠŸæ‰§è¡Œå®Œäº†ï¼ŒTRSPç»§ç»­æ‰§è¡Œ</li><li>å¦‚æœå¤±è´¥äº†ï¼Œä¼šåœ¨ä¸‹ä¸€æ­¥CONFIRM_OPENEDè¿›è¡Œé‡è¯•</li><li>å¦‚æœMasteré‡å¯ï¼Œå¯¼è‡´æ— æ³•å”¤é†’ï¼ŒOpenRegionProcedureæœ‰è¶…æ—¶æœºåˆ¶ï¼Œè¶…æ—¶ä¹‹åä¼šå†é‡è¯•ã€‚</li></ol></li></ol><p><strong>CONFIRM_OPENED</strong></p><p>æ£€æŸ¥OPENæ“ä½œæœ€ç»ˆæ˜¯å¦æˆåŠŸã€‚</p><ol><li>å¦‚æœRegionæˆåŠŸOPEN<ol><li>è¦çœ‹lastStateæ˜¯å¦å°±æ˜¯CONFIRM_OPENEDï¼Œæ˜¯çš„è¯å°±å®Œäº‹äº†ã€‚</li><li>ä¸æ˜¯çš„è¯è¦å†æ‰§è¡ŒCLOSEæ“ä½œã€‚å°±åƒç®€å›¾ä¸­çš„ç¯ä¸Šä¸€æ ·æ‰§è¡Œã€‚æœ‰å¯èƒ½å‡ºç°çš„ä¸€ç§æƒ…å†µæ˜¯ï¼Œå½“merge/split regionçš„æ—¶å€™ï¼Œè¦unassignä¸€ä¸ªregionï¼Œä½†è¿‡ç¨‹ä¸­RS crashäº†ï¼Œå°±å¾—å…ˆæŠŠè¿™ä¸ªregion openäº†ï¼Œå†æ‰§è¡Œunassignæ“ä½œï¼Œé˜²æ­¢RS crashæ—¶æ•°æ®ä¸¢å¤±æ— æ³•æ¢å¤ã€‚</li></ol></li><li>é‡è¯•æ¬¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œç›´æ¥ç»“æŸ</li><li>æŠ¹æ‰regionLocationï¼Œé‡æ–°æ‰§è¡ŒGET_ASSIGN_CANDIDATE</li></ol><p><strong>CLOSE</strong></p><ol><li>regionå½“å‰çš„çŠ¶æ€åˆç†ï¼Œé€šè¿‡CloseRegionProcedureï¼Œæ‰§è¡Œè¿‡ç¨‹ç±»ä¼¼äºOpenRegionProcedureã€‚</li><li>ä¸åˆç†ç›´æ¥å†å»GET_ASSIGN_CANDIDATEèµ°OPENçš„é€»è¾‘</li></ol><p><strong>CONFIRM_CLOSED</strong></p><ol><li>å¦‚æœRegionå½“å‰çŠ¶æ€æ˜¯CLOSEï¼Œè¯´æ˜ä¸Šä¸€æ­¥æ‰§è¡ŒæˆåŠŸäº†<ol><li>å¦‚æœlastState == CONFIRM_CLOSEDï¼Œè¯´æ˜å½“å‰çŠ¶æ€å°±æ˜¯è¦æ±‚çš„æœ€ç»ˆçŠ¶æ€ï¼Œå¯ä»¥ç»“æŸäº†ã€‚</li><li>å¦åˆ™ï¼Œè¯´æ˜å¯èƒ½æ˜¯moveæˆ–è€…reopenæ“ä½œï¼Œéœ€è¦å†assign regionï¼Œå»GET_ASSIGN_CANDIDATEèµ°OPENçš„é€»è¾‘ã€‚<strong>åªæœ‰è¿™ä¸€ä¸ªåœ°æ–¹å›åˆ°GET_ASSIGN_CANDIDATEæ²¡æœ‰æŠ¹æ‰regionLocation</strong>ã€‚</li></ol></li><li>å¦‚æœRegionå½“å‰çŠ¶æ€æ˜¯CLOSINGï¼Œè¯´æ˜close rpcæ‰§è¡Œå¤±è´¥äº†ï¼Œrsæ²¡æœ‰å›è°ƒé€šçŸ¥ï¼ˆeg. rsé‡å¯äº†ï¼‰ï¼Œä¸€ç›´ç­‰åˆ°äº†CloseRegionProcedureè¶…æ—¶è§¦å‘äº†TRSPç»§ç»­æ‰§è¡Œï¼Œæ‰èµ°åˆ°äº†å½“å‰çŠ¶æ€ï¼Œéœ€è¦å†é‡æ–°Closeä¸€æ¬¡ã€‚</li><li>èµ°åˆ°è¿™é‡Œçš„Regionå¯èƒ½æ˜¯ABNORMALLY_CLOSEDçŠ¶æ€ï¼Œåº”è¯¥åªæœ‰RS crashæ‰ä¼šå¯¼è‡´è¿™ä¸ªçŠ¶æ€ã€‚<ol><li>å¦‚æœédefault regionï¼ŒABNORMALLY_CLOSEDå¯ä»¥è¢«å½“ä½œCLOSEå¤„ç†ï¼Œç›´æ¥ç»“æŸæ‰ã€‚åªæœ‰å¼€å¯äº†read region replicasåŠŸèƒ½æ‰æœ‰è¿™æ ·çš„regionã€‚édefault regionä¸æ¥æ”¶å†™æ“ä½œï¼Œæ‰€ä»¥å³ä½¿éæ­£å¸¸closeä¹Ÿä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚</li><li>Region closeå¼‚å¸¸ï¼Œéœ€è¦å†openä¹‹åå†æ­£å¸¸closeï¼Œä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚åŸå› å’ŒCONFIRM_OPENEDé‡Œçš„é€»è¾‘ç±»ä¼¼ï¼Œæ¯”å¦‚merge/split regionçš„æ—¶å€™ï¼Œè¦å…ˆclose regionï¼Œå¦‚æœå¤±è´¥äº†ï¼Œåˆ™å¿…é¡»å…ˆæ¢å¤regionå†é‡æ–°closeï¼Œé¿å…æ•°æ®ä¸¢å¤±ã€‚</li></ol></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="é—®é¢˜-1">é—®é¢˜<a class="hash-link" href="#é—®é¢˜-1" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><strong>region merge/splitæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</strong></p><p>region merge/splitåˆ†åˆ«æ˜¯ç”±MergeTableRegionsProcedureå’ŒSplitTableRegionProcedureæ¥æ‰§è¡Œçš„ï¼Œå®ƒä»¬æ­¥æ­¥éª¤éƒ½å¯ä»¥æ‹†åˆ†æˆregion assign/unassignï¼Œä¹Ÿå°±ä¼šæ‹†æˆä¸åŒçš„TRSPå»æ‰§è¡Œã€‚</p><p>ä»¥ region splitä¸ºä¾‹</p><ol><li>closeçˆ¶regionï¼ˆunassignï¼‰</li><li>å¤„ç†å¥½å­regionçš„ä¿¡æ¯ä¿å­˜ä¹‹å</li><li>openå­regionï¼ˆassignï¼‰</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="regionremoteprocedurebase">RegionRemoteProcedureBase<a class="hash-link" href="#regionremoteprocedurebase" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>RegionRemoteProcedureBaseæ˜¯OpenRegionProcedureå’ŒCloseRegionProcedureçš„çˆ¶ç±»ï¼Œå®ç°äº†åŸºæœ¬çš„RPCç›¸å…³åŠŸèƒ½ã€‚RegionRemoteProcedureBaseä¸TRSPçš„é…åˆä¸»è¦ä¹Ÿæ˜¯åˆ©ç”¨äº†ProcedureEventæœºåˆ¶ã€‚</p><p><img loading="lazy" alt="RegionRemoteProcedureBaseæ—¶åºå›¾" src="/assets/images/RegionRemoteProcedureBase-b15690d1fc59375f46f06f3bc50ed9bb.png" width="821" height="421" class="img_ev3q"></p><ol><li>addOperationToNodeæ–¹æ³•å°±æ˜¯å°†RPCæ“ä½œå°è£…èµ·æ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªé›†åˆä¸­ç­‰å¾…æ‰§è¡Œã€‚</li><li>æ‰§è¡Œå½“å‰Regionçš„ProcedureEvent.suspendæ“ä½œï¼Œç­‰å¾…RPCæ‰§è¡Œå®Œæ¯•ä¹‹åå”¤é†’ã€‚</li><li>RSProcedureDispatcherä¼šåˆ†æ‰¹å°†RPCæ“ä½œæŒ‰RSå’Œæ“ä½œç±»å‹åˆ†ç±»ï¼Œæ‰¹é‡è¯·æ±‚æŸä¸ªRSã€‚</li><li>RSæ‰§è¡Œå®Œå¯¹åº”æ“ä½œä¹‹åï¼Œé€šè¿‡reportTransitioné€šçŸ¥AMï¼ˆå½“ç„¶ä¸­é—´è¿˜æœ‰Masterï¼‰ï¼ŒRegion open/closeå®Œæˆã€‚</li><li>ç„¶åAMå°±ä¼šå”¤é†’RegionStateNode.eventï¼Œç»§ç»­æ‰§è¡ŒRegionRemoteProcedureBase</li><li>RegionRemoteProcedureBaseæ‰§è¡Œå®Œæˆä¹‹åï¼Œç»§ç»­æ‰§è¡ŒTRSPåç»­æ­¥éª¤ã€‚</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="é—®é¢˜-2">é—®é¢˜<a class="hash-link" href="#é—®é¢˜-2" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p><strong>RPCå›è°ƒä¹‹åï¼Œæ€ä¹ˆç¡®å®šå¯¹åº”çš„å“ªä¸ªProcedureï¼Ÿ</strong></p><p>RegionInfo -&gt; AM.regionStates (ç±»å‹ RegionStates) -&gt; RegionStates.regionMap (ç±»å‹ Map&lt;byte[], RegionStateNode&gt;) -&gt; RegionStateNode.procedure (ç±»å‹ TRSP) -&gt; TRSP.remoteProc (ç±»å‹ RegionRemoteProcedureBase) -&gt; RegionRemoteProcedureBase.reportTransition</p><p><strong>RSé‡å¯å¯¼è‡´æ²¡æœ‰RPCå›è°ƒï¼Œæˆ–è€…Masteré‡å¯ä¹‹åeventé˜Ÿåˆ—ä¸¢å¤± æ€ä¹ˆåŠï¼Ÿ</strong></p><p>RegionRemoteProcedureBaseæœ‰ä¸ªè¶…æ—¶é™åˆ¶ï¼Œè¶…æ—¶ä¹‹åé‡æ–°å†æ‰§è¡Œä¸€æ¬¡ã€‚</p>]]></content>
        <author>
            <name>Ddupg</name>
            <uri>https://ddupg.github.io</uri>
        </author>
        <category label="HBase" term="HBase"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[HBaseä¸åœæœè·¨é›†ç¾¤æ•°æ®è¿ç§»]]></title>
        <id>HBaseä¸åœæœè·¨é›†ç¾¤æ•°æ®è¿ç§»</id>
        <link href="https://ddupg.github.io/blog/HBaseä¸åœæœè·¨é›†ç¾¤æ•°æ®è¿ç§»"/>
        <updated>2020-03-14T15:42:00.000Z</updated>
        <summary type="html"><![CDATA[æœ€è¿‘æ¥åˆ°ä¸¤ä¸ªç”¨æˆ·æçš„JIRAï¼Œéƒ½æ˜¯ç›®å‰æ•°æ®åªå­˜åœ¨äº†ä¸€ä¸ªsrvé›†ç¾¤ï¼Œéœ€è¦å°†æ•°æ®å¤‡ä»½prcé›†ç¾¤åšæ•°æ®å¤‡ä»½æˆ–è€…ç¦»çº¿è®¡ç®—ï¼ŒåŒæ—¶ä¸¤é›†ç¾¤ä¹‹é—´è¿˜è¦åšæ•°æ®å®æ—¶åŒæ­¥ã€‚æ‰€ä»¥åœ¨è¿™é‡Œè®°å½•ä¸‹æ“ä½œè¿‡ç¨‹å¹¶ä»‹ç»ä¸‹åŸå› ã€‚]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘æ¥åˆ°ä¸¤ä¸ªç”¨æˆ·æçš„JIRAï¼Œéƒ½æ˜¯ç›®å‰æ•°æ®åªå­˜åœ¨äº†ä¸€ä¸ªsrvé›†ç¾¤ï¼Œéœ€è¦å°†æ•°æ®å¤‡ä»½prcé›†ç¾¤åšæ•°æ®å¤‡ä»½æˆ–è€…ç¦»çº¿è®¡ç®—ï¼ŒåŒæ—¶ä¸¤é›†ç¾¤ä¹‹é—´è¿˜è¦åšæ•°æ®å®æ—¶åŒæ­¥ã€‚æ‰€ä»¥åœ¨è¿™é‡Œè®°å½•ä¸‹æ“ä½œè¿‡ç¨‹å¹¶ä»‹ç»ä¸‹åŸå› ã€‚</p><p>é›†ç¾¤ä¹‹é—´å¢é‡æ•°æ®åŒæ­¥è‡ªç„¶æ˜¯åˆ©ç”¨replicationï¼Œå•å‘åŒæ­¥é…ç½®ä¸€ä¸ªpeerï¼ŒåŒå‘åŒæ­¥é…ç½®ä¸¤ä¸ªpeerå°±å¥½ã€‚</p><p>å­˜é‡æ•°æ®ä½¿ç”¨snapshotåŒæ­¥ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ“ä½œæ­¥éª¤">æ“ä½œæ­¥éª¤<a class="hash-link" href="#æ“ä½œæ­¥éª¤" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p><strong>0. å‡†å¤‡å·¥ä½œ</strong></p><p>åœ¨prcé›†ç¾¤æ–°å»ºnamespace</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create_namespace 'ns'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>1. æ–°å»ºsrvåˆ°prcé›†ç¾¤çš„peer</strong></p><p><strong>æ³¨æ„peerè¦disableæ‰</strong></p><p>å¦‚æœä¹‹å‰æ²¡æœ‰srvåˆ°prcé›†ç¾¤çš„peerï¼Œç›´æ¥æ–°å»ºpeer</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// å¤åˆ¶namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_peer '1', CLUSTER_KEY =&gt; "zk1,zk2,zk3:11000:/hbase/prc", STATE =&gt; "DISABLED", NAMESPACES =&gt; ["ns"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// å¤åˆ¶table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_peer '1', CLUSTER_KEY =&gt; "zk1,zk2,zk3:11000:/hbase/prc", STATE =&gt; "DISABLED", TABLE_CFS =&gt; { "ns:table1" =&gt; [] }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚æœä¹‹å‰å·²ç»æœ‰srvåˆ°prcé›†ç¾¤çš„peerï¼Œåœ¨peerä¸­åŠ å…¥è¦æ“ä½œçš„namespace</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">disable_peer '1'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// æ–°åŠ namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">append_peer_namespaces '1', ["ns"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// æ–°åŠ table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">append_peer_tableCFs '1', { "ns:table1" =&gt; []}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2. æ‰“snapshot</strong></p><p>å°†è¦åŒæ­¥çš„è¡¨æ‰“snapshotï¼Œå¦‚æœå¤åˆ¶æ•´ä¸ªnamespaceï¼Œè¦ä¸€ä¸ªä¸€ä¸ªæ‰“</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">snapshot 'ns:table1', 'ns_table1_snapshot'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>3. å°†snapshotå¤åˆ¶åˆ°prcé›†ç¾¤</strong></p><p>ä½¿ç”¨<code>ExportSnapshot</code>å°†snapshotä»srvå¤åˆ¶åˆ°prcé›†ç¾¤</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./bin/hbase --config /path/to/conf org.apache.hadoop.hbase.snapshot.ExportSnapshot -copy-from hdfs://srv/hbase/srv -copy-to hdfs://prc/hbase/prc -snapshot ns_table1_snapshot -mappers 100 -bandwidth 512 -overwrite &gt;&gt; copy.log 2&gt;&amp;1 &amp;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>4. åœ¨prcé›†ç¾¤ä½¿ç”¨snapshotç”Ÿæˆè¡¨</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clone_snapshot 'ns_table1_snapshot', 'ns:table1'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>5. å¼€å¯peer</strong></p><p>å°†srvåˆ°prcé›†ç¾¤çš„peeræ‰“å¼€</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enable_peer '1'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>6. å…¶ä»–</strong></p><p>åœ¨peeré›†ç¾¤åŠ æƒé™</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">grant 'kerberos_name', 'RW', '@ns1'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚æœéœ€è¦ä¿©é›†ç¾¤åŒå‘åŒæ­¥ï¼Œåœ¨å¢åŠ prcåˆ°srvé›†ç¾¤çš„peer</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">add_peer '2', CLUSTER_KEY =&gt; "zk1,zk2,zk3:11000:/hbase/srv", STATE =&gt; "ENABLED", NAMESPACES =&gt; ["ns"]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ“ä½œåŸå› ">æ“ä½œåŸå› <a class="hash-link" href="#æ“ä½œåŸå› " title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æ•°æ®å¤åˆ¶è‡ªç„¶ä¸èƒ½ä¸¢æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¦ä¿è¯snapshotçš„å­˜é‡æ•°æ®å’Œreplicationçš„å¢é‡æ•°æ®ä¹‹é—´ä¸èƒ½æœ‰é—´éš™ï¼Œä½†å…¶å®å¯ä»¥æœ‰é‡å ã€‚</p><p>æˆ‘ä»¬å…ˆæ–°å»ºreplication peerï¼Œå°†ç°æœ‰çš„WALå’Œä¹‹åå†ç”Ÿæˆçš„WALéƒ½åŠ è¿›è¯¥peerçš„å¤åˆ¶é˜Ÿåˆ—ä¸­ï¼Œdisableæ‰peerçš„åŸå› åˆ™æ˜¯prcé›†ç¾¤è¿˜æ²¡æœ‰æ–°å»ºè¡¨ï¼Œreplicationå¼€å§‹å¤åˆ¶åˆ™ä¼šå‡ºç°<code>Table xxx does not exist</code>çš„æŠ¥é”™ã€‚è¿™ä¸€æ­¥å¦‚æœæ˜¯ä¿®æ”¹çš„åŸæœ‰peerï¼Œåˆ™ä¼šå¯¼è‡´replicationå»¶è¿Ÿå¢åŠ ã€‚</p><p>ä¹‹åå†æ‰“snapshotä¾¿ä¸ç”¨æ‹…å¿ƒæ•°æ®æœ‰ä¸¢å¤±äº†ï¼Œæ­¤æ—¶replicationçš„æ•°æ®ä¸snapshotçš„æ•°æ®å·²ç»æœ‰é‡å äº†ã€‚</p><p>æœ€åæ€»ç»“ä¸€å¥ï¼Œä¸€å®šè¦å…ˆæ–°å»ºreplication peerï¼Œç„¶ååœ¨æ‰“snapshotã€‚</p>]]></content>
        <author>
            <name>Ddupg</name>
            <uri>https://ddupg.github.io</uri>
        </author>
        <category label="HBase" term="HBase"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Mavené¡¹ç›®ä»¥Shadedå½¢å¼å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–åº“]]></title>
        <id>Shaded-Thirdparty-Dependencies</id>
        <link href="https://ddupg.github.io/blog/Shaded-Thirdparty-Dependencies"/>
        <updated>2020-01-13T17:46:00.000Z</updated>
        <summary type="html"><![CDATA[æœ€è¿‘æœ‰ç”¨æˆ·åé¦ˆï¼Œä»–çš„é¡¹ç›®ä¸­åŒæ—¶ä½¿ç”¨äº†HBaseå’Œä¸€ä¸ªRPCæ¡†æ¶ï¼ŒHBaseä¾èµ–2.5.0çš„protobufï¼ŒRPCæ¡†æ¶ä¾èµ–3.7çš„protobufï¼Œå¯¼è‡´ä»–çš„é¡¹ç›®ç¼–è¯‘éƒ½å¤±è´¥ã€‚0.98ç‰ˆæœ¬çš„HBaseè¿˜æ˜¯ä½¿ç”¨çš„åŸç”Ÿçš„protobuf-javaä¾èµ–ï¼Œ2.0ç‰ˆæœ¬æ‰ä½¿ç”¨äº†shadedå½¢å¼çš„protobufï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šè‡ªå·±æä¾›ä»¥shadedå½¢å¼å¼•å…¥protobufçš„HBase Clientã€‚]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰ç”¨æˆ·åé¦ˆï¼Œä»–çš„é¡¹ç›®ä¸­åŒæ—¶ä½¿ç”¨äº†HBaseå’Œä¸€ä¸ªRPCæ¡†æ¶ï¼ŒHBaseä¾èµ–2.5.0çš„protobufï¼ŒRPCæ¡†æ¶ä¾èµ–3.7çš„protobufï¼Œå¯¼è‡´ä»–çš„é¡¹ç›®ç¼–è¯‘éƒ½å¤±è´¥ã€‚0.98ç‰ˆæœ¬çš„HBaseè¿˜æ˜¯ä½¿ç”¨çš„åŸç”Ÿçš„protobuf-javaä¾èµ–ï¼Œ2.0ç‰ˆæœ¬æ‰ä½¿ç”¨äº†shadedå½¢å¼çš„protobufï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šè‡ªå·±æä¾›ä»¥shadedå½¢å¼å¼•å…¥protobufçš„HBase Clientã€‚</p><p>ç›¸ä¿¡è¿™ä¸ªé—®é¢˜ä¸åªæ˜¯å‡ºç°åœ¨HBaseä¸­ï¼Œæˆ–è€…å‡ºç°åœ¨ä¸protobufç›¸å…³çš„é¡¹ç›®ä¸­ï¼Œå…¶å®å½“æˆ‘ä»¬é¡¹ç›®é—´æ¥ä¾èµ–äº†åƒprotobufã€nettyç­‰å¤§ç‰ˆæœ¬ä¹‹é—´äº’ä¸å…¼å®¹çš„æ¡†æ¶ï¼Œç”šè‡³guavaè¿™ç§æŸäº›æ¥å£ä¸å…¼å®¹çš„æ¡†æ¶ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°ç±»ä¼¼çš„é—®é¢˜ã€‚è¿™é‡Œä¹Ÿæ˜¯æä¾›ä¸€ä¸ªå¯ä»¥å‚è€ƒçš„è§£å†³æ–¹æ³•ã€‚</p><p>æ–¹æ³•ä¸Šï¼Œå‚è€ƒäº†HBase 2.0ä¹‹åå¯¹ç¬¬ä¸‰æ–¹ä¾èµ–çš„å¤„ç†ï¼Œç®€å•æ¥è¯´å°±æ˜¯å°†å¸¸ç”¨ç¬¬ä¸‰æ–¹ä¾èµ–çš„ä»£ç è´Ÿè´£ä¸€ä»½ï¼Œä¿®æ”¹æ‰€æœ‰ç±»çš„packageï¼Œå‘å¸ƒä¸€ä¸ªè‡ªå·±çš„artifactåˆ°ä»“åº“ä¸­ã€‚è¿™æ ·è‚¯å®šå°±ä¸ä¼šå†ä¾èµ–å†²çªäº†ã€‚</p><p>è€Œprotobufçš„ä¾èµ–å¤„ç†èµ·æ¥åˆ™æ¯”è¾ƒéº»çƒ¦ä¸€ç‚¹ï¼Œé™¤äº†ä¿®æ”¹åŸç”Ÿprotobufç±»çš„packageä¹‹å¤–ï¼Œè¿˜éœ€è¦å¤„ç†protoç”Ÿæˆçš„Javaæ–‡ä»¶ã€‚æ‰€ä»¥æœ¬æ–‡å°±ä»¥protobufä¸ºä¾‹ï¼Œæä¾›ç¬¬ä¸‰æ–¹ä¾èµ–å†²çªçš„è§£å†³æ–¹æ¡ˆã€‚å› ä¸ºéƒ½æ˜¯ä½¿ç”¨Mavenæ’ä»¶å®ç°ï¼Œæ‰€ä»¥ä¹Ÿåªå¯¹Mavené¡¹ç›®æœ‰ç”¨ï¼Œç›¸ä¿¡å…¶ä»–é¡¹ç›®ä¹Ÿæœ‰ç±»ä¼¼çš„è§£å†³åŠæ³•ã€‚</p><p>æœ¬æ–‡ç›¸å…³ä»£ç éƒ½å·²æ”¾åœ¨<a href="https://github.com/ddupg/demos/tree/master/shaded" target="_blank" rel="noopener noreferrer">Github</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç”Ÿæˆshadedä¾èµ–åŒ…">ç”Ÿæˆshadedä¾èµ–åŒ…<a class="hash-link" href="#ç”Ÿæˆshadedä¾èµ–åŒ…" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>å¯ä»¥ç›´æ¥å‚è€ƒ<a href="https://github.com/ddupg/demos/blob/master/shaded/pom.xml" target="_blank" rel="noopener noreferrer">pom.xmlçš„ä»£ç </a>ï¼Œå…¶ä¸­ä¸»è¦ä½¿ç”¨åˆ°çš„æ’ä»¶æ˜¯ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li>maven-dependency-plugin å°†protobufä¾èµ–åŒ…ä¸‹è½½ä¸‹æ¥å¹¶è§£åŒ…æ”¾åœ¨src/main/javaç›®å½•ä¸‹ï¼Œå˜æˆè‡ªå·±é¡¹ç›®çš„æºç </li><li>maven-shade-plugin åœ¨æ‰“åŒ…é˜¶æ®µï¼Œä¿®æ”¹protobufç±»çš„packageåã€‚ä¾‹å¦‚HBaseé¡¹ç›®æ˜¯å°†<code>com.google.protobuf</code>æ”¹ä¸º<code>org.apache.hbase.thirdparty.com.google.protobuf</code>ï¼Œæˆ‘çš„ä»£ç ä¸­æ˜¯å°†<code>com.google.protobuf</code>æ”¹ä¸º<code>ddupg.demo.thirdparty.com.google.protobuf</code></li><li>maven-clean-plugin åœ¨æ“ä½œä¹‹å‰ï¼Œæ¸…ç†ä¸‹ä¹‹å‰ç”Ÿæˆçš„æ–‡ä»¶</li></ul><p>ä¿®æ”¹å¥½pomæ–‡ä»¶ä¹‹åï¼Œç›´æ¥mvn clean deployå‘å¸ƒåˆ°ä»“åº“å°±å¥½äº†ï¼Œä¸­å¤®ä»“åº“å’Œç§æœ‰ä»“åº“éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>å¯ä»¥è§£å‹targetç›®å½•ä¸‹æ‰“å¥½çš„åŒ…ï¼Œå°±å¯ä»¥çœ‹åˆ°classæ–‡ä»¶çš„packageè·¯å¾„å·²ç»å˜åŒ–äº†ã€‚å› ä¸ºæ˜¯åœ¨packageé˜¶æ®µæ‰ä¿®æ”¹çš„packageåï¼Œæ‰€ä»¥ç›´æ¥çœ‹target/generated-sourcesä¸‹çš„classæ–‡ä»¶å…¶å®æ˜¯ä¸å˜çš„ã€‚</p><p>æ™®é€šçš„ç¬¬ä¸‰æ–¹ä¾èµ–é¡¹ç›®ä½¿ç”¨è¿™ä¸€æ­¥å…¶å®å°±å¯ä»¥è§£å†³äº†ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç”Ÿæˆprotoæ–‡ä»¶">ç”Ÿæˆprotoæ–‡ä»¶<a class="hash-link" href="#ç”Ÿæˆprotoæ–‡ä»¶" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è§£å†³æ‰äº†protobufçš„æºæ–‡ä»¶ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å¤„ç†protoç”Ÿæˆçš„æ–‡ä»¶äº†ã€‚</p><p>å› ä¸ºéœ€è¦ä¾èµ–ä¸Šä¸€æ­¥ç”Ÿæˆçš„shadedåŒ…ï¼Œè€Œæˆ‘åˆæ²¡æœ‰å°†å®ƒdeployåˆ°ä¸­å¤®ä»“åº“ï¼Œä¹Ÿæ²¡æœ‰è‡ªå·±çš„ç§äººä»“åº“ï¼Œæ‰€ä»¥ä¾¿ä½¿ç”¨äº†<a href="https://github.com/apache/hbase-thirdparty" target="_blank" rel="noopener noreferrer">HBaseé¡¹ç›®çš„ç¬¬ä¸‰æ–¹ä¾èµ–</a>ï¼Œé“ç†éƒ½ä¸€æ ·ï¼Œæ›¿æ¢ä¸€ä¸‹dependencyå°±å¥½äº†ã€‚</p><p>å¯ä»¥ç›´æ¥å‚è€ƒ<a href="https://github.com/ddupg/demos/blob/master/shaded/shaded-protocol/pom.xml" target="_blank" rel="noopener noreferrer">pom.xmlçš„ä»£ç </a>.</p><p>è¿™ä¸€æ­¥ä¸»è¦ä½¿ç”¨çš„æ’ä»¶ï¼š</p><ul><li>protobuf-maven-plugin ç”Ÿæˆprotoæ–‡ä»¶ï¼Œè¿™ä¸€æ­¥ç”Ÿæˆçš„æ–‡ä»¶ä¾æ—§ä½¿ç”¨çš„æ˜¯åŸç”Ÿprotobufã€‚</li><li>com.google.code.maven-replacer-plugin:replacer æ›¿æ¢æºä»£ç ï¼Œå°†protobufåŸç”Ÿçš„packageè·¯å¾„<code>com.google.protobuf</code>æ”¹æˆç¬¬ä¸€æ­¥ä¸­ä¿®æ”¹åçš„packageåã€‚å› ä¸ºæˆ‘åœ¨è¿™é‡Œä½¿ç”¨çš„HBaseçš„ç¬¬ä¸‰æ–¹ä¾èµ–é¡¹ç›®ï¼Œæ‰€ä»¥å°±æ˜¯å°†<code>com.google.protobuf</code>æ”¹ä¸º<code>org.apache.hbase.thirdparty.com.google.protobuf</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å‚è€ƒ">å‚è€ƒ<a class="hash-link" href="#å‚è€ƒ" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><ul><li><a href="https://www.xolstice.org/protobuf-maven-plugin/" target="_blank" rel="noopener noreferrer">Maven Protocol Buffers Plugin</a></li><li><a href="https://maven.apache.org/plugins/maven-shade-plugin/" target="_blank" rel="noopener noreferrer">Apache Maven Shade Plugin</a></li><li><a href="https://code.google.com/archive/p/maven-replacer-plugin/" target="_blank" rel="noopener noreferrer">maven-replacer-plugin</a></li></ul>]]></content>
        <author>
            <name>Ddupg</name>
            <uri>https://ddupg.github.io</uri>
        </author>
        <category label="Java" term="Java"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[åˆæ­¥äº†è§£HBase Region Replicas]]></title>
        <id>Initial-Analysis-Region-Replicas</id>
        <link href="https://ddupg.github.io/blog/Initial-Analysis-Region-Replicas"/>
        <updated>2019-12-05T15:00:00.000Z</updated>
        <summary type="html"><![CDATA[èƒŒæ™¯]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="èƒŒæ™¯">èƒŒæ™¯<a class="hash-link" href="#èƒŒæ™¯" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>CAPåŸç†ä¸­ï¼ŒæŒ‡å‡ºå¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ (Consistency)ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰ï¼Œè€ŒHBaseåˆ™è¢«è®¾è®¡æˆä¸€ä¸ªCPç³»ç»Ÿï¼Œä¿è¯äº†å¼ºä¸€è‡´æ€§çš„åŒæ—¶ï¼Œé€‰æ‹©ç‰ºç‰²äº†ä¸€å®šçš„å¯ç”¨æ€§ã€‚</p><p>åœ¨å¯¹HBaseçš„å‹æµ‹ä¸­ï¼Œå¾ˆå®¹æ˜“å‘ç°è™½ç„¶HBaseçš„å¹³å‡è¯»å†™å»¶è¿Ÿå¾ˆä½ï¼Œä½†å´å­˜åœ¨å¾ˆé«˜çš„æ¯›åˆºï¼ŒP99ã€P999å»¶è¿Ÿå¾ˆé«˜ï¼Œä¸»è¦çš„ä¸€ä¸ªå½±å“å› ç´ åˆ™æ˜¯å•ç‚¹çš„GCï¼Œå¦å¤–Regionçš„MTTRï¼ˆå¹³å‡ä¿®å¤æ—¶é—´ï¼‰ä¹Ÿè¾ƒé«˜ï¼Œä¸€æ—¦æŸä¸ªRegionServerå®•æœºæˆ–æŸä¸ªRegionå‡ºç°é—®é¢˜ï¼Œç”šè‡³æ˜¯ä¸€æ¬¡Full GCï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°è¾ƒé•¿æ—¶é—´çš„ä¸å¯ç”¨ï¼Œå½±å“å¯ç”¨æ€§ã€‚</p><p>HBaseçš„Read Region ReplicasåŠŸèƒ½ï¼Œæä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬ï¼Œåœ¨regionæ¢å¤æœŸé—´æˆ–è¯·æ±‚æ—¶é—´è¿‡é•¿æ—¶ï¼Œæ”¯æŒæœ€ç»ˆä¸€è‡´æ€§çš„è¯»æœåŠ¡ã€‚åœ¨ä¸€äº›ä¸è¦æ±‚å¼ºä¸€è‡´æ€§çš„åº”ç”¨ä¸­ï¼Œå¯ä»¥é€šè¿‡æ­¤åŠŸèƒ½æ¥æé«˜å¯ç”¨æ€§é™ä½è¯»è¯·æ±‚å»¶è¿Ÿã€‚</p><p>ä¸ºäº†å®ç°é«˜å¯ç”¨è¯»ï¼ŒHBaseæä¾›äº†ä¸€ä¸ªfeatureï¼Œå«<code>region replication</code>ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸‹ï¼Œè¡¨çš„æ¯ä¸ªregionï¼Œéƒ½ä¼šæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„RegionServerä¸Šã€‚é»˜è®¤region replicationä¸º1ï¼Œæ­¤æ—¶ä¸ä¹‹å‰çš„regionæ¨¡å‹å¹¶æ— ä¸åŒã€‚å½“region replicationè¢«è®¾ç½®ä¸º2æˆ–æ›´å¤šæ—¶ï¼ŒMasterå°†ä¼šassignæ‰€æœ‰regionçš„secondary regionï¼ŒLoad Balancerä¼šä¿è¯åŒä¸€ä¸ªregionçš„å¤šä¸ªå¤‡ä»½ä¼šè¢«åˆ†æ•£åœ¨ä¸åŒçš„RegionServerä¸Šã€‚</p><p>ä¸€ä¸ªregionçš„æ‰€æœ‰å‰¯æœ¬éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„replica_idã€‚replica_id=0çš„æ˜¯primary regionï¼ˆå’Œä¹‹å‰æ¨¡å‹ä¸­å”¯ä¸€çš„regionä¸€æ ·ï¼‰ï¼Œå…¶ä»–çš„å‰¯æœ¬regionè¢«éƒ½å«åšsecondary regionã€‚</p><p>primary regionï¼Œæ”¯æŒè¯»å†™è¯·æ±‚ï¼›secondary regionï¼Œåªæ”¯æŒè¯»è¯·æ±‚ã€‚å¦‚æ­¤è®¾è®¡ä¿è¯primary regionä¾æ—§å…·æœ‰å¼ºä¸€è‡´æ€§ï¼ŒåŒæ—¶æé«˜è¯»å¯ç”¨æ€§ã€‚ä½†ä¹Ÿå› ä¸ºå†™è¯·æ±‚åªæœ‰primary regionå¯ä»¥å¤„ç†ï¼Œæ‰€ä»¥å†™è¯·æ±‚ä¾ç„¶ä¼šå› ä¸ºprimary regionä¸å¯ç”¨è€Œè¢«é˜»å¡ï¼ŒHBaseçš„å†™å¯ç”¨æ€§ä¾ç„¶æ²¡æœ‰å¾—åˆ°æ”¹å–„ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="timeline-consistency">Timeline Consistency<a class="hash-link" href="#timeline-consistency" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨è¯¥åŠŸèƒ½çš„å®ç°ä¸­ï¼ŒHBaseæä¾›äº†ä¸€ç§æ”¯æŒ<strong>å•æ¬¡è¯»è¯·æ±‚</strong>çš„ä¸€è‡´æ€§å®šä¹‰ã€‚</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public enum Consistency {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STRONG,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMELINE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>HBaseé»˜è®¤çš„å°±æ˜¯<code>Consistency.STRONG</code>å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼Œä¸ä¹‹å‰çš„æ¨¡å‹ä¸€æ ·ï¼Œæ‰€æœ‰è¯»å†™æ“ä½œéƒ½é€šprimary regionå®Œæˆã€‚</p><p>è€Œå½“clientä½¿ç”¨<code>Consistency.TIMELINE</code>çš„ä¸€è‡´æ€§å‘èµ·è¯»è¯·æ±‚æ—¶ï¼Œä¼šé¦–å…ˆå‘primary regionå‘èµ·è¯·æ±‚ï¼Œä¸€å®šæ—¶é—´å†…æ²¡æœ‰è¿”å›å“åº”ï¼Œåˆ™åŒæ—¶å¹¶å‘å‘æ‰€æœ‰çš„secondary regionå‘èµ·è¯·æ±‚ï¼Œæœ€ç»ˆé‡‡ç”¨ç‡å…ˆè¿”å›çš„è¯·æ±‚ã€‚ä¸ºäº†åŒºåˆ†æœ€ç»ˆçš„å“åº”æ˜¯å¦æ¥è‡ªsecondary regionï¼Œåœ¨<code>Result</code>ä¸­å¢åŠ äº†<code>stale</code>çš„booleanå±æ€§ï¼Œ<code>true</code>åˆ™è¡¨ç¤ºæ¥è‡ªsecondary regionã€‚</p><p>ä»è¯­ä¹‰ä¸Šè®²ï¼ŒHBaseçš„TIMELINEä¸€è‡´æ€§å¹¶ä¸åŒäºå¸¸è§çš„æœ€ç»ˆä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆã€‚</p><ul><li>å³ä½¿å­˜åœ¨å¤šå‰¯æœ¬ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘å‰¯æœ¬ä¹‹é—´æ•°æ®å†²çªçš„é—®é¢˜ã€‚</li><li>secondary regionæ¥æ”¶primary regionåŒæ­¥çš„æ•°æ®ï¼ŒæŒ‰åŒæ ·é¡ºåºå¤„ç†æ•°æ®ï¼Œæ‰€ä»¥secondary regionæ€»æ˜¯primary regionåœ¨ä¹‹å‰æŸä¸ªæ—¶åˆ»çš„å¿«ç…§ã€‚ä»è¿™ä¸€ç‚¹ä¸Šçœ‹ï¼Œæ›´åƒæ˜¯RDBMSï¼ˆå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼‰çš„å¤åˆ¶ã€æˆ–æ˜¯HBaseå¤šæ•°æ®ä¸­å¿ƒå¤šé›†ç¾¤ä¹‹é—´çš„å¤åˆ¶ã€‚</li><li>å¦ä¸€æ–¹é¢ï¼Œclientå¯ä»¥è‡ªè¡Œå†³å®šæ˜¯å¦éœ€è¦è¯»å–æœ€æ–°æ•°æ®ï¼Œè‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ç§ä¸€è‡´æ€§æ¥æ»¡è¶³åŠŸèƒ½éœ€æ±‚ã€‚</li><li>clientä¾ç„¶ä¼šè¯»åˆ°ä¹±åºçš„æ•°æ®ï¼Œæ¯”å¦‚å¤šæ¬¡è¯·æ±‚å‘å¾€äº†ä¸åŒçš„regionã€‚ç›®å‰å¹¶æ²¡æœ‰ç±»ä¼¼äºäº‹åŠ¡çš„ä¸œè¥¿æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li></ul><p><img loading="lazy" alt="Timeline Consistency" src="/assets/images/timeline_consistency-cbd096b06c5cd9b876ac242581fd5752.png" width="720" height="540" class="img_ev3q"></p><p>æ ¹æ®ä¸Šå›¾æˆ‘ä»¬æ¥æ›´å¥½çš„ç†è§£TIMELINEçš„è¯­ä¹‰ã€‚é¦–å…ˆclient1æŒ‰é¡ºåºå†™äº†x=1,x=2,x=3ï¼Œprimary regionä¹ŸæŒ‰å†™å…¥é¡ºåºå¤„ç†ï¼Œå¹¶å°†WALåŒæ­¥ç»™å…¶ä»–secondary regionï¼ˆä¸€ç§æ•°æ®åŒæ­¥æ–¹å¼ï¼Œåé¢ä¼šå†è®²ï¼‰ã€‚åœ¨å›¾ä¸­æ³¨æ„åˆ°ï¼Œreplica_1åªæ¥æ”¶åˆ°ä¸¤æ¬¡æ›´æ–°ï¼Œæ‰€ä»¥æœ€ç»ˆæ•°æ®æ˜¯x=2ï¼Œreplica_2åªæ¥æ”¶åˆ°1æ¬¡æ›´æ–°ï¼Œæ•°æ®æ˜¯x=1ã€‚</p><p>å¦‚æœclient1ä½¿ç”¨STRONGä¸€è‡´æ€§æ¥è¯»æ•°æ®ï¼Œéƒ½åªä¼šå’Œprimary regionäº¤äº’ï¼Œæ•°æ®éƒ½æ˜¯æœ€æ–°å€¼x=3ã€‚å¯å¦‚æœä½¿ç”¨TIMELINEä¸€è‡´æ€§è¯»å–æ•°æ®ï¼Œæœ‰å¯èƒ½å’Œæ‰€æœ‰å‰¯æœ¬åšäº¤äº’ï¼Œæœ€ç»ˆè·å¾—çš„æ•°æ®1ã€2ã€3éƒ½æœ‰å¯èƒ½ã€‚å¦‚æœclientè¯·æ±‚å¤šæ¬¡ï¼Œç”šè‡³å¯èƒ½å‡ºç°æ•°æ®å›é€€ï¼Œå³ç¬¬1æ¬¡è¯·æ±‚è·å¾—x=2ï¼Œç¬¬2æ¬¡è¯·æ±‚åˆ™è·å¾—äº†x=1ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å®ç°">å®ç°<a class="hash-link" href="#å®ç°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ•°æ®æ¨¡å‹">æ•°æ®æ¨¡å‹<a class="hash-link" href="#æ•°æ®æ¨¡å‹" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><img loading="lazy" alt="ä¸€ä¸ªregion replicationä¸º2çš„è¡¨åœ¨metaè¡¨ä¸­çš„åˆ—" src="/assets/images/meta-4e25459c12011f47545533ebf41291ce.png" title="ä¸€ä¸ªregion replicationä¸º2çš„è¡¨åœ¨metaè¡¨ä¸­çš„åˆ—" width="1150" height="96" class="img_ev3q"></p><p>åœ¨ä¸Šå›¾ä¸­ï¼Œæ˜¯ä¸€ä¸ªregion replicationä¸º2çš„è¡¨åœ¨metaè¡¨ä¸­infoåˆ—æ—ä¸‹çš„åˆ—ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€äº›åä¸ºinfo:xxx_0001çš„åˆ—ï¼Œè¿™äº›åˆ—å­˜å‚¨çš„æ•°æ®å°±æ˜¯replica_id=1çš„secondary regionçš„æ•°æ®ã€‚åŒç†ï¼Œå½“regionçš„å¤‡ä»½æ•°é‡æ›´å¤šæ—¶ï¼Œmetaè¡¨ä¸­åä¸ºinfo:xxx_0002ã€info:xxx_0003çš„åˆ—å­˜å‚¨çš„åˆ™ä¸ºreplica_idä¸º2ã€3çš„secondary regionçš„æ•°æ®ã€‚</p><p>æ˜ç™½äº†metaè¡¨ä¸­æ˜¯å¦‚ä½•å­˜å‚¨secondary regionæ•°æ®ï¼Œclientè¦è·å–secondary regionæ‰€åœ¨çš„RegionServerè‡ªç„¶ä¹Ÿç®€å•ï¼Œå¤šè§£æå‡ ä¸ªserver_xxxxçš„åˆ—ä¾¿å¯ä»¥äº†ã€‚</p><p><img loading="lazy" alt="clientè®¿é—®secondary region" src="/assets/images/client-read-replicas-ccdc2076b27cf4c406b28e22fcf3f5d0.png" title="clientè®¿é—®secondary region" width="547" height="356" class="img_ev3q"></p><p>ä¸Šå›¾å±•ç¤ºçš„æ˜¯clientè®¿é—®secondary regionçš„ç¤ºæ„å›¾ã€‚HBaseçš„è¯»è¯·æ±‚æœ‰ä¸¤ç§ï¼ŒGetå’ŒScanã€‚å¯¹äºGetè¿™ç§æ— çŠ¶æ€çš„è¯·æ±‚ï¼Œæ¯æ¬¡RPCå¯¹serverç«¯æ¥è¯´éƒ½æ˜¯ä¸€æ¬¡ç‹¬ç«‹çš„è¯·æ±‚ã€‚clientç«¯çš„ç”¨æˆ·å¯ä»¥å¤šæ¬¡è¶…æ—¶é‡è¯•ï¼Œç›´åˆ°è·å–åˆ°æ•°æ®ï¼›ä¹Ÿå¯ä»¥å¹¶å‘è¯·æ±‚å¤šä¸ªreplicaï¼Œé€‰æ‹©ç‡å…ˆè¿”å›çš„æ•°æ®ï¼›è¿˜å¯ä»¥ä½¿ç”¨TIMELINE Readï¼Œè¯·æ±‚primary regionè¶…æ—¶ä¹‹åå†è¯·æ±‚å…¶ä»–secondary regionã€‚ä½†å¯¹äºScanè¿™ç§æœ‰çŠ¶æ€çš„è¯·æ±‚ï¼Œä¸€æ¬¡scanå¯èƒ½ä¸åŒä¸€ä¸ªregionäº¤äº’å¤šæ¬¡ï¼Œä¹Ÿå¯èƒ½è·¨å¤šä¸ªregionå¤šä¸ªRegionServerè¯·æ±‚æ•°æ®ï¼Œserverç«¯ä¼šè®°å½•æ¯ä¸ªscançš„çŠ¶æ€æ•°æ®ï¼Œé‚£ä¹ˆä¸€æ¬¡scanäº§ç”Ÿçš„å¤šæ¬¡RPCä¾¿ä¸èƒ½éšæ„åœ°å‘ç»™æ‰€æœ‰çš„replicaã€‚</p><p><img loading="lazy" alt="client scanè¿‡ç¨‹" src="/assets/images/client_scan_replicas-fd7fa07654a40cb9ee74b05ea7769eb9.png" title="client scanè¿‡ç¨‹" width="735" height="344" class="img_ev3q"></p><p>ä¸Šå›¾å±•ç¤ºçš„æ˜¯clientæ‰§è¡Œä¸€ä¸ªè·¨regionçš„scanè¿‡ç¨‹ï¼Œå‡è®¾å½“å‰è¡¨æœ‰2ä¸ªé€»è¾‘regionï¼ˆRegion_Aå’ŒRegion_Bï¼‰ï¼Œregionçš„èµ·å§‹åŒºé—´åˆ†åˆ«ä¸º[a, d)ã€[d, f)ï¼Œä¸”è¯¥è¡¨çš„region replicationä¸º2ï¼Œå³æ¯ä¸ªé€»è¾‘regionéƒ½æœ‰ä¸€ä¸»ä¸€å¤‡ï¼Œ4ä¸ªregionåˆ†å¸ƒåœ¨4ä¸ªRegionServerä¸Šã€‚å½“æˆ‘ä»¬æ‰§è¡Œä¸€æ¬¡scanæ“ä½œï¼Œè®¾ç½®cacheingä¸º2ï¼ˆæ¯æ¬¡RPCæœ€å¤šè·å–2ä¸ªResultï¼‰ï¼Œåˆ™scanè‡³å°‘è¿›è¡Œ4æ¬¡RPCï¼Œå›¾ä¸­è¿çº¿åˆ™è¡¨ç¤ºæ¯æ¬¡RPCï¼Œè¿çº¿ä¸Šçš„æ•°å­—è¡¨ç¤ºRPCçš„é¡ºåºç¼–å·ï¼Œè™šçº¿è¡¨ç¤ºRPCè¶…æ—¶æˆ–è¿”å›å¤ªæ…¢ç»“æœæ²¡æœ‰è¢«é‡‡ç”¨ã€‚å¯ä»¥çœ‹åˆ°å½“clientè¦è¿›è¡Œç¬¬1æ¬¡RPCæ—¶ï¼Œå°†è¯·æ±‚åŒæ—¶å‘ç»™äº†Region_Açš„ä¸»å¤‡2ä¸ªregionï¼Œå› ä¸ºæ­¤æ—¶serverç«¯æ˜¯æ²¡æœ‰ä»»ä½•å…³äºæ­¤æ¬¡scançš„çŠ¶æ€æ•°æ®ï¼Œclientå¯ä»¥é€‰æ‹©ç‡å…ˆè¿”å›å“åº”çš„regionè¿›è¡Œåç»­çš„RPCäº¤äº’ã€‚å½“ç¬¬2æ¬¡RPCæ—¶ä¾¿ä¸å¯ä»¥éšæ„é€‰æ‹©regionäº†ï¼Œå› ä¸ºRegion_A_primaryå­˜å‚¨äº†æ­¤æ¬¡scançš„çŠ¶æ€æ•°æ®ï¼Œè€ŒRegion_A_replica_1æ²¡æœ‰ï¼Œå¦‚æœè¯·æ±‚Region_A_replica_1åˆ™åªä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å½“ç¬¬2æ¬¡RPCç»“æŸï¼Œå·²ç»è·å–äº†Region_Aä¸­çš„å…¨éƒ¨æ•°æ®ï¼Œä¾¿å¯ä»¥æ¸…ç†æ‰Region_A_primaryä¸­å­˜å‚¨çš„çŠ¶æ€æ•°æ®äº†ã€‚å½“ç¬¬3æ¬¡RPCæ—¶ï¼Œå’Œç¬¬1æ¬¡æ—¶æƒ…å†µæœ‰äº›ç±»ä¼¼ï¼Œserverç«¯æš‚æ—¶æ²¡æœ‰å­˜å‚¨scançš„çŠ¶æ€æ•°æ®äº†ï¼Œclientä¾¿å¯ä»¥åƒç¬¬1æ¬¡RPCä¸€æ ·ï¼Œå°†è¯·æ±‚åŒæ—¶å‘ç»™äº†Region_Açš„ä¸»å¤‡2ä¸ªregionã€‚ç¬¬4æ¬¡RPCåˆ™åƒç¬¬2æ¬¡ä¸€æ ·ã€‚æ€»ç»“ä¸€ä¸‹ï¼šå½“scanè¿›è¡ŒTIMELINE Readæ—¶ï¼Œåªæœ‰å¯¹æ¯ä¸ªé€»è¾‘regionçš„ç¬¬1æ¬¡rpcå¯ä»¥ä»»æ„é€‰æ‹©regionè¯·æ±‚ã€‚</p><p>ç›®å‰ï¼ŒRead Region ReplicasåŠŸèƒ½å¹¶æ²¡æœ‰æ”¯æŒæ‰¹é‡è¯·æ±‚ï¼Œå³æ‰¹é‡Getã€Scanéƒ½æ˜¯ç›´æ¥è¯·æ±‚primary regionã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ•°æ®åŒæ­¥">æ•°æ®åŒæ­¥<a class="hash-link" href="#æ•°æ®åŒæ­¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>secondary regionè¦æ”¯æŒè¯»è¯·æ±‚ï¼Œåˆ™å¿…ç„¶è¦æœ‰æ•°æ®ï¼Œè€Œsecondary regionåˆä¸æ”¯æŒå†™è¯·æ±‚ï¼Œé‚£ä¹ˆæ•°æ®æ˜¯å“ªæ¥çš„å‘¢ï¼Ÿ</p><p><img loading="lazy" alt="RegionServer å†…éƒ¨ç»“æ„" src="/assets/images/rs-structure-4c2478b8d9d3eed71dec635557afba24.png" title="RegionServer å†…éƒ¨ç»“æ„" width="691" height="369" class="img_ev3q"></p><p>ä»HBaseçš„æ•°æ®æ¨¡å‹ä¸Šçœ‹ï¼Œæ•°æ®ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šMemStoreå’ŒHFileã€‚HFileå­˜å‚¨äºHDFSä¸Šï¼Œsecondary regionåªè¦åŠæ—¶è·çŸ¥HFileçš„å˜åŒ–ä¾¿å¯ä»¥è·å–ã€‚ä½†MemStoreå­˜åœ¨äºå†…å­˜ï¼Œå´åªæœ‰primary regionæŒæœ‰ã€‚ä»¥ä¸‹ä¾¿ä»‹ç»ä¸¤ç§secondary regionåŒæ­¥æ•°æ®çš„æ–¹å¼ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="storefile-refresher">StoreFile Refresher<a class="hash-link" href="#storefile-refresher" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ç¬¬ä¸€ç§æ–¹å¼æ˜¯StoreFile Refresherï¼Œåœ¨HBase-1.0+ç‰ˆæœ¬å¼•å…¥ã€‚åœ¨RegionServerä¸Šæœ‰ä¸€ä¸ªStorefileRefresherChoreä»»åŠ¡ï¼Œä¼šå®šæœŸåœ°åœ¨HDFSä¸Šæ£€æŸ¥primary regionçš„HFileæœ‰æ²¡æœ‰å˜åŒ–ï¼Œä»¥æ­¤æ¥åŠæ—¶çš„å‘ç°primary regioné€šè¿‡flushã€compactã€bulk loadç­‰æ“ä½œäº§ç”Ÿçš„æ–°HFileã€‚</p><p>è¯¥æ–¹æ¡ˆå®ç°ä¸Šè¾ƒä¸ºç®€å•ï¼Œä¹Ÿä¸éœ€è¦å¤ªå¤šå¤šä½™çš„å­˜å‚¨å’Œç½‘ç»œå¼€é”€ï¼Œä½†ç¼ºç‚¹ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œåœ¨æ•°æ®å†™å…¥primary regionï¼Œåˆ°secondary regionå¯ä»¥è¯»åˆ°æ•°æ®ï¼Œæœ‰ç›¸å½“é•¿çš„æ—¶é—´é—´éš”ï¼Œä¸­é—´éœ€è¦ç­‰å¾…memstoreçš„flushå’ŒStorefileRefresherChoreä»»åŠ¡çš„å®šæ—¶åˆ·æ–°ã€‚</p><p>å¦‚æœè¦å¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼Œåªè¦å°†<code>hbase.regionserver.storefile.refresh.period</code>é…ç½®è®¾ç½®ä¸ºéé›¶å€¼å³å¯ï¼Œè¡¨ç¤ºStorefileRefresherChoreä»»åŠ¡åˆ·æ–°çš„æ—¶é—´é—´éš”ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="asynchronous-replication">Asynchronous Replication<a class="hash-link" href="#asynchronous-replication" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>HBaseæœ‰æä¾›é›†ç¾¤é—´replicationåŠŸèƒ½ï¼Œåˆ©ç”¨WALåœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´åŒæ­¥æ•°æ®ã€‚åœ¨HBase-1.1+ç‰ˆæœ¬ä¸­ï¼Œä¾¿åˆ©ç”¨replicationåœ¨é›†ç¾¤å†…éƒ¨åŒæ­¥æ•°æ®ï¼Œå°†å®æ—¶å†™å…¥çš„WALåŒæ­¥åˆ°secondary regionã€‚</p><p><img loading="lazy" alt="Asynchronous Replicationç¤ºæ„å›¾" src="/assets/images/region_replica_replication-0e540a03227d17865c1070363956a8bb.png" title="Asynchronous Replication ç¤ºæ„å›¾" width="552" height="495" class="img_ev3q"></p><p>å¦‚ä¸Šå›¾ä¸­æ‰€ç¤ºï¼Œé€šè¿‡å®ç°ä¸€ä¸ªç‰¹æ®Šçš„<code>ReplicationEndpoint</code>ä¾¿å¯ä»¥å°†WALçš„æ•°æ®åŒæ­¥ç»™é›†ç¾¤ä¸­çš„å…¶ä»–RegionServerã€‚å¦‚æ­¤primary region MemStoreä¸­çš„æ•°æ®ï¼Œä¹Ÿé€šè¿‡replicationå®æ—¶åŒæ­¥åˆ°secondary regionï¼Œä»secondary regionä¸­ä¹Ÿå¯ä»¥è¯»åˆ°primary regionè¿˜æ²¡æœ‰flushåˆ°HFileçš„æ•°æ®ã€‚æ‰€ä»¥åˆ©ç”¨<code>Asnyc WAL replication</code>çš„åŒæ­¥æ–¹å¼æ¯”ä¸Šé¢è®²åˆ°çš„<code>StoreFile Refresher</code>åŒæ­¥æ–¹å¼å…·æœ‰æ›´ä½çš„åŒæ­¥å»¶è¿Ÿã€‚</p><p>primary regionè¿˜ä¼šå°†flushã€compactionå’Œbulk loadäº‹ä»¶å†™åˆ°WALï¼ŒåŒæ ·ç”±replicationåŠŸèƒ½åŒæ­¥åˆ°secondary regionã€‚å½“secondary regionæ¥æ”¶åˆ°è¿™äº›äº‹ä»¶æ—¶ï¼Œä¾¿ä¹Ÿå›æ”¾åŒæ ·çš„äº‹ä»¶æ¥æ›´æ–°è‡ªå·±çš„æ•°æ®ã€‚æ‰€ä»¥å¯¹HFileæ–‡ä»¶åˆ—è¡¨çš„æ›´æ–°ä¹Ÿæ¯”<code>StoreFile Refresher</code>å®šæ—¶åˆ·æ–°çš„æ–¹å¼æ›´åŠ å®æ—¶ã€‚</p><p>åœ¨è¿™ç§åŒæ­¥æ¨¡å¼ä¸‹ï¼Œsecondary regionçš„MemStoreä¸­ä¹Ÿæ˜¯æœ‰æ•°æ®ï¼Œä»WALåŒæ­¥çš„Put/Deleteæ“ä½œå°±pPrimaryrRegionä¸€æ ·å†™å…¥MemStoreï¼Œå¹¶ä¸”secondary regionä¹Ÿä¼šä½¿ç”¨block cacheï¼Œæ‰€ä»¥åœ¨è¿™ç§æ¨¡å¼ä¸­å†…å­˜çš„å¼€é”€ä¼šæˆå€çš„å¢é•¿ã€‚ä¸åŒäºprimary regionçš„æ˜¯ï¼Œsecondary regionåœ¨æ¥æ”¶åˆ°flushäº‹ä»¶æ—¶ï¼Œå¹¶ä¸ä¼šå°†MemStoreä¸­çš„æ•°æ®flushæˆHFileï¼Œåªä¼šé‡Šæ”¾æ‰MemStoreå ç”¨çš„å†…å­˜ã€‚</p><p><code>Asnyc WAL replication</code>åŠŸèƒ½é»˜è®¤æ˜¯å…³é—­çš„ã€‚éœ€è¦è®¾ç½®<code>hbase.region.replica.replication.enabled</code>ä¸º<code>true</code>æ¥æ‰“å¼€è¿™ä¸ªåŠŸèƒ½ã€‚å½“ç¬¬ä¸€æ¬¡åˆ›å»ºä¸€ä¸ªregion replicationå¤§äº1çš„è¡¨æ—¶ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ªåä¸º<code>region_replica_replication</code>çš„replication peerï¼Œè¿™ä¸ªreplication peerå°†è´Ÿè´£é›†ç¾¤å†…æ‰€æœ‰è¡¨region replicaçš„æ•°æ®åŒæ­¥ã€‚ä¸€æ—¦å¼€å¯ä¹‹åæƒ³è¦å†å…³é—­è¯¥åŠŸèƒ½ï¼Œå°±ä¸åªæ˜¯æ”¹<code>hbase.region.replica.replication.enabled</code>ä¸º<code>false</code>äº†ï¼Œè¿˜éœ€è¦disableæ‰<code>region_replica_replication</code>è¿™ä¸ªreplication peerã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å­˜åœ¨çš„é—®é¢˜">å­˜åœ¨çš„é—®é¢˜<a class="hash-link" href="#å­˜åœ¨çš„é—®é¢˜" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hfileçš„è¿‡æœŸæ—¶é—´">HFileçš„è¿‡æœŸæ—¶é—´<a class="hash-link" href="#hfileçš„è¿‡æœŸæ—¶é—´" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>åœ¨ä»¥ä¸Šä¸¤ç§æ•°æ®åŒæ­¥æ–¹å¼ä¸­ï¼Œéƒ½ä¼šåœ¨å¤šä¸ªRegionServerä¸Šæ‰“å¼€åŒä¸€ä¸ªHFileï¼Œæ‰€ä»¥å½“primary regionè¿›è¡Œå®Œäº†major compactionä¹‹åï¼Œsecondary regionå› ä¸ºHFileæ–‡ä»¶å˜åŒ–æ›´æ–°ä¸åŠæ—¶ï¼Œä¾æ—§å¼•ç”¨ç€æ—§çš„HFileã€‚ç›®å‰å¹¶æ²¡æœ‰æœ‰æ•ˆçš„æªæ–½ä¿è¯HFileæ–‡ä»¶å¹¶ä¸ä¼šè¢«è¿‡æ—©çš„åˆ é™¤ã€‚åªèƒ½æ˜¯å°†é…ç½®é¡¹<code>hbase.master.hfilecleaner.ttl</code>è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§çš„å€¼ï¼Œæ¯”å¦‚ä¸€å°æ—¶ï¼Œä»¥æ­¤æ¥å°½é‡é¿å…è¯·æ±‚è¿‡ç¨‹ä¸­ä¸ä¼šå‡ºé”™ã€‚ä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ HDFSçš„å­˜å‚¨å¼€é”€ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="replicationä¸èƒ½åŒæ­¥metaè¡¨æ•°æ®">replicationä¸èƒ½åŒæ­¥metaè¡¨æ•°æ®<a class="hash-link" href="#replicationä¸èƒ½åŒæ­¥metaè¡¨æ•°æ®" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ç›®å‰çš„Asynchronous ReplicationåŠŸèƒ½å¹¶ä¸èƒ½åŒæ­¥metaè¡¨çš„WALæ•°æ®ï¼ˆæœ€åˆè¯¥åŠŸèƒ½æ˜¯ç”¨äºé›†ç¾¤é—´åŒæ­¥æ•°æ®çš„ï¼Œæ¯•ç«Ÿä¸èƒ½æŠŠmetaæ•°æ®åŒæ­¥ç»™å…¶ä»–é›†ç¾¤ï¼‰ã€‚æ‰€ä»¥å¯¹äºmetaè¡¨çš„æ“ä½œï¼Œå¹¶ä¸èƒ½é€šè¿‡replicationå°½å¿«çš„åŒæ­¥åˆ°secondary regionï¼Œåªèƒ½é€šè¿‡ç±»ä¼¼äº<code>StoreFile Refresher</code>çš„æ–¹å¼ï¼Œä½¿ç”¨å®šæ—¶åˆ·æ–°çš„ä»»åŠ¡æ¥åŒæ­¥metaè¡¨HFileæ–‡ä»¶çš„å˜åŒ–ã€‚</p><p><code>hbase.regionserver.meta.storefile.refresh.period</code>é…ç½®é¡¹ç”¨äºæ§åˆ¶metaè¡¨StoreFileçš„æ›´æ–°æ—¶é—´ã€‚è¯¥é…ç½®é¡¹å¹¶ä¸åŒäº<code>StoreFile Refresher</code>åŠŸèƒ½çš„<code>hbase.regionserver.storefile.refresh.period</code>ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="å†…å­˜æ¶ˆè€—">å†…å­˜æ¶ˆè€—<a class="hash-link" href="#å†…å­˜æ¶ˆè€—" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>åœ¨ä¹‹å‰å·²ç»æåˆ°ï¼ŒAsynchronous ReplicationåŒæ­¥å› ä¸ºä½¿ç”¨MemStoreå’Œblock cacheï¼Œä¼šå¯¼è‡´å†…å­˜å¼€é”€æˆå€å¢åŠ ã€‚å¹¶ä¸”secondary regionå¹¶ä¸ä¼šä¸»åŠ¨è¿›è¡Œflushï¼Œåªä¼šå½“æ¥æ”¶åˆ°åŒæ­¥çš„WALä¸­çš„flushäº‹ä»¶æ—¶ï¼Œæ‰ä¼šè¿›è¡Œflushã€‚åœ¨ä¸€äº›æç«¯æƒ…å†µä¸‹ï¼Œæ¯”å¦‚replicationé˜»å¡æ”¶ä¸åˆ°flushäº‹ä»¶ã€primary regionç¡®å®é•¿æ—¶é—´æ²¡æœ‰è¿›è¡ŒflushsecondaryarRegionæŒæœ‰çš„å†…å­˜å¾—ä¸åˆ°é‡Šæ”¾ï¼Œè€Œä¸€ä¸ªRegionServerä¸ŠåŒæ—¶æœ‰å¤šä¸ªprimary regionå’Œsecondary regionï¼Œå†…å­˜çš„è¿‡åº¦æ¶ˆè€—å¯èƒ½ä¼šé˜»å¡primary regionæ­£å¸¸çš„å†™å…¥æ“ä½œï¼Œä¹Ÿä¼šé˜»å¡replicationåŒæ­¥çš„flushäº‹ä»¶ã€‚</p><p>æ‰€ä»¥HBaseæä¾›äº†ä¸€ä¸ªé…ç½®é¡¹<code>hbase.region.replica.storefile.refresh.memstore.multiplier</code>ï¼Œé»˜è®¤å€¼ä¸º4ï¼Œè¡¨ç¤ºå¦‚æœsecondary regionçš„MemStoreæ¯”primary regionæœ€å¤§çš„MemStoreçš„4å€è¿˜è¦å¤§æ—¶ï¼Œä¾¿å…secondaryarRegionè‡ªè¡Œrefreshæ£€æŸ¥HFileæ–‡ä»¶æ˜¯å¦å˜åŒ–ï¼Œå¦‚æœprimary regionæ—©å·²flushè¿‡ï¼Œå´å› ä¸ºreplicationé˜»å¡æ²¡æœ‰åŒæ­¥åˆ°ï¼Œåˆ™å¯ä»¥åˆ©ç”¨è¯¥æœºåˆ¶è¿›è¡Œflushã€‚é»˜è®¤æƒ…å†µä¸‹æœ€å¥½ä¸è¦æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œå¯ä»¥æŠŠè¯¥é…ç½®é¡¹è®¾ç½®å¤§ä¸€äº›æ¥é¿å…ã€‚</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="secondary-region-failover">secondary region Failover<a class="hash-link" href="#secondary-region-failover" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>å½“ä¸€ä¸ªsecondary regionåˆšopenæˆ–è€…fail overï¼Œæ­¤æ—¶å¿…ç„¶ä¸¢å¤±äº†ä¹‹å‰MemStoreçš„æ•°æ®ï¼Œå› ä¸ºsecondary regionæ¯•ç«Ÿä¸èƒ½åƒprimary regionä¸€æ ·é€šè¿‡å›æ”¾WALæ¥æ¢å¤MemStoreã€‚å¦‚æœæ­¤æ—¶ç›´æ¥æä¾›è¯»æœåŠ¡ï¼Œåˆ™å¯èƒ½å‡ºç°æ•°æ®ç‰ˆæœ¬å›é€€çš„é—®é¢˜ï¼Œå³æ¢å¤ä¹‹åæ¯”æ¢å¤ä¹‹å‰è¯»åˆ°çš„æ•°æ®æ›´æ—§ã€‚ä¸ºäº†é¿å…æ•°æ®å›é€€ï¼Œsecondary regionå°±å¿…é¡»ç­‰å¾…primary regionè¿›è¡Œä¸€æ¬¡å®Œæ•´çš„flushæ“ä½œæˆ–open regionäº‹ä»¶ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œsecondary regionéƒ½å°†æ‹’ç»æ¥æœåŠ¡ã€‚</p><p><code>hbase.region.replica.wait.for.primary.flush</code>é…ç½®é¡¹æ˜¯è¯¥æœºåˆ¶çš„å¼€å…³ï¼Œé»˜è®¤æ˜¯<code>enable</code>å¼€å¯ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ä½¿ç”¨">ä½¿ç”¨<a class="hash-link" href="#ä½¿ç”¨" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="é…ç½®">é…ç½®<a class="hash-link" href="#é…ç½®" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><strong>serverç«¯</strong></p><table><thead><tr><th>é…ç½®é¡¹</th><th>é»˜è®¤å€¼</th><th>å•ä½</th><th>æè¿°</th></tr></thead><tbody><tr><td>hbase.regionserver.storefile.refresh.period</td><td>0</td><td>æ¯«ç§’</td><td>secondary regionåˆ·æ–°storefileçš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤0ä¸ºå…³é—­</td></tr><tr><td>hbase.regionserver.meta.storefile.refresh.period</td><td>0</td><td>æ¯«ç§’</td><td>secondary regionåˆ·æ–°hbase:metaè¡¨storefileçš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤0ä¸ºå…³é—­</td></tr><tr><td>hbase.region.replica.replication.enabled</td><td>false</td><td></td><td>æ˜¯å¦å¼€å¯<code>Asnyc WAL replication</code>åŠŸèƒ½ï¼Œå¼€å¯åå†æƒ³å…³é—­ï¼Œéœ€è¦æ”¹ä¸ºfalseä¹‹åå†disableæ‰<code>region_replica_replication</code>çš„peer</td></tr><tr><td>hbase.master.hfilecleaner.ttl</td><td>300000(5åˆ†é’Ÿ)</td><td>æ¯«ç§’</td><td>storefileæ–‡ä»¶çš„è¿‡æœŸåˆ é™¤æ—¶é—´é—´éš”</td></tr><tr><td>hbase.meta.replica.count</td><td>1</td><td>ä¸ª</td><td>metaè¡¨çš„region replicationæ•°é‡</td></tr><tr><td>hbase.region.replica.storefile.refresh.memstore.multiplier</td><td>4</td><td>å€</td><td>secondary regionçš„MemStoreå¤§äºåŒRegionServerä¸Šprimary regionæœ€å¤§çš„MemStoreè¯¥å€æ•°æ—¶ï¼Œä¼šè§¦å‘åˆ·æ–°storefileæ–‡ä»¶åˆ—è¡¨çš„ä»»åŠ¡</td></tr><tr><td>hbase.region.replica.wait.for.primary.flush</td><td>true</td><td></td><td>secondary region openä¹‹åï¼Œæ˜¯å¦è¦ç­‰å¾…primary regionè¿›è¡Œä¸€æ¬¡flushå†æä¾›æœåŠ¡</td></tr><tr><td>hbase.master.loadbalancer.class</td><td>org.apache.hadoop.hbase.master.balancer.StochasticLoadBalancer</td><td></td><td>é»˜è®¤çš„å®ç°å¯ä»¥ä¿è¯regionçš„replicaså°½é‡ä¸ä¼šåˆ†å¸ƒåœ¨åŒä¸€ä¸ªRegionServerä¸Šï¼Œå¦‚æœä¿®æ”¹è¯¥é…ç½®ï¼Œè¦æ³¨æ„replicasçš„åˆ†å¸ƒ</td></tr></tbody></table><p><strong>clientç«¯</strong></p><table><thead><tr><th>é…ç½®é¡¹</th><th>é»˜è®¤å€¼</th><th>å•ä½</th><th>æè¿°</th></tr></thead><tbody><tr><td>hbase.ipc.client.specificThreadForWriting</td><td>false</td><td></td><td>æ˜¯å¦ä½¿ç”¨ç‰¹æ®Šçº¿ç¨‹ç”¨äºå†™è¯·æ±‚ã€‚ä½¿ç”¨region replicasåŠŸèƒ½ï¼Œç»å¸¸ä¼šåœ¨IOè¿‡ç¨‹ä¸­ä¸­æ–­çº¿ç¨‹ï¼Œæ‰€ä»¥å¿…é¡»å¼€å¯è¯¥é…ç½®</td></tr><tr><td>hbase.client.primaryCallTimeout.get</td><td>10000</td><td>å¾®ç§’</td><td>TIMELINEä¸€è‡´æ€§Getæ—¶ï¼Œç­‰å¾…primary regionå“åº”çš„æ—¶é—´ï¼Œè¶…æ—¶ä¹‹åä¾¿è¯·æ±‚secondary region</td></tr><tr><td>hbase.client.primaryCallTimeout.scan</td><td>10000</td><td>å¾®ç§’</td><td>TIMELINEä¸€è‡´æ€§Scanæ—¶ï¼Œç­‰å¾…primary regionå“åº”çš„æ—¶é—´ï¼Œè¶…æ—¶ä¹‹åä¾¿è¯·æ±‚secondary region</td></tr><tr><td>hbase.meta.replicas.use</td><td>false</td><td></td><td>æ˜¯å¦ä½¿ç”¨metaè¡¨çš„secondary region</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å»ºè¡¨">å»ºè¡¨<a class="hash-link" href="#å»ºè¡¨" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><code>REGION_REPLICATION</code>å‚æ•°æ§åˆ¶è¡¨ä¸­regionæœ‰å¤šå°‘å¤‡ä»½ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œå³åªæœ‰primary regionã€‚</p><p>shellæ–¹å¼å»ºè¡¨</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create </span><span class="token string" style="color:#e3116c">'t1'</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">'f1'</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">REGION_REPLICATION </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>shellæ–¹å¼ä¿®æ”¹è¡¨</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alter </span><span class="token string" style="color:#e3116c">'t1'</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">REGION_REPLICATION </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="client">Client<a class="hash-link" href="#client" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Clientè®¿é—®secondary regionå¿…é¡»è¦ç”¨æˆ·æ˜ç¡®çš„è¡¨ç¤ºå¯ä»¥æ¥æ”¶éå¼ºä¸€è‡´æ€§çš„æ•°æ®ï¼Œå¦‚æœå¸Œæœ›è¯·æ±‚å¯ä»¥å‘é€ç»™secondary regionï¼Œå¿…é¡»æ˜ç¡®æŒ‡å®šä¸º<code>TIMELINE</code>çš„ä¸€è‡´æ€§ã€‚</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public enum Consistency {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STRONG,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMELINE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="shell">Shell<a class="hash-link" href="#shell" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>å…è®¸ä»¥<code>TIMELINE</code>çš„ä¸€è‡´æ€§è¯»å–æ•°æ®</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hbase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:001:</span><span class="token operator file-descriptor important" style="color:#393A34">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> get </span><span class="token string" style="color:#e3116c">'t1'</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">'r6'</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">CONSISTENCY </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"TIMELINE"</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hbase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:001:</span><span class="token operator file-descriptor important" style="color:#393A34">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> get </span><span class="token string" style="color:#e3116c">'t1'</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">'r6'</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">CONSISTENCY </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"TIMELINE"</span><span class="token plain">, , REGION_REPLICA_ID </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="java">Java<a class="hash-link" href="#java" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>Get</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get get = new Get(row);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get.setConsistency(Consistency.TIMELINE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Result result = table.get(get);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Scan</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Scan scan = new Scan();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scan.setConsistency(Consistency.TIMELINE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ResultScanner scanner = table.getScanner(scan);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¯ä»¥é€šè¿‡<code>Result.isStale()</code>åˆ¤æ–­æ•°æ®æ˜¯å¦æ¥è‡ªäºsecondary region</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Result result = table.get(get);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (result.isStale()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ€§èƒ½æµ‹è¯•">æ€§èƒ½æµ‹è¯•<a class="hash-link" href="#æ€§èƒ½æµ‹è¯•" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p><strong>æœºå™¨é…ç½®</strong></p><p>HBaseç‰ˆæœ¬ï¼š2.2.0
HDFSç‰ˆæœ¬ï¼š 3.1.4</p><table><thead><tr><th>service</th><th>job</th><th>å®ä¾‹æ•°</th><th>cpu</th><th>disk</th><th>netowork</th><th>comment</th></tr></thead><tbody><tr><td>HBase</td><td>master</td><td>2</td><td>-</td><td>-</td><td>-</td><td>-</td></tr><tr><td>HBase</td><td>region server</td><td>5</td><td>24 core</td><td>12*3.7T HDD</td><td>10000bps</td><td>onheap=50g/offheap=50g</td></tr><tr><td>HDFS</td><td>namenode</td><td>2</td><td>-</td><td>-</td><td>-</td><td>onheap=10g</td></tr><tr><td>HDFS</td><td>datanode</td><td>5</td><td>24 core</td><td>12*3.7T HDD</td><td>10000bps</td><td>onheap=2g</td></tr></tbody></table><p><strong>ä¸é™åˆ¶QPS</strong></p><table><thead><tr><th></th><th>strong</th><th>timeline-10ms</th><th>reta</th></tr></thead><tbody><tr><td>qps_sec</td><td>12608.23</td><td>11171.18</td><td>-11.4%</td></tr><tr><td>max_latency_us</td><td>195174.38</td><td>202603.69</td><td>3.81%</td></tr><tr><td>min_latency_us</td><td>149.38</td><td>148.75</td><td>-0.42%</td></tr><tr><td>avg_latency_us</td><td>3760.69</td><td>4276.76</td><td>13.72%</td></tr><tr><td>p90_latency_us</td><td>11811.92</td><td>14258.31</td><td>20.71%</td></tr><tr><td>p99_latency_us</td><td>32512.23</td><td>31148.14</td><td>-4.2%</td></tr><tr><td>p999_latency_us</td><td>64646.38</td><td>58621.93</td><td>-9.32%</td></tr><tr><td>p9999_latency_us</td><td>136835.92</td><td>115951.63</td><td>-15.26%</td></tr></tbody></table><p><strong>é™åˆ¶7000QPS</strong></p><table><thead><tr><th></th><th>strong</th><th>timeline-10ms</th><th>reta</th></tr></thead><tbody><tr><td>qps_sec</td><td>6999.58</td><td>6999.56</td><td>-0.0%</td></tr><tr><td>max_latency_us</td><td>126860.75</td><td>130148.86</td><td>2.59%</td></tr><tr><td>min_latency_us</td><td>147.25</td><td>150.68</td><td>2.33%</td></tr><tr><td>avg_latency_us</td><td>3223.38</td><td>3495.51</td><td>8.44%</td></tr><tr><td>p90_latency_us</td><td>10612.49</td><td>11379.48</td><td>7.23%</td></tr><tr><td>p99_latency_us</td><td>23793.54</td><td>24469.25</td><td>2.84%</td></tr><tr><td>p999_latency_us</td><td>48791.00</td><td>39795.06</td><td>-18.44%</td></tr><tr><td>p9999_latency_us</td><td>93389.08</td><td>78618.61</td><td>-15.82%</td></tr></tbody></table><p>å¯¹å•Clientå®ä¾‹åšå‹åŠ›æµ‹è¯•ï¼Œ<code>hbase.client.primaryCallTimeout.get</code>å‚æ•°è®¾ç½®ä¸º10000ï¼Œå³ç­‰å¾…primary regionå“åº”çš„æ—¶é—´è¶…æ—¶10msä¹‹åä¾¿è¯·æ±‚secondary regionã€‚</p><p>ç¬¬ä¸€ç»„æé™QPSçš„å‹æµ‹ä¸­ï¼Œå¯ä»¥çœ‹å‡ºå¼€å¯TIMELINE Readä¹‹åï¼ŒQPSæœ‰ä¸€å®šæŸå¤±ï¼Œå¹³å‡å»¶è¿Ÿæœ‰ä¸€å®šå‡é«˜ï¼ŒP999å’ŒP9999ä¸€å®šç¨‹åº¦ä¼˜åŒ–ã€‚ä¼˜åŒ–æ•ˆæœæœ‰é™ã€‚</p><p>å› ä¸ºread replicasä¼šå¢åŠ çº¿ç¨‹èµ„æºçš„ä½¿ç”¨ï¼Œè€Œæ—¥å¸¸ä½¿ç”¨ä¹Ÿä¸ä¼šæŠŠClientä¾§å‹åˆ°æé™ï¼Œæ‰€ä»¥åˆåšäº†ä¸€ç»„é™åˆ¶QPSçš„å‹æµ‹ï¼Œå¯ä»¥çœ‹åˆ°å„é¡¹å»¶è¿ŸæŒ‡æ ‡å‡æœ‰æ‰€å¥½è½¬ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p><code>Region Replica</code>åŠŸèƒ½å¯ä»¥æé«˜HBaseçš„è¯»å¯ç”¨æ€§ï¼Œä½†ä¹Ÿè¦æ ¹æ®å…·ä½“çš„ç”¨ä¾‹è€ƒè™‘æ˜¯å¦é€‚ç”¨ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ä¼˜ç‚¹">ä¼˜ç‚¹<a class="hash-link" href="#ä¼˜ç‚¹" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li>å½“åº”ç”¨ä¾èµ–æ˜¯åªè¯»çš„è¡¨ï¼Œæˆ–è€…åº”ç”¨å¹¶ä¸è¦æ±‚å¼ºä¸€è‡´æ€§ï¼ˆè¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¯ä»¥æ¥å—çŸ­æ—¶é—´å†…æ•°æ®ä¸ä¸€è‡´ï¼‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥åŠŸèƒ½æ¥æé«˜è¯»å¯ç”¨æ€§ã€‚åœ¨RegionServeræˆ–Regionå‡ºç°å•ç‚¹æ•…éšœæ¢å¤æœŸé—´æˆ–é•¿æ—¶é—´Full GCæœŸé—´å°½é‡ä¿è¯ä¸šåŠ¡è¯»è¯·æ±‚æ­£å¸¸ï¼Œå‡å°‘MTTRè¿‡é•¿å¯¹ä¸šåŠ¡äº§ç”Ÿçš„å½±å“ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‡å°‘å¤§é‡é‡è¯•è¯·æ±‚è¿›ä¸€æ­¥åœ°å¢åŠ æ•…éšœèŠ‚ç‚¹çš„å‹åŠ›ã€‚</li><li>å¯¹äºéƒ¨åˆ†ä¸è¦æ±‚å¼ºä¸€è‡´æ€§ä¸”å¯¹å»¶è¿Ÿæ¯›åˆºæœ‰ä¸€å®šè¦æ±‚çš„åº”ç”¨ï¼Œå½“åœ¨Clientä¾§QPSè¾ƒä½æˆ–CPUã€å¸¦å®½ç­‰èµ„æºå¯Œä½™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥åŠŸèƒ½é™ä½è¯»è¯·æ±‚P99/P999å’ŒP9999å»¶è¿Ÿã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ç¼ºç‚¹">ç¼ºç‚¹<a class="hash-link" href="#ç¼ºç‚¹" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><ul><li>å¤šå€çš„MemStoreå¯¼è‡´æ›´å¤šçš„å†…å­˜æ¶ˆè€—</li><li>å¢åŠ block cacheçš„éœ€æ±‚å’Œä½¿ç”¨</li><li>ä¸ºäº†ä¼ è¾“WALå¯¼è‡´æ›´å¤šçš„ç½‘ç»œå¸¦å®½æ¶ˆè€—</li><li>å¤§é‡çš„é›†ç¾¤å†…éƒ¨RPCè¯·æ±‚</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å‚è€ƒ">å‚è€ƒ<a class="hash-link" href="#å‚è€ƒ" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><ul><li><a href="http://hbase.apache.org/book.html#arch.timelineconsistent.reads" target="_blank" rel="noopener noreferrer">Timeline-consistent High Available Reads</a></li><li><a href="https://issues.apache.org/jira/browse/HBASE-10070" target="_blank" rel="noopener noreferrer">HBASE-10070</a></li><li><a href="https://issues.apache.org/jira/secure/attachment/12616659/HighAvailabilityDesignforreadsApachedoc.pdf" target="_blank" rel="noopener noreferrer">HighAvailabilityDesignforreadsApachedoc.pdf</a></li></ul>]]></content>
        <author>
            <name>Ddupg</name>
            <uri>https://ddupg.github.io</uri>
        </author>
        <category label="HBase" term="HBase"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ã€Œè®°ã€Jdk8 CompletableFutureåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹çš„æ€§èƒ½é—®é¢˜]]></title>
        <id>CompletableFuture-in-high-concurrent</id>
        <link href="https://ddupg.github.io/blog/CompletableFuture-in-high-concurrent"/>
        <updated>2019-10-11T19:30:00.000Z</updated>
        <summary type="html"><![CDATA[æœ€è¿‘çš„å·¥ä½œå†…å®¹å°±æ˜¯å†™ä¸€ä¸ª DualHBaseClientï¼Œåœ¨æŸ¥è¯¢æ•°æ®æ—¶é—´è¿‡é•¿æ—¶ï¼Œèƒ½å¤Ÿå°†åŒæ ·çš„è¯·æ±‚å‘ç»™ replication çš„é›†ç¾¤ï¼Œç¼©å° client ç«¯çš„ p99ã€p999 å»¶è¿Ÿï¼Œå‡å°æ¯›åˆºã€‚]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘çš„å·¥ä½œå†…å®¹å°±æ˜¯å†™ä¸€ä¸ª <code>DualHBaseClient</code>ï¼Œåœ¨æŸ¥è¯¢æ•°æ®æ—¶é—´è¿‡é•¿æ—¶ï¼Œèƒ½å¤Ÿå°†åŒæ ·çš„è¯·æ±‚å‘ç»™ replication çš„é›†ç¾¤ï¼Œç¼©å° client ç«¯çš„ p99ã€p999 å»¶è¿Ÿï¼Œå‡å°æ¯›åˆºã€‚
å®é™…å¼€å‘æœ€åˆçš„ä¸€ç‰ˆä»£ç éƒ½æ²¡æœ‰èŠ±è´¹1pdï¼Œæ€§èƒ½æµ‹è¯•å€’æµ‹äº†å¥½å‡ å¤©éƒ½ä¸åŠé¢„æœŸï¼Œç”šè‡³ä¼˜åŒ–ä¹‹åå„æ–¹é¢æ€§èƒ½æ›´å·®åŠ²ã€‚</p><p>æœ¬æ–‡å°±æ˜¯è®°å½•ä¸‹å¯¼è‡´æ­¤æ¬¡æ€§èƒ½é—®é¢˜çš„ä¸»è¦åŸå› ï¼šCompletableFuture.</p><p>ä½¿ç”¨ Java å¼‚æ­¥ç¼–ç¨‹çš„æ—¶å€™ï¼Œ<code>CompletableFuture</code> ç”¨èµ·æ¥è¿˜æ˜¯ç›¸å½“èˆ’æœçš„ï¼Œåœ¨HBaseçš„å¼‚æ­¥APIé‡Œï¼Œä¹Ÿå¤§é‡çš„ä½¿ç”¨äº†<code>CompletableFuture</code>ï¼Œå¦‚æœ <code>CompletableFuture</code> æœ‰æ€§èƒ½é—®é¢˜ï¼Œé‚£å¯å°±æ‚²å‚¬äº†ã€‚</p><p>çœ‹ä¸‹ä»¥ä¸‹è¿™æ®µæµ‹è¯•<code>CompletableFuture</code>çš„ä»£ç </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.google.common.collect.Lists;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.concurrent.CompletableFuture;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.concurrent.ExecutionException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FutureTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws ExecutionException, InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new FutureTest().run();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void run() throws ExecutionException, InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;CompletableFuture&gt; futures = Lists.newArrayList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; 1000; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CompletableFuture future = new CompletableFuture();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CompletableFuture f = CompletableFuture.runAsync(this::read);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            f.whenComplete((r, e) -&gt; future.complete(r));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            futures.add(future);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (CompletableFuture future : futures) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            future.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void read() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Thread.sleep(100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä»¥ä¸Šè¿™æ®µä»£ç å®é™…åªæ˜¯è®© <code>CompletableFuture</code> ç©ºè½¬ï¼Œé™¤äº† sleep æ²¡å†åšå…¶ä»–çš„ï¼Œå¾ªç¯1000è®©è¿è¡Œæ—¶é—´å°½é‡é•¿ä¸€äº›ï¼Œè¶³å¤Ÿè®©æˆ‘ä»¬è·‘ä¸€ä¸ªç«ç„°å›¾å‡ºæ¥ã€‚</p><p><img loading="lazy" alt="ç«ç„°å›¾" src="/assets/images/CompletableFuture-in-jdk8-traces-5268b75d0499fa3aef10b4efa6ab80c8.svg" width="1200" height="742" class="img_ev3q"></p><p>ç«ç„°å›¾é‡Œæ³¨æ„åˆ°æœ‰ä¸ªæœ€å¤§çš„å¹³é¡¶ <code>java.lang.Runtime.availableProcessors</code>ï¼Œè¯¥æ–¹æ³•è€—æ—¶æå¤§ï¼Œç”šè‡³è¶…è¿‡äº† Thread.sleepï¼Œè¿™å¯ä¸æ­£å¸¸å§ã€‚</p><p>éšåæˆ‘ä»¬æµ‹ä¸‹ <code>java.lang.Runtime.availableProcessors()</code> æ–¹æ³•æ˜¯ä¸æ˜¯çœŸçš„æ…¢ã€‚</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.google.common.base.Stopwatch;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.junit.Assert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.junit.Test;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.concurrent.TimeUnit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AvailableProcessorsTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void test() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Stopwatch sw = Stopwatch.createStarted();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; 1000000; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Runtime.getRuntime().availableProcessors();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert.assertTrue(sw.elapsed(TimeUnit.SECONDS) &gt; 10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨æˆ‘çš„æœºå™¨ä¸Šå¾ªç¯1000000æ¬¡ï¼Œè€—æ—¶è¶…è¿‡äº†10sï¼Œä¸ç®—å¿«ã€‚</p><p>å†æ¥çœ‹çœ‹ <code>CompletableFuture</code> æ˜¯æ€ä¹ˆä½¿ç”¨ <code>Runtime.availableProcessors()</code> çš„</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private Object waitingGet(boolean interruptible) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while ((r = result) == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (spins &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spins = (Runtime.getRuntime().availableProcessors() &gt; 1) ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                1 &lt;&lt; 8 : 0; // Use brief spin-wait on multiprocessors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else if (spins &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (ThreadLocalRandom.nextSecondarySeed() &gt;= 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                --spins;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>while æ­»å¾ªç¯è¦ç›´åˆ°å‡ºç°å¼‚å¸¸æˆ–è·å–åˆ°æœ€ç»ˆç»“æœæ‰ä¼šç»“æŸï¼Œè€Œå¾ªç¯ä¸­åˆä¼šå¤§é‡è°ƒç”¨ <code>Runtime.availableProcessors()</code>ï¼Œè¿™å°±æ˜¯<code>CompletableFuture</code>å­˜åœ¨çš„æ€§èƒ½é—®é¢˜ã€‚</p><p>è€Œå®é™…ä¸ŠOpenjdkå·²æœ‰å¯¹è¯¥é—®é¢˜çš„è®¨è®ºï¼Œ<a href="https://bugs.openjdk.java.net/browse/JDK-8227018" target="_blank" rel="noopener noreferrer">JDK-8227018</a>ï¼Œè¯¥ä¼˜åŒ–ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨è¿™é‡Œå…¶å®åªæ˜¯éœ€è¦çŸ¥é“è¿è¡Œç¯å¢ƒæ˜¯ä¸æ˜¯å¤šå¤„ç†å™¨ç¯å¢ƒè€Œå·²ï¼Œç¼“å­˜èµ·æ¥å°±å¥½ï¼Œå®Œå…¨æ²¡å¿…è¦æ¯æ¬¡å¾ªç¯éƒ½å»è·å–ã€‚åœ¨jdk8u232ç‰ˆæœ¬å°±fixæ‰äº†ã€‚</p><p>è€Œä¸”æˆ‘è¿˜çœ‹äº† jdk11ã€jdk13 çš„å®ç°ï¼Œéƒ½ä¸å†ä½¿ç”¨<code>Runtime.availableProcessors()</code>äº†ï¼Œæ‰€ä»¥ç®—æ˜¯ä½ç‰ˆæœ¬ jdk8 ç”¨æˆ·ç‹¬æœ‰çš„çƒ¦æ¼ã€‚</p><blockquote><p>ä¸€ä¸ªå°æ’æ›²</p><p>jdk8u232ç‰ˆæœ¬æ˜¯2019.10.15æ‰æ­£å¼releaseçš„ï¼Œè€Œæˆ‘å‘ç°è¿™ä¸ªé—®é¢˜æ˜¯åœ¨10.13ã€‚
ä¹Ÿå¹¸è¿ä¹Ÿä¸å¹¸ï¼Œå¹¸è¿çš„æ˜¯èµ·ç é—®é¢˜fixæ‰äº†ï¼Œä¸å¹¸çš„æ˜¯ DualHBaseClient ä¸èƒ½é‡‡ç”¨ CompletableFuture å®ç°äº†ï¼Œæ€»ä¸å¥½è¦æ±‚ç”¨æˆ·å‡çº§jdkå§</p></blockquote><p>çŸ¥é“ä½ç‰ˆæœ¬çš„ jdk8 æœ‰é—®é¢˜ä¹‹åï¼Œ<code>DualHBaseClient</code> è¿˜æ˜¯è¦å†™çš„ï¼Œåªèƒ½å¯»æ±‚å…¶ä»–çš„å¼‚æ­¥æ¡†æ¶æ¥å®ç°ï¼Œå¥½åœ¨ guava çš„ <code>ListenableFuture</code> å®ç°å¾ˆåƒ<code>CompletableFuture</code>ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>å¦‚æœæ˜¯jdk8ä½ç‰ˆæœ¬ç”¨æˆ·ï¼ˆåˆšå‘å¸ƒå‡ å¤©ä¸ä¼šæœ‰å…¬å¸å‡çº§å§ï¼‰é¢‘ç¹çš„å¤§é‡ä½¿ç”¨ CompletableFutureï¼Œæ˜¯å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œå‡çº§ jdk æ˜¯æœ€ç®€å•çš„åŠæ³•ï¼Œä½¿ç”¨ guava çš„ Future åº“å®ç°ä¹Ÿå¯ä»¥ï¼Œä½†å¯èƒ½è¦å¤§é‡ä¿®æ”¹ä»£ç äº†ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="é™„å½•">é™„å½•<a class="hash-link" href="#é™„å½•" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><ul><li><a href="https://blog.wangqi.love/articles/Java/%E7%81%AB%E7%84%B0%E5%9B%BE%E6%8E%92%E6%9F%A5Java%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98.html" target="_blank" rel="noopener noreferrer">ç«ç„°å›¾æ’æŸ¥Javaæ€§èƒ½é—®é¢˜</a></li><li><a href="https://bugs.openjdk.java.net/browse/JDK-8227018" target="_blank" rel="noopener noreferrer">JDK-8227018</a></li></ul>]]></content>
        <author>
            <name>Ddupg</name>
            <uri>https://ddupg.github.io</uri>
        </author>
        <category label="Jdk" term="Jdk"/>
        <category label="Java" term="Java"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ã€Œè®°ã€å­ç±»å¤å†™çˆ¶ç±»æ–¹æ³•ä¸ç±»åˆå§‹åŒ–é¡ºåºå¼•å‘çš„bug]]></title>
        <id>class-init-order-in-inheritance</id>
        <link href="https://ddupg.github.io/blog/class-init-order-in-inheritance"/>
        <updated>2019-09-30T10:00:00.000Z</updated>
        <summary type="html"><![CDATA[bugç°è±¡]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bugç°è±¡">bugç°è±¡<a class="hash-link" href="#bugç°è±¡" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>bugå‡ºç°çš„æ¡ä»¶ï¼š</p><ul><li>ç»§æ‰¿å…³ç³»</li><li>å­ç±»å±æ€§æœ‰é»˜è®¤çš„åˆå§‹åŒ–</li><li>å­ç±»å¤å†™äº†çˆ¶ç±»çš„é’©å­æ–¹æ³•</li><li>é’©å­æ–¹æ³•åœ¨çˆ¶ç±»æ„é€ æ–¹æ³•ä¸­è°ƒç”¨</li></ul><p>å¯ä»¥çœ‹ä¸‹ä»¥ä¸‹çš„ç¤ºä¾‹ä»£ç </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Father {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Father() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        init();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Child extends Father {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int a = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Child() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super.init();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.junit.Test;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import static org.junit.Assert.*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ChildTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void testConstructor() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Child child = new Child();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assertEquals(0, child.a);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç±»åŠ è½½è¿‡ç¨‹">ç±»åŠ è½½è¿‡ç¨‹<a class="hash-link" href="#ç±»åŠ è½½è¿‡ç¨‹" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>é¡ºä¾¿å¤ä¹ ä¸€ä¸‹ç±»åŠ è½½è¿‡ç¨‹ï¼Œç±»åŠ è½½è¿‡ç¨‹åˆ†ä¸ºåŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–ä¸‰å¤§æ­¥éª¤</p><p>åŠ è½½ï¼šæŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµæ•°æ®ï¼Œå¹¶ä¸”æ®æ­¤åˆ›å»ºç±»ï¼Œå³ä»£è¡¨è¿™ä¸ªç±»çš„Classå¯¹è±¡ã€‚</p><p>é“¾æ¥ï¼šå°†åˆ›å»ºæˆçš„ç±»åˆå¹¶è‡³Javaè™šæ‹Ÿæœºä¸­ï¼Œä½¿ä¹‹èƒ½å¤Ÿæ‰§è¡Œçš„è¿‡ç¨‹ã€‚è¿˜åˆ†éªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªé˜¶æ®µã€‚</p><ul><li>éªŒè¯ï¼šç¡®ä¿è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§</li><li>å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼</li><li>è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</li></ul><p>åˆå§‹åŒ–ï¼šæ ‡è®°ä¸ºå¸¸é‡å€¼çš„å­—æ®µèµ‹å€¼ï¼Œä»¥åŠæ‰§è¡Œæ–¹æ³•ã€‚åˆå§‹åŒ–çš„æ—¶æœºï¼š</p><ol><li>è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œåˆå§‹åŒ–ç”¨æˆ·æŒ‡å®šçš„ä¸»ç±»</li><li>å½“é‡åˆ°ä»¥æ–°å»ºç›®æ ‡ç±»å®ä¾‹çš„newæŒ‡ä»¤æ—¶ï¼Œåˆå§‹åŒ–newæŒ‡å®šçš„ç›®æ ‡ç±»</li><li>å½“é‡åˆ°è°ƒç”¨é™æ€æ–¹æ³•çš„æŒ‡ä»¤å­—æ®µæ˜¯ï¼Œåˆå§‹åŒ–è¯¥é™æ€æ–¹æ³•æ‰€åœ¨çš„ç±»</li><li>å½“é‡åˆ°è®¿é—®é™æ€å­—æ®µçš„æŒ‡ä»¤æ—¶ï¼Œåˆå§‹åŒ–è¯¥é™æ€å­—æ®µæ‰€åœ¨çš„ç±»</li><li>å­ç±»çš„åˆå§‹åŒ–ä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–</li><li>å¦‚æœä¸€ä¸ªæ¥å£å®šä¹‰äº†defaultæ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥æˆ–é—´æ¥å®ç°è¯¥æ¥å£çš„ç±»åˆå§‹åŒ–ï¼Œä¼šè§¦</li><li>è¯¥æ¥å£çš„åˆå§‹åŒ–</li><li>ä½¿ç”¨åå°„APIå¯¹æŸä¸ªç±»è¿›è¡Œåå°„è°ƒç”¨æ—¶ï¼Œåˆå§‹åŒ–è¿™ä¸ªç±»</li><li>å½“åˆæ¬¡è°ƒç”¨MethodHandleå®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–è¯¥MethodHandleæŒ‡å‘çš„æ–¹æ³•æ‰€åœ¨çš„ç±»</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ç±»åˆå§‹åŒ–é¡ºåº">ç±»åˆå§‹åŒ–é¡ºåº<a class="hash-link" href="#ç±»åˆå§‹åŒ–é¡ºåº" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><ol><li>æŒ‰å®šä¹‰é¡ºåºåˆå§‹åŒ–çˆ¶ç±»çš„staticæˆå‘˜ï¼Œåœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</li><li>æŒ‰å®šä¹‰é¡ºåºåˆå§‹åŒ–å­ç±»çš„staticæˆå‘˜ï¼Œåœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</li><li>æŒ‰å®šä¹‰é¡ºåºæ‰§è¡Œçˆ¶ç±»çš„æ™®é€šæˆå‘˜åˆå§‹åŒ–</li><li>æ‰§è¡Œçˆ¶ç±»çš„æ„é€ å‡½æ•°</li><li>æŒ‰å®šä¹‰é¡ºåºæ‰§è¡Œå­ç±»çš„æŒ‡å®šåˆå§‹åŒ–</li><li>æ‰§è¡Œå­ç±»çš„æ„é€ å‡½æ•°</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å›å¤´è§£bug">å›å¤´è§£bug<a class="hash-link" href="#å›å¤´è§£bug" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ç°åœ¨å†å›å¤´çœ‹ä¸‹bugä»£ç å°±çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼šçˆ¶ç±»æ‰§è¡Œæ„é€ æ–¹æ³•æ—¶è°ƒç”¨äº†ä¼šä¿®æ”¹å­ç±»æˆå‘˜<code>a</code>çš„é’©å­æ–¹æ³•ï¼Œç„¶åå­ç±»æ‰åˆå§‹åŒ–äº†è‡ªå·±çš„æˆå‘˜ï¼Œè¦†ç›–äº†é’©å­æ–¹æ³•é‡Œå¯¹<code>a</code>çš„ä¿®æ”¹ã€‚</p><p>è§£å†³æ–¹æ³•ä¹Ÿç®€å•ï¼Œå¯¹<code>a</code>ä¸åŠ é»˜è®¤å€¼å°±å¥½äº†ã€‚</p>]]></content>
        <author>
            <name>Ddupg</name>
            <uri>https://ddupg.github.io</uri>
        </author>
        <category label="Java" term="Java"/>
        <category label="Bug" term="Bug"/>
    </entry>
</feed>